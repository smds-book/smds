<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.280">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<title>Spatial Modelling for Data Scientists - 7&nbsp; Spatial heterogeneity</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./07-multilevel-modelling.html" rel="next">
<link href="./05-spatial-dependence.html" rel="prev">
<link href="./figs/cover/cover.ico" rel="icon">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light"><script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script><style>html{ scroll-behavior: smooth; }</style>
<script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>
<meta name="twitter:title" content="Spatial Modelling for Data Scientists - 7&nbsp; Spatial heterogeneity">
<meta name="twitter:description" content="We will rely on the following libraries in this section, all of them included in sec-dependencies:">
<meta name="twitter:creator" content="@fcorowe">
<meta name="twitter:card" content="summary">
</head>
<body class="nav-sidebar docked">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="quarto-secondary-nav" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }"><div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title">
<span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Spatial heterogeneity</span>
</h1>
      <button type="button" class="quarto-btn-toggle btn" aria-label="Show secondary navigation">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation docked overflow-auto"><div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Spatial Modelling for Data Scientists</a> 
        <div class="sidebar-tools-main tools-wide">
    <a href="https://github.com/fcorowe/smds/tree/main/book/" title="Source Code" class="sidebar-tool px-1"><i class="bi bi-github"></i></a>
    <a href="" title="Share" id="sidebar-tool-dropdown-0" class="sidebar-tool dropdown-toggle px-1" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi bi-share"></i></a>
    <ul class="dropdown-menu" aria-labelledby="sidebar-tool-dropdown-0">
<li>
          <a class="dropdown-item sidebar-tools-main-item" href="https://twitter.com/intent/tweet?url=%7Curl%7C">
            <i class="bi bi-bi-twitter pe-1"></i>
          Twitter
          </a>
        </li>
        <li>
          <a class="dropdown-item sidebar-tools-main-item" href="https://www.facebook.com/sharer/sharer.php?u=%7Curl%7C">
            <i class="bi bi-bi-facebook pe-1"></i>
          Facebook
          </a>
        </li>
    </ul>
<a href="" class="quarto-reader-toggle sidebar-tool" onclick="window.quartoToggleReader(); return false;" title="Toggle reader mode">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
</div>
    </div>
      </div>
      <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">Welcome</a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">Part I</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./preamble.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Framing this book</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./01-embedding-space.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Embedding space</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./02-spatial-data-wrangling.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Spatial data wrangling</span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">Part II</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03-points.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Point patterns</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./04-spatial-interaction-model.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Spatial interaction modelling</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./05-spatial-dependence.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Spatial dependence</span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">Part III</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./06-spatial-heterogeneity.html" class="sidebar-item-text sidebar-link active"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Spatial heterogeneity</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./07-multilevel-modelling.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Multilevel modelling</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./08-weighted-regression-modelling.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Geographically weighted regression</span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true">Part IV</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./09-spatio-temporal-wrangling.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Space-time wrangling</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./10-spatio-temporal-modelling.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Space-time modelling</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./11-spatial-machine-learning.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Spatial machine learning</span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./platform.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Platform</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./data.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Data</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">References</a>
  </div>
</li>
    </ul>
</div>
</nav><!-- margin-sidebar --><div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">Table of contents</h2>
   
  <ul>
<li><a href="#dependencies" id="toc-dependencies" class="nav-link active" data-scroll-target="#dependencies"><span class="toc-section-number">7.1</span>  Dependencies</a></li>
  <li><a href="#data" id="toc-data" class="nav-link" data-scroll-target="#data"><span class="toc-section-number">7.2</span>  Data</a></li>
  <li><a href="#spatial-heterogeneity" id="toc-spatial-heterogeneity" class="nav-link" data-scroll-target="#spatial-heterogeneity"><span class="toc-section-number">7.3</span>  Spatial heterogeneity</a></li>
  </ul><div class="toc-actions"><div><i class="bi bi-github"></i></div><div class="action-links"><p><a href="https://github.com/fcorowe/smds/edit/main/book/06-spatial-heterogeneity.qmd" class="toc-action">Edit this page</a></p><p><a href="https://github.com/fcorowe/smds/issues/new" class="toc-action">Report an issue</a></p><p><a href="https://github.com/fcorowe/smds/blob/main/book/06-spatial-heterogeneity.qmd" class="toc-action">View source</a></p></div></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title d-none d-lg-block">
<span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Spatial heterogeneity</span>
</h1><button type="button" class="btn code-tools-button" id="quarto-code-tools-source"><i class="bi"></i> Code</button></div></div>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header><section id="dependencies" class="level2" data-number="7.1"><h2 data-number="7.1" class="anchored" data-anchor-id="dependencies">
<span class="header-section-number">7.1</span> Dependencies</h2>
<p>We will rely on the following libraries in this section, all of them included in <span class="quarto-unresolved-ref">?sec-dependencies</span>:</p>
<div class="cell">
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Layout</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/rstudio/tufte">tufte</a></span><span class="op">)</span></span>
<span><span class="co"># For pretty table</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://yihui.org/knitr/">knitr</a></span><span class="op">)</span></span>
<span><span class="co"># For string parsing</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://stringr.tidyverse.org">stringr</a></span><span class="op">)</span></span>
<span><span class="co"># Spatial Data management</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://rgdal.r-forge.r-project.org">rgdal</a></span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: sp</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Please note that rgdal will be retired by the end of 2023,
plan transition to sf/stars/terra functions using GDAL and PROJ
at your earliest convenience.

rgdal: version: 1.5-30, (SVN revision 1171)
Geospatial Data Abstraction Library extensions to R successfully loaded
Loaded GDAL runtime: GDAL 3.4.2, released 2022/03/08
Path to GDAL shared files: /Library/Frameworks/R.framework/Versions/4.2/Resources/library/rgdal/gdal
GDAL binary built with GEOS: FALSE 
Loaded PROJ runtime: Rel. 8.2.1, January 1st, 2022, [PJ_VERSION: 821]
Path to PROJ shared files: /Library/Frameworks/R.framework/Versions/4.2/Resources/library/rgdal/proj
PROJ CDN enabled: FALSE
Linking to sp version:1.4-6
To mute warnings of possible GDAL/OSR exportToProj4() degradation,
use options("rgdal_show_exportToProj4_warnings"="none") before loading sp or rgdal.</code></pre>
</div>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Pretty graphics</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span></span>
<span><span class="co"># Pretty maps</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/dkahle/ggmap">ggmap</a></span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>ℹ Google's Terms of Service: &lt;https://mapsplatform.google.com&gt;</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>ℹ Please cite ggmap if you use it! Use `citation("ggmap")` for details.</code></pre>
</div>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># For all your interpolation needs</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/r-spatial/gstat/">gstat</a></span><span class="op">)</span></span>
<span><span class="co"># For data manipulation</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'dplyr'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:stats':

    filter, lag</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:base':

    intersect, setdiff, setequal, union</code></pre>
</div>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Spatial regression</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/r-spatial/spdep/">spdep</a></span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: spData</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>To access larger datasets in this package, install the spDataLarge
package with: `install.packages('spDataLarge',
repos='https://nowosad.github.io/drat/', type='source')`</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: sf</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Linking to GEOS 3.10.2, GDAL 3.4.2, PROJ 8.2.1; sf_use_s2() is TRUE</code></pre>
</div>
</div>
<p>Before we start any analysis, let us set the path to the directory where we are working. We can easily do that with <code><a href="https://rdrr.io/r/base/getwd.html">setwd()</a></code>. Please replace in the following line the path to the folder where you have placed this file and where the <code>house_transactions</code> folder with the data lives.</p>
<div class="cell">
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/getwd.html">setwd</a></span><span class="op">(</span><span class="st">'.'</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="data" class="level2" data-number="7.2"><h2 data-number="7.2" class="anchored" data-anchor-id="data">
<span class="header-section-number">7.2</span> Data</h2>
<p>To explore ideas in spatial regression, we will the set of Airbnb properties for San Diego (US), borrowed from the “Geographic Data Science with Python” book (see <a href="https://geographicdata.science/book/data/airbnb/regression_cleaning.html">here</a> for more info on the dataset source). This covers the point location of properties advertised on the Airbnb website in the San Diego region.</p>
<p>Let us load the data:</p>
<div class="cell">
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">db</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html">st_read</a></span><span class="op">(</span><span class="st">'data/abb_sd/regression_db.geojson'</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Reading layer `regression_db' from data source 
  `/Users/franciscorowe/Dropbox/Francisco/Research/sdsm_book/smds/data/abb_sd/regression_db.geojson' 
  using driver `GeoJSON'
Simple feature collection with 6110 features and 19 fields
Geometry type: POINT
Dimension:     XY
Bounding box:  xmin: -117.2812 ymin: 32.57349 xmax: -116.9553 ymax: 33.08311
Geodetic CRS:  WGS 84</code></pre>
</div>
</div>
<p>The table contains the followig variables:</p>
<div class="cell">
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">db</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "accommodates"       "bathrooms"          "bedrooms"          
 [4] "beds"               "neighborhood"       "pool"              
 [7] "d2balboa"           "coastal"            "price"             
[10] "log_price"          "id"                 "pg_Apartment"      
[13] "pg_Condominium"     "pg_House"           "pg_Other"          
[16] "pg_Townhouse"       "rt_Entire_home.apt" "rt_Private_room"   
[19] "rt_Shared_room"     "geometry"          </code></pre>
</div>
</div>
<p>For most of this chapter, we will be exploring determinants and strategies for modelling the price of a property advertised in AirBnb. To get a first taste of what this means, we can create a plot of prices within the area of San Diego:</p>
<div class="cell">
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">db</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>color <span class="op">=</span> <span class="va">price</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">geom_sf</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html">scale_color_viridis_c</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_void</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="06-spatial-heterogeneity_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section><section id="spatial-heterogeneity" class="level2" data-number="7.3"><h2 data-number="7.3" class="anchored" data-anchor-id="spatial-heterogeneity">
<span class="header-section-number">7.3</span> Spatial heterogeneity</h2>
<p>Spatial heterogeneity (SH) arises when we cannot safely assume the process we are studying operates under the same “rules” throughout the geography of interest. In other words, we can observe SH when there are effects on the outcome variable that are intrinsically linked to specific locations. A good example of this is the case of seafront houses above: we are trying to model the price of a house and, the fact some houses are located under certain conditions (i.e.&nbsp;by the sea), makes their price behave differently. This somewhat abstract concept of SH can be made operational in a model in several ways. We will explore the following two: spatial fixed-effects (FE); and spatial regimes, which is a generalization of FE.</p>
<p><strong>Spatial FE</strong></p>
<p>Let us consider the house price example from the previous section to introduce a more general illustration that relates to the second motivation for spatial effects (“space as a proxy”). Given we are only including two explanatory variables in the model, it is likely we are missing some important factors that play a role at determining the price at which a house is sold. Some of them, however, are likely to vary systematically over space (e.g.&nbsp;different neighborhood characteristics). If that is the case, we can control for those unobserved factors by using traditional dummy variables but basing their creation on a spatial rule. For example, let us include a binary variable for every neighbourhood, as provided by AirBnB, indicating whether a given house is located within such area (<code>1</code>) or not (<code>0</code>). Neighbourhood membership is expressed on the <code>neighborhood</code> column:</p>
<div class="cell">
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">db</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>color <span class="op">=</span> <span class="va">neighborhood</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">geom_sf</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_void</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="06-spatial-heterogeneity_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Mathematically, we are now fitting the following equation:</p>
<p><span class="math display">\[
\log(P_i) = \alpha_r + \beta_1 Acc_i + \beta_2 Bath_i + \beta_3 Bedr_i + \beta_4 Beds_i + \epsilon_i
\]</span></p>
<p>where the main difference is that we are now allowing the constant term, <span class="math inline">\(\alpha\)</span>, to vary by neighbourhood <span class="math inline">\(r\)</span>, <span class="math inline">\(\alpha_r\)</span>.</p>
<p>Programmatically, we can fit this model with <code>lm</code>:</p>
<div class="cell">
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Include `-1` to eliminate the constant term and include a dummy for every area</span></span>
<span><span class="va">m2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span></span>
<span>  <span class="st">'log_price ~ neighborhood + accommodates + bathrooms + bedrooms + beds - 1'</span>, </span>
<span>  <span class="va">db</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">m2</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = "log_price ~ neighborhood + accommodates + bathrooms + bedrooms + beds - 1", 
    data = db)

Residuals:
    Min      1Q  Median      3Q     Max 
-2.4549 -0.2920 -0.0203  0.2741  3.5323 

Coefficients:
                                     Estimate Std. Error t value Pr(&gt;|t|)    
neighborhoodBalboa Park              3.994775   0.036539  109.33   &lt;2e-16 ***
neighborhoodBay Ho                   3.780025   0.086081   43.91   &lt;2e-16 ***
neighborhoodBay Park                 3.941847   0.055788   70.66   &lt;2e-16 ***
neighborhoodCarmel Valley            4.034052   0.062811   64.23   &lt;2e-16 ***
neighborhoodCity Heights West        3.698788   0.065502   56.47   &lt;2e-16 ***
neighborhoodClairemont Mesa          3.658339   0.051438   71.12   &lt;2e-16 ***
neighborhoodCollege Area             3.649859   0.064979   56.17   &lt;2e-16 ***
neighborhoodCore                     4.433447   0.058864   75.32   &lt;2e-16 ***
neighborhoodCortez Hill              4.294790   0.057648   74.50   &lt;2e-16 ***
neighborhoodDel Mar Heights          4.300659   0.060912   70.61   &lt;2e-16 ***
neighborhoodEast Village             4.241146   0.032019  132.46   &lt;2e-16 ***
neighborhoodGaslamp Quarter          4.473863   0.052493   85.23   &lt;2e-16 ***
neighborhoodGrant Hill               4.001481   0.058825   68.02   &lt;2e-16 ***
neighborhoodGrantville               3.664989   0.080168   45.72   &lt;2e-16 ***
neighborhoodKensington               4.073520   0.087322   46.65   &lt;2e-16 ***
neighborhoodLa Jolla                 4.400145   0.026772  164.36   &lt;2e-16 ***
neighborhoodLa Jolla Village         4.066151   0.087263   46.60   &lt;2e-16 ***
neighborhoodLinda Vista              3.817940   0.063128   60.48   &lt;2e-16 ***
neighborhoodLittle Italy             4.390651   0.052433   83.74   &lt;2e-16 ***
neighborhoodLoma Portal              4.034473   0.036173  111.53   &lt;2e-16 ***
neighborhoodMarina                   4.046133   0.052178   77.55   &lt;2e-16 ***
neighborhoodMidtown                  4.032038   0.030280  133.16   &lt;2e-16 ***
neighborhoodMidtown District         4.356943   0.071756   60.72   &lt;2e-16 ***
neighborhoodMira Mesa                3.570523   0.061543   58.02   &lt;2e-16 ***
neighborhoodMission Bay              4.251309   0.023318  182.32   &lt;2e-16 ***
neighborhoodMission Valley           4.012410   0.083766   47.90   &lt;2e-16 ***
neighborhoodMoreno Mission           4.028288   0.063342   63.59   &lt;2e-16 ***
neighborhoodNormal Heights           3.791895   0.054730   69.28   &lt;2e-16 ***
neighborhoodNorth Clairemont         3.498107   0.076432   45.77   &lt;2e-16 ***
neighborhoodNorth Hills              3.959403   0.026823  147.61   &lt;2e-16 ***
neighborhoodNorthwest                3.810201   0.078158   48.75   &lt;2e-16 ***
neighborhoodOcean Beach              4.152695   0.032352  128.36   &lt;2e-16 ***
neighborhoodOld Town                 4.127737   0.046523   88.72   &lt;2e-16 ***
neighborhoodOtay Ranch               3.722902   0.091633   40.63   &lt;2e-16 ***
neighborhoodPacific Beach            4.116749   0.022711  181.27   &lt;2e-16 ***
neighborhoodPark West                4.216829   0.050370   83.72   &lt;2e-16 ***
neighborhoodRancho Bernadino         3.873962   0.080780   47.96   &lt;2e-16 ***
neighborhoodRancho Penasquitos       3.772037   0.068808   54.82   &lt;2e-16 ***
neighborhoodRoseville                4.070468   0.065299   62.34   &lt;2e-16 ***
neighborhoodSan Carlos               3.935042   0.093205   42.22   &lt;2e-16 ***
neighborhoodScripps Ranch            3.641239   0.085190   42.74   &lt;2e-16 ***
neighborhoodSerra Mesa               3.912127   0.066630   58.71   &lt;2e-16 ***
neighborhoodSouth Park               3.987019   0.060141   66.30   &lt;2e-16 ***
neighborhoodUniversity City          3.772504   0.039638   95.17   &lt;2e-16 ***
neighborhoodWest University Heights  4.043161   0.048238   83.82   &lt;2e-16 ***
accommodates                         0.150283   0.005086   29.55   &lt;2e-16 ***
bathrooms                            0.132287   0.011886   11.13   &lt;2e-16 ***
bedrooms                             0.147631   0.011960   12.34   &lt;2e-16 ***
beds                                -0.074622   0.007405  -10.08   &lt;2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.4971 on 6061 degrees of freedom
Multiple R-squared:  0.9904,    Adjusted R-squared:  0.9904 
F-statistic: 1.28e+04 on 49 and 6061 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
</div>
<p>Econometrically speaking, what the postcode FE we have introduced imply is that, instead of comparing all house prices across San Diego as equal, we only derive variation from <em>within</em> each postcode. In our particular case, estimating spatial FE in our particular example also gives you an indirect measure of area <em>desirability</em>: since they are simple dummies in a regression explaining the price of a house, their estimate tells us about how much people are willing to pay to live in a given area. We can visualise this “geography of desirability” by plotting the estimates of each fixed effect on a map:</p>
<div class="cell">
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Extract neighborhood names from coefficients</span></span>
<span><span class="va">nei.names</span> <span class="op">&lt;-</span> <span class="va">m2</span><span class="op">$</span><span class="va">coefficients</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/row.names.html">row.names</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_replace.html">str_replace</a></span><span class="op">(</span><span class="st">"neighborhood"</span>, <span class="st">""</span><span class="op">)</span></span>
<span><span class="co"># Set up as Data Frame</span></span>
<span><span class="va">nei.fes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span></span>
<span>  coef <span class="op">=</span> <span class="va">m2</span><span class="op">$</span><span class="va">coefficients</span>,</span>
<span>  nei <span class="op">=</span> <span class="va">nei.names</span>,</span>
<span>  row.names <span class="op">=</span> <span class="va">nei.names</span></span>
<span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">right_join</a></span><span class="op">(</span></span>
<span>    <span class="va">db</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"nei"</span> <span class="op">=</span> <span class="st">"neighborhood"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co"># Plot</span></span>
<span><span class="va">nei.fes</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html">st_as_sf</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>color <span class="op">=</span> <span class="va">coef</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">geom_sf</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html">scale_color_viridis_c</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_void</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="06-spatial-heterogeneity_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>We can see how neighborhoods in the left (west) tend to have higher prices. What we can’t see, but it is represented there if you are familiar with the geography of San Diego, is that the city is bounded by the Pacific ocean on the left, suggesting neighbourhoods by the beach tend to be more expensive.</p>
<p>Remember that the interpretation of a <span class="math inline">\(\beta_k\)</span> coefficient is the effect of variable <span class="math inline">\(k\)</span>, <em>given all the other explanatory variables included remain constant</em>. By including a single variable for each area, we are effectively forcing the model to compare as equal only house prices that share the same value for each variable; in other words, only houses located within the same area. Introducing FE affords you a higher degree of isolation of the effects of the variables you introduce in your model because you can control for unobserved effects that align spatially with the distribution of the FE you introduce (by neighbourhood, in our case).</p>
<p><strong>Spatial regimes</strong></p>
<p>At the core of estimating spatial FEs is the idea that, instead of assuming the dependent variable behaves uniformly over space, there are systematic effects following a geographical pattern that affect its behaviour. In other words, spatial FEs introduce econometrically the notion of spatial heterogeneity. They do this in the simplest possible form: by allowing the constant term to vary geographically. The other elements of the regression are left untouched and hence apply uniformly across space. The idea of spatial regimes (SRs) is to generalize the spatial FE approach to allow not only the constant term to vary but also any other explanatory variable. This implies that the equation we will be estimating is: <span class="math display">\[
\log(P_i) = \alpha_r + \beta_{1r} Acc_i + \beta_{2r} Bath_i + \beta_{3r} Bedr_i + \beta_{4r} Beds_i + \epsilon_i
\]</span></p>
<p>where we are not only allowing the constant term to vary by region (<span class="math inline">\(\alpha_r\)</span>), but also every other parameter (<span class="math inline">\(\beta_{kr}\)</span>).</p>
<p>Also, given we are going to allow <em>every</em> coefficient to vary by regime, we will need to explicitly set a constant term that we can allow to vary:</p>
<div class="cell">
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">db</span><span class="op">$</span><span class="va">one</span> <span class="op">&lt;-</span> <span class="fl">1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Then, the estimation leverages the capabilities in model description of R formulas:</p>
<div class="cell">
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># `:` notation implies interaction variables</span></span>
<span><span class="va">m3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span></span>
<span>  <span class="st">'log_price ~ 0 + (accommodates + bathrooms + bedrooms + beds):(neighborhood)'</span>, </span>
<span>  <span class="va">db</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">m3</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = "log_price ~ 0 + (accommodates + bathrooms + bedrooms + beds):(neighborhood)", 
    data = db)

Residuals:
     Min       1Q   Median       3Q      Max 
-10.4790  -0.0096   1.0931   1.7599   6.1073 

Coefficients:
                                                  Estimate Std. Error t value
accommodates:neighborhoodBalboa Park              0.063528   0.093237   0.681
accommodates:neighborhoodBay Ho                  -0.259615   0.335007  -0.775
accommodates:neighborhoodBay Park                -0.355401   0.232720  -1.527
accommodates:neighborhoodCarmel Valley            0.129786   0.187193   0.693
accommodates:neighborhoodCity Heights West        0.447371   0.231998   1.928
accommodates:neighborhoodClairemont Mesa          0.711353   0.177821   4.000
accommodates:neighborhoodCollege Area            -0.346152   0.188071  -1.841
accommodates:neighborhoodCore                     0.125864   0.148417   0.848
accommodates:neighborhoodCortez Hill              0.715958   0.126562   5.657
accommodates:neighborhoodDel Mar Heights          0.829195   0.214067   3.874
accommodates:neighborhoodEast Village             0.214642   0.077394   2.773
accommodates:neighborhoodGaslamp Quarter          0.451443   0.197637   2.284
accommodates:neighborhoodGrant Hill               1.135176   0.167771   6.766
accommodates:neighborhoodGrantville               0.300907   0.280369   1.073
accommodates:neighborhoodKensington               0.668742   0.450243   1.485
accommodates:neighborhoodLa Jolla                 0.520882   0.055887   9.320
accommodates:neighborhoodLa Jolla Village         0.566452   0.413185   1.371
accommodates:neighborhoodLinda Vista              0.523975   0.282219   1.857
accommodates:neighborhoodLittle Italy             0.603908   0.121899   4.954
accommodates:neighborhoodLoma Portal              0.487743   0.127870   3.814
accommodates:neighborhoodMarina                   0.431384   0.172628   2.499
accommodates:neighborhoodMidtown                  0.618058   0.087992   7.024
accommodates:neighborhoodMidtown District         0.430398   0.191682   2.245
accommodates:neighborhoodMira Mesa               -0.018199   0.310167  -0.059
accommodates:neighborhoodMission Bay              0.440951   0.049454   8.916
accommodates:neighborhoodMission Valley           0.144530   0.507925   0.285
accommodates:neighborhoodMoreno Mission           0.100471   0.229460   0.438
accommodates:neighborhoodNormal Heights           0.413682   0.198584   2.083
accommodates:neighborhoodNorth Clairemont        -0.242723   0.307090  -0.790
accommodates:neighborhoodNorth Hills              0.262840   0.083258   3.157
accommodates:neighborhoodNorthwest               -0.229157   0.255656  -0.896
accommodates:neighborhoodOcean Beach              0.754771   0.079097   9.542
accommodates:neighborhoodOld Town                 0.177176   0.159714   1.109
accommodates:neighborhoodOtay Ranch              -0.333536   0.309545  -1.078
accommodates:neighborhoodPacific Beach            0.345475   0.057599   5.998
accommodates:neighborhoodPark West                0.909020   0.156013   5.827
accommodates:neighborhoodRancho Bernadino        -0.118939   0.256750  -0.463
accommodates:neighborhoodRancho Penasquitos       0.121845   0.228456   0.533
accommodates:neighborhoodRoseville                0.316929   0.226110   1.402
accommodates:neighborhoodSan Carlos               0.191248   0.318706   0.600
accommodates:neighborhoodScripps Ranch            0.347638   0.127239   2.732
accommodates:neighborhoodSerra Mesa               0.495491   0.282281   1.755
accommodates:neighborhoodSouth Park               0.334378   0.256708   1.303
accommodates:neighborhoodUniversity City          0.107605   0.113883   0.945
accommodates:neighborhoodWest University Heights  0.190215   0.212040   0.897
bathrooms:neighborhoodBalboa Park                 2.275321   0.225032  10.111
bathrooms:neighborhoodBay Ho                      3.312231   0.530568   6.243
bathrooms:neighborhoodBay Park                    2.231649   0.365655   6.103
bathrooms:neighborhoodCarmel Valley               1.191058   0.224138   5.314
bathrooms:neighborhoodCity Heights West           2.517235   0.550272   4.575
bathrooms:neighborhoodClairemont Mesa             3.737297   0.427366   8.745
bathrooms:neighborhoodCollege Area                3.370263   0.413479   8.151
bathrooms:neighborhoodCore                        3.635188   0.490640   7.409
bathrooms:neighborhoodCortez Hill                 1.631032   0.299654   5.443
bathrooms:neighborhoodDel Mar Heights             1.346206   0.342828   3.927
bathrooms:neighborhoodEast Village                2.600489   0.190932  13.620
bathrooms:neighborhoodGaslamp Quarter             3.183092   0.527615   6.033
bathrooms:neighborhoodGrant Hill                  2.770976   0.416838   6.648
bathrooms:neighborhoodGrantville                  2.177175   0.693599   3.139
bathrooms:neighborhoodKensington                  1.284044   0.671482   1.912
bathrooms:neighborhoodLa Jolla                    0.852667   0.099413   8.577
bathrooms:neighborhoodLa Jolla Village            0.984426   1.193870   0.825
bathrooms:neighborhoodLinda Vista                 2.359895   0.393392   5.999
bathrooms:neighborhoodLittle Italy                2.600567   0.275834   9.428
bathrooms:neighborhoodLoma Portal                 2.575164   0.249679  10.314
bathrooms:neighborhoodMarina                      3.317139   0.656533   5.053
bathrooms:neighborhoodMidtown                     0.899736   0.112205   8.019
bathrooms:neighborhoodMidtown District            3.143440   0.594875   5.284
bathrooms:neighborhoodMira Mesa                   2.858280   0.512511   5.577
bathrooms:neighborhoodMission Bay                 1.764929   0.122421  14.417
bathrooms:neighborhoodMission Valley              2.666000   1.365483   1.952
bathrooms:neighborhoodMoreno Mission              3.234512   0.557898   5.798
bathrooms:neighborhoodNormal Heights              3.505139   0.467965   7.490
bathrooms:neighborhoodNorth Clairemont            2.574847   0.613471   4.197
bathrooms:neighborhoodNorth Hills                 2.584724   0.191541  13.494
bathrooms:neighborhoodNorthwest                   2.877519   0.569924   5.049
bathrooms:neighborhoodOcean Beach                 1.702208   0.207508   8.203
bathrooms:neighborhoodOld Town                    2.249120   0.302755   7.429
bathrooms:neighborhoodOtay Ranch                  2.818736   1.132794   2.488
bathrooms:neighborhoodPacific Beach               2.272803   0.130607  17.402
bathrooms:neighborhoodPark West                   2.676739   0.308257   8.683
bathrooms:neighborhoodRancho Bernadino            0.856723   0.555198   1.543
bathrooms:neighborhoodRancho Penasquitos          0.677767   0.414569   1.635
bathrooms:neighborhoodRoseville                   1.109625   0.360103   3.081
bathrooms:neighborhoodSan Carlos                  2.489815   0.511232   4.870
bathrooms:neighborhoodScripps Ranch               2.459862   0.469601   5.238
bathrooms:neighborhoodSerra Mesa                  2.968934   0.602807   4.925
bathrooms:neighborhoodSouth Park                  2.895471   0.521793   5.549
bathrooms:neighborhoodUniversity City             3.125387   0.347825   8.986
bathrooms:neighborhoodWest University Heights     2.188257   0.390408   5.605
bedrooms:neighborhoodBalboa Park                  0.605655   0.245384   2.468
bedrooms:neighborhoodBay Ho                       0.836163   0.631871   1.323
bedrooms:neighborhoodBay Park                     1.060944   0.430737   2.463
bedrooms:neighborhoodCarmel Valley                0.521954   0.480497   1.086
bedrooms:neighborhoodCity Heights West           -0.272600   0.663983  -0.411
bedrooms:neighborhoodClairemont Mesa             -0.742539   0.450344  -1.649
bedrooms:neighborhoodCollege Area                -0.306621   0.410476  -0.747
bedrooms:neighborhoodCore                        -0.786470   0.395991  -1.986
bedrooms:neighborhoodCortez Hill                  0.793039   0.380195   2.086
bedrooms:neighborhoodDel Mar Heights             -0.071069   0.369070  -0.193
bedrooms:neighborhoodEast Village                -0.186076   0.213572  -0.871
bedrooms:neighborhoodGaslamp Quarter             -0.294024   0.342057  -0.860
bedrooms:neighborhoodGrant Hill                  -0.456825   0.425374  -1.074
bedrooms:neighborhoodGrantville                   0.907259   0.770945   1.177
bedrooms:neighborhoodKensington                  -0.257195   1.009326  -0.255
bedrooms:neighborhoodLa Jolla                    -0.152098   0.133726  -1.137
bedrooms:neighborhoodLa Jolla Village             4.291700   1.882046   2.280
bedrooms:neighborhoodLinda Vista                 -0.485372   0.642684  -0.755
bedrooms:neighborhoodLittle Italy                 0.057475   0.306357   0.188
bedrooms:neighborhoodLoma Portal                 -0.406484   0.250607  -1.622
bedrooms:neighborhoodMarina                      -0.831114   0.511626  -1.624
bedrooms:neighborhoodMidtown                      0.696852   0.167900   4.150
bedrooms:neighborhoodMidtown District             0.010614   0.509151   0.021
bedrooms:neighborhoodMira Mesa                   -0.197692   0.780959  -0.253
bedrooms:neighborhoodMission Bay                 -0.330540   0.121602  -2.718
bedrooms:neighborhoodMission Valley               0.514998   1.295767   0.397
bedrooms:neighborhoodMoreno Mission              -0.584689   0.596044  -0.981
bedrooms:neighborhoodNormal Heights              -0.127744   0.391691  -0.326
bedrooms:neighborhoodNorth Clairemont             0.281306   0.695297   0.405
bedrooms:neighborhoodNorth Hills                  0.380444   0.178477   2.132
bedrooms:neighborhoodNorthwest                    0.288603   0.607295   0.475
bedrooms:neighborhoodOcean Beach                 -0.038069   0.207927  -0.183
bedrooms:neighborhoodOld Town                    -0.319724   0.375203  -0.852
bedrooms:neighborhoodOtay Ranch                   0.015564   1.332279   0.012
bedrooms:neighborhoodPacific Beach               -0.037912   0.139026  -0.273
bedrooms:neighborhoodPark West                   -0.696514   0.413881  -1.683
bedrooms:neighborhoodRancho Bernadino             1.034776   0.579798   1.785
bedrooms:neighborhoodRancho Penasquitos           0.674520   0.519260   1.299
bedrooms:neighborhoodRoseville                    0.881011   0.592962   1.486
bedrooms:neighborhoodSan Carlos                  -0.394191   0.540343  -0.730
bedrooms:neighborhoodScripps Ranch                1.107455   0.336101   3.295
bedrooms:neighborhoodSerra Mesa                   0.253001   0.620774   0.408
bedrooms:neighborhoodSouth Park                  -0.595844   0.407811  -1.461
bedrooms:neighborhoodUniversity City              0.203783   0.455767   0.447
bedrooms:neighborhoodWest University Heights      0.242873   0.359245   0.676
beds:neighborhoodBalboa Park                      0.041556   0.173183   0.240
beds:neighborhoodBay Ho                          -0.402544   0.495241  -0.813
beds:neighborhoodBay Park                         0.283958   0.410776   0.691
beds:neighborhoodCarmel Valley                    0.150416   0.288268   0.522
beds:neighborhoodCity Heights West               -0.217526   0.497878  -0.437
beds:neighborhoodClairemont Mesa                 -1.109581   0.308998  -3.591
beds:neighborhoodCollege Area                     0.594892   0.312780   1.902
beds:neighborhoodCore                             0.602559   0.277027   2.175
beds:neighborhoodCortez Hill                     -0.609996   0.143559  -4.249
beds:neighborhoodDel Mar Heights                 -0.708476   0.257299  -2.754
beds:neighborhoodEast Village                     0.399909   0.148641   2.690
beds:neighborhoodGaslamp Quarter                  0.240245   0.319910   0.751
beds:neighborhoodGrant Hill                      -1.315807   0.186724  -7.047
beds:neighborhoodGrantville                      -0.382590   0.469011  -0.816
beds:neighborhoodKensington                       0.133474   0.664698   0.201
beds:neighborhoodLa Jolla                         0.001347   0.085013   0.016
beds:neighborhoodLa Jolla Village                -2.878676   1.020652  -2.820
beds:neighborhoodLinda Vista                     -0.142372   0.278211  -0.512
beds:neighborhoodLittle Italy                    -0.569868   0.099961  -5.701
beds:neighborhoodLoma Portal                     -0.255510   0.222956  -1.146
beds:neighborhoodMarina                           0.024175   0.429466   0.056
beds:neighborhoodMidtown                         -0.346866   0.137915  -2.515
beds:neighborhoodMidtown District                -0.464781   0.337775  -1.376
beds:neighborhoodMira Mesa                        0.319934   0.426799   0.750
beds:neighborhoodMission Bay                     -0.108936   0.067105  -1.623
beds:neighborhoodMission Valley                  -0.502441   0.879795  -0.571
beds:neighborhoodMoreno Mission                   0.492514   0.439355   1.121
beds:neighborhoodNormal Heights                  -0.532907   0.227211  -2.345
beds:neighborhoodNorth Clairemont                 0.562363   0.704213   0.799
beds:neighborhoodNorth Hills                     -0.279430   0.123678  -2.259
beds:neighborhoodNorthwest                        0.742017   0.474903   1.562
beds:neighborhoodOcean Beach                     -0.667651   0.137647  -4.850
beds:neighborhoodOld Town                         0.459210   0.287008   1.600
beds:neighborhoodOtay Ranch                       0.235723   0.983870   0.240
beds:neighborhoodPacific Beach                   -0.179242   0.087511  -2.048
beds:neighborhoodPark West                       -0.873297   0.225334  -3.876
beds:neighborhoodRancho Bernadino                 0.378088   0.348640   1.084
beds:neighborhoodRancho Penasquitos               0.147457   0.344820   0.428
beds:neighborhoodRoseville                       -0.391529   0.328609  -1.191
beds:neighborhoodSan Carlos                       0.115338   0.621666   0.186
beds:neighborhoodScripps Ranch                   -1.654484   0.338331  -4.890
beds:neighborhoodSerra Mesa                      -1.018812   0.705888  -1.443
beds:neighborhoodSouth Park                       0.452815   0.406052   1.115
beds:neighborhoodUniversity City                 -0.345822   0.232779  -1.486
beds:neighborhoodWest University Heights          0.146128   0.364075   0.401
                                                 Pr(&gt;|t|)    
accommodates:neighborhoodBalboa Park             0.495668    
accommodates:neighborhoodBay Ho                  0.438397    
accommodates:neighborhoodBay Park                0.126774    
accommodates:neighborhoodCarmel Valley           0.488131    
accommodates:neighborhoodCity Heights West       0.053861 .  
accommodates:neighborhoodClairemont Mesa         6.40e-05 ***
accommodates:neighborhoodCollege Area            0.065740 .  
accommodates:neighborhoodCore                    0.396446    
accommodates:neighborhoodCortez Hill             1.61e-08 ***
accommodates:neighborhoodDel Mar Heights         0.000108 ***
accommodates:neighborhoodEast Village            0.005565 ** 
accommodates:neighborhoodGaslamp Quarter         0.022395 *  
accommodates:neighborhoodGrant Hill              1.45e-11 ***
accommodates:neighborhoodGrantville              0.283202    
accommodates:neighborhoodKensington              0.137520    
accommodates:neighborhoodLa Jolla                 &lt; 2e-16 ***
accommodates:neighborhoodLa Jolla Village        0.170446    
accommodates:neighborhoodLinda Vista             0.063414 .  
accommodates:neighborhoodLittle Italy            7.47e-07 ***
accommodates:neighborhoodLoma Portal             0.000138 ***
accommodates:neighborhoodMarina                  0.012484 *  
accommodates:neighborhoodMidtown                 2.40e-12 ***
accommodates:neighborhoodMidtown District        0.024780 *  
accommodates:neighborhoodMira Mesa               0.953213    
accommodates:neighborhoodMission Bay              &lt; 2e-16 ***
accommodates:neighborhoodMission Valley          0.776000    
accommodates:neighborhoodMoreno Mission          0.661505    
accommodates:neighborhoodNormal Heights          0.037279 *  
accommodates:neighborhoodNorth Clairemont        0.429327    
accommodates:neighborhoodNorth Hills             0.001602 ** 
accommodates:neighborhoodNorthwest               0.370103    
accommodates:neighborhoodOcean Beach              &lt; 2e-16 ***
accommodates:neighborhoodOld Town                0.267333    
accommodates:neighborhoodOtay Ranch              0.281298    
accommodates:neighborhoodPacific Beach           2.12e-09 ***
accommodates:neighborhoodPark West               5.96e-09 ***
accommodates:neighborhoodRancho Bernadino        0.643202    
accommodates:neighborhoodRancho Penasquitos      0.593817    
accommodates:neighborhoodRoseville               0.161071    
accommodates:neighborhoodSan Carlos              0.548479    
accommodates:neighborhoodScripps Ranch           0.006311 ** 
accommodates:neighborhoodSerra Mesa              0.079258 .  
accommodates:neighborhoodSouth Park              0.192775    
accommodates:neighborhoodUniversity City         0.344762    
accommodates:neighborhoodWest University Heights 0.369719    
bathrooms:neighborhoodBalboa Park                 &lt; 2e-16 ***
bathrooms:neighborhoodBay Ho                     4.60e-10 ***
bathrooms:neighborhoodBay Park                   1.11e-09 ***
bathrooms:neighborhoodCarmel Valley              1.11e-07 ***
bathrooms:neighborhoodCity Heights West          4.87e-06 ***
bathrooms:neighborhoodClairemont Mesa             &lt; 2e-16 ***
bathrooms:neighborhoodCollege Area               4.37e-16 ***
bathrooms:neighborhoodCore                       1.45e-13 ***
bathrooms:neighborhoodCortez Hill                5.45e-08 ***
bathrooms:neighborhoodDel Mar Heights            8.71e-05 ***
bathrooms:neighborhoodEast Village                &lt; 2e-16 ***
bathrooms:neighborhoodGaslamp Quarter            1.71e-09 ***
bathrooms:neighborhoodGrant Hill                 3.25e-11 ***
bathrooms:neighborhoodGrantville                 0.001704 ** 
bathrooms:neighborhoodKensington                 0.055892 .  
bathrooms:neighborhoodLa Jolla                    &lt; 2e-16 ***
bathrooms:neighborhoodLa Jolla Village           0.409651    
bathrooms:neighborhoodLinda Vista                2.10e-09 ***
bathrooms:neighborhoodLittle Italy                &lt; 2e-16 ***
bathrooms:neighborhoodLoma Portal                 &lt; 2e-16 ***
bathrooms:neighborhoodMarina                     4.49e-07 ***
bathrooms:neighborhoodMidtown                    1.28e-15 ***
bathrooms:neighborhoodMidtown District           1.31e-07 ***
bathrooms:neighborhoodMira Mesa                  2.55e-08 ***
bathrooms:neighborhoodMission Bay                 &lt; 2e-16 ***
bathrooms:neighborhoodMission Valley             0.050935 .  
bathrooms:neighborhoodMoreno Mission             7.07e-09 ***
bathrooms:neighborhoodNormal Heights             7.88e-14 ***
bathrooms:neighborhoodNorth Clairemont           2.74e-05 ***
bathrooms:neighborhoodNorth Hills                 &lt; 2e-16 ***
bathrooms:neighborhoodNorthwest                  4.58e-07 ***
bathrooms:neighborhoodOcean Beach                2.85e-16 ***
bathrooms:neighborhoodOld Town                   1.25e-13 ***
bathrooms:neighborhoodOtay Ranch                 0.012863 *  
bathrooms:neighborhoodPacific Beach               &lt; 2e-16 ***
bathrooms:neighborhoodPark West                   &lt; 2e-16 ***
bathrooms:neighborhoodRancho Bernadino           0.122861    
bathrooms:neighborhoodRancho Penasquitos         0.102129    
bathrooms:neighborhoodRoseville                  0.002070 ** 
bathrooms:neighborhoodSan Carlos                 1.14e-06 ***
bathrooms:neighborhoodScripps Ranch              1.68e-07 ***
bathrooms:neighborhoodSerra Mesa                 8.66e-07 ***
bathrooms:neighborhoodSouth Park                 3.00e-08 ***
bathrooms:neighborhoodUniversity City             &lt; 2e-16 ***
bathrooms:neighborhoodWest University Heights    2.18e-08 ***
bedrooms:neighborhoodBalboa Park                 0.013608 *  
bedrooms:neighborhoodBay Ho                      0.185782    
bedrooms:neighborhoodBay Park                    0.013803 *  
bedrooms:neighborhoodCarmel Valley               0.277400    
bedrooms:neighborhoodCity Heights West           0.681416    
bedrooms:neighborhoodClairemont Mesa             0.099236 .  
bedrooms:neighborhoodCollege Area                0.455100    
bedrooms:neighborhoodCore                        0.047070 *  
bedrooms:neighborhoodCortez Hill                 0.037033 *  
bedrooms:neighborhoodDel Mar Heights             0.847309    
bedrooms:neighborhoodEast Village                0.383650    
bedrooms:neighborhoodGaslamp Quarter             0.390058    
bedrooms:neighborhoodGrant Hill                  0.282895    
bedrooms:neighborhoodGrantville                  0.239317    
bedrooms:neighborhoodKensington                  0.798872    
bedrooms:neighborhoodLa Jolla                    0.255422    
bedrooms:neighborhoodLa Jolla Village            0.022623 *  
bedrooms:neighborhoodLinda Vista                 0.450143    
bedrooms:neighborhoodLittle Italy                0.851191    
bedrooms:neighborhoodLoma Portal                 0.104857    
bedrooms:neighborhoodMarina                      0.104332    
bedrooms:neighborhoodMidtown                     3.37e-05 ***
bedrooms:neighborhoodMidtown District            0.983369    
bedrooms:neighborhoodMira Mesa                   0.800169    
bedrooms:neighborhoodMission Bay                 0.006583 ** 
bedrooms:neighborhoodMission Valley              0.691053    
bedrooms:neighborhoodMoreno Mission              0.326658    
bedrooms:neighborhoodNormal Heights              0.744334    
bedrooms:neighborhoodNorth Clairemont            0.685798    
bedrooms:neighborhoodNorth Hills                 0.033080 *  
bedrooms:neighborhoodNorthwest                   0.634643    
bedrooms:neighborhoodOcean Beach                 0.854736    
bedrooms:neighborhoodOld Town                    0.394173    
bedrooms:neighborhoodOtay Ranch                  0.990680    
bedrooms:neighborhoodPacific Beach               0.785097    
bedrooms:neighborhoodPark West                   0.092450 .  
bedrooms:neighborhoodRancho Bernadino            0.074358 .  
bedrooms:neighborhoodRancho Penasquitos          0.193994    
bedrooms:neighborhoodRoseville                   0.137390    
bedrooms:neighborhoodSan Carlos                  0.465713    
bedrooms:neighborhoodScripps Ranch               0.000990 ***
bedrooms:neighborhoodSerra Mesa                  0.683614    
bedrooms:neighborhoodSouth Park                  0.144046    
bedrooms:neighborhoodUniversity City             0.654804    
bedrooms:neighborhoodWest University Heights     0.499025    
beds:neighborhoodBalboa Park                     0.810374    
beds:neighborhoodBay Ho                          0.416352    
beds:neighborhoodBay Park                        0.489423    
beds:neighborhoodCarmel Valley                   0.601836    
beds:neighborhoodCity Heights West               0.662195    
beds:neighborhoodClairemont Mesa                 0.000332 ***
beds:neighborhoodCollege Area                    0.057226 .  
beds:neighborhoodCore                            0.029663 *  
beds:neighborhoodCortez Hill                     2.18e-05 ***
beds:neighborhoodDel Mar Heights                 0.005914 ** 
beds:neighborhoodEast Village                    0.007156 ** 
beds:neighborhoodGaslamp Quarter                 0.452696    
beds:neighborhoodGrant Hill                      2.04e-12 ***
beds:neighborhoodGrantville                      0.414683    
beds:neighborhoodKensington                      0.840859    
beds:neighborhoodLa Jolla                        0.987357    
beds:neighborhoodLa Jolla Village                0.004812 ** 
beds:neighborhoodLinda Vista                     0.608851    
beds:neighborhoodLittle Italy                    1.25e-08 ***
beds:neighborhoodLoma Portal                     0.251837    
beds:neighborhoodMarina                          0.955112    
beds:neighborhoodMidtown                         0.011927 *  
beds:neighborhoodMidtown District                0.168872    
beds:neighborhoodMira Mesa                       0.453518    
beds:neighborhoodMission Bay                     0.104565    
beds:neighborhoodMission Valley                  0.567962    
beds:neighborhoodMoreno Mission                  0.262337    
beds:neighborhoodNormal Heights                  0.019038 *  
beds:neighborhoodNorth Clairemont                0.424572    
beds:neighborhoodNorth Hills                     0.023899 *  
beds:neighborhoodNorthwest                       0.118233    
beds:neighborhoodOcean Beach                     1.26e-06 ***
beds:neighborhoodOld Town                        0.109654    
beds:neighborhoodOtay Ranch                      0.810658    
beds:neighborhoodPacific Beach                   0.040583 *  
beds:neighborhoodPark West                       0.000108 ***
beds:neighborhoodRancho Bernadino                0.278202    
beds:neighborhoodRancho Penasquitos              0.668932    
beds:neighborhoodRoseville                       0.233515    
beds:neighborhoodSan Carlos                      0.852819    
beds:neighborhoodScripps Ranch                   1.03e-06 ***
beds:neighborhoodSerra Mesa                      0.148987    
beds:neighborhoodSouth Park                      0.264826    
beds:neighborhoodUniversity City                 0.137433    
beds:neighborhoodWest University Heights         0.688164    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 1.81 on 5930 degrees of freedom
Multiple R-squared:  0.8759,    Adjusted R-squared:  0.8721 
F-statistic: 232.4 on 180 and 5930 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
</div>
<p>This allows us to get a separate constant term and estimate of the impact of each variable <em>for every neighborhood</em>.</p>


<!-- -->

</section></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><nav class="page-navigation"><div class="nav-page nav-page-previous">
      <a href="./05-spatial-dependence.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Spatial dependence</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./07-multilevel-modelling.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Multilevel modelling</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb29" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="fu"># Spatial heterogeneity</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a><span class="fu">## Dependencies</span></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>We will rely on the following libraries in this section, all of them included in @sec-dependencies:</span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Layout</span></span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tufte)</span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a><span class="co"># For pretty table</span></span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(knitr)</span>
<span id="cb29-14"><a href="#cb29-14" aria-hidden="true" tabindex="-1"></a><span class="co"># For string parsing</span></span>
<span id="cb29-15"><a href="#cb29-15" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stringr)</span>
<span id="cb29-16"><a href="#cb29-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Spatial Data management</span></span>
<span id="cb29-17"><a href="#cb29-17" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rgdal)</span>
<span id="cb29-18"><a href="#cb29-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Pretty graphics</span></span>
<span id="cb29-19"><a href="#cb29-19" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb29-20"><a href="#cb29-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Pretty maps</span></span>
<span id="cb29-21"><a href="#cb29-21" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggmap)</span>
<span id="cb29-22"><a href="#cb29-22" aria-hidden="true" tabindex="-1"></a><span class="co"># For all your interpolation needs</span></span>
<span id="cb29-23"><a href="#cb29-23" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gstat)</span>
<span id="cb29-24"><a href="#cb29-24" aria-hidden="true" tabindex="-1"></a><span class="co"># For data manipulation</span></span>
<span id="cb29-25"><a href="#cb29-25" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb29-26"><a href="#cb29-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Spatial regression</span></span>
<span id="cb29-27"><a href="#cb29-27" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(spdep)</span>
<span id="cb29-28"><a href="#cb29-28" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb29-29"><a href="#cb29-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-30"><a href="#cb29-30" aria-hidden="true" tabindex="-1"></a>Before we start any analysis, let us set the path to the directory where we are working. We can easily do that with <span class="in">`setwd()`</span>. Please replace in the following line the path to the folder where you have placed this file and where the <span class="in">`house_transactions`</span> folder with the data lives.</span>
<span id="cb29-31"><a href="#cb29-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-34"><a href="#cb29-34" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb29-35"><a href="#cb29-35" aria-hidden="true" tabindex="-1"></a><span class="fu">setwd</span>(<span class="st">'.'</span>)</span>
<span id="cb29-36"><a href="#cb29-36" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb29-37"><a href="#cb29-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-38"><a href="#cb29-38" aria-hidden="true" tabindex="-1"></a><span class="fu">## Data</span></span>
<span id="cb29-39"><a href="#cb29-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-40"><a href="#cb29-40" aria-hidden="true" tabindex="-1"></a>To explore ideas in spatial regression, we will the set of Airbnb properties for San Diego (US), borrowed from the "Geographic Data Science with Python" book (see <span class="co">[</span><span class="ot">here</span><span class="co">](https://geographicdata.science/book/data/airbnb/regression_cleaning.html)</span> for more info on the dataset source). This covers the point location of properties advertised on the Airbnb website in the San Diego region.</span>
<span id="cb29-41"><a href="#cb29-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-42"><a href="#cb29-42" aria-hidden="true" tabindex="-1"></a>Let us load the data:</span>
<span id="cb29-43"><a href="#cb29-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-46"><a href="#cb29-46" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb29-47"><a href="#cb29-47" aria-hidden="true" tabindex="-1"></a>db <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="st">'data/abb_sd/regression_db.geojson'</span>)</span>
<span id="cb29-48"><a href="#cb29-48" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb29-49"><a href="#cb29-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-50"><a href="#cb29-50" aria-hidden="true" tabindex="-1"></a>The table contains the followig variables:</span>
<span id="cb29-51"><a href="#cb29-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-54"><a href="#cb29-54" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb29-55"><a href="#cb29-55" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(db)</span>
<span id="cb29-56"><a href="#cb29-56" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb29-57"><a href="#cb29-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-58"><a href="#cb29-58" aria-hidden="true" tabindex="-1"></a>For most of this chapter, we will be exploring determinants and strategies for modelling the price of a property advertised in AirBnb. To get a first taste of what this means, we can create a plot of prices within the area of San Diego:</span>
<span id="cb29-59"><a href="#cb29-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-62"><a href="#cb29-62" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb29-63"><a href="#cb29-63" aria-hidden="true" tabindex="-1"></a>db <span class="sc">%&gt;%</span></span>
<span id="cb29-64"><a href="#cb29-64" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">color =</span> price)) <span class="sc">+</span></span>
<span id="cb29-65"><a href="#cb29-65" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>() <span class="sc">+</span> </span>
<span id="cb29-66"><a href="#cb29-66" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_viridis_c</span>() <span class="sc">+</span></span>
<span id="cb29-67"><a href="#cb29-67" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>()</span>
<span id="cb29-68"><a href="#cb29-68" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb29-69"><a href="#cb29-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-70"><a href="#cb29-70" aria-hidden="true" tabindex="-1"></a><span class="fu">## Spatial heterogeneity</span></span>
<span id="cb29-71"><a href="#cb29-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-72"><a href="#cb29-72" aria-hidden="true" tabindex="-1"></a>Spatial heterogeneity (SH) arises when we cannot safely assume the process we are studying operates under the same "rules" throughout the geography of interest. In other words, we can observe SH when there are effects on the outcome variable that are intrinsically linked to specific locations. A good example of this is the case of seafront houses above: we are trying to model the price of a house and, the fact some houses are located under certain conditions (i.e. by the sea), makes their price behave differently. This somewhat abstract concept of SH can be made operational in a model in several ways. We will explore the following two: spatial fixed-effects (FE); and spatial regimes, which is a generalization of FE.</span>
<span id="cb29-73"><a href="#cb29-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-74"><a href="#cb29-74" aria-hidden="true" tabindex="-1"></a>**Spatial FE**</span>
<span id="cb29-75"><a href="#cb29-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-76"><a href="#cb29-76" aria-hidden="true" tabindex="-1"></a>Let us consider the house price example from the previous section to introduce a more general illustration that relates to the second motivation for spatial effects ("space as a proxy"). Given we are only including two explanatory variables in the model, it is likely we are missing some important factors that play a role at determining the price at which a house is sold. Some of them, however, are likely to vary systematically over space (e.g. different neighborhood characteristics). If that is the case, we can control for those unobserved factors by using traditional dummy variables but basing their creation on a spatial rule. For example, let us include a binary variable for every neighbourhood, as provided by AirBnB, indicating whether a given house is located within such area (<span class="in">`1`</span>) or not (<span class="in">`0`</span>). Neighbourhood membership is expressed on the <span class="in">`neighborhood`</span> column:</span>
<span id="cb29-77"><a href="#cb29-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-80"><a href="#cb29-80" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb29-81"><a href="#cb29-81" aria-hidden="true" tabindex="-1"></a>db <span class="sc">%&gt;%</span></span>
<span id="cb29-82"><a href="#cb29-82" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">color =</span> neighborhood)) <span class="sc">+</span></span>
<span id="cb29-83"><a href="#cb29-83" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>() <span class="sc">+</span> </span>
<span id="cb29-84"><a href="#cb29-84" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>()</span>
<span id="cb29-85"><a href="#cb29-85" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb29-86"><a href="#cb29-86" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-87"><a href="#cb29-87" aria-hidden="true" tabindex="-1"></a>Mathematically, we are now fitting the following equation:</span>
<span id="cb29-88"><a href="#cb29-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-89"><a href="#cb29-89" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb29-90"><a href="#cb29-90" aria-hidden="true" tabindex="-1"></a>\log(P_i) = \alpha_r + \beta_1 Acc_i + \beta_2 Bath_i + \beta_3 Bedr_i + \beta_4 Beds_i + \epsilon_i</span>
<span id="cb29-91"><a href="#cb29-91" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb29-92"><a href="#cb29-92" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-93"><a href="#cb29-93" aria-hidden="true" tabindex="-1"></a>where the main difference is that we are now allowing the constant term, $\alpha$, to vary by neighbourhood $r$, $\alpha_r$.</span>
<span id="cb29-94"><a href="#cb29-94" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-95"><a href="#cb29-95" aria-hidden="true" tabindex="-1"></a>Programmatically, we can fit this model with <span class="in">`lm`</span>:</span>
<span id="cb29-96"><a href="#cb29-96" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-99"><a href="#cb29-99" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb29-100"><a href="#cb29-100" aria-hidden="true" tabindex="-1"></a><span class="co"># Include `-1` to eliminate the constant term and include a dummy for every area</span></span>
<span id="cb29-101"><a href="#cb29-101" aria-hidden="true" tabindex="-1"></a>m2 <span class="ot">&lt;-</span> <span class="fu">lm</span>(</span>
<span id="cb29-102"><a href="#cb29-102" aria-hidden="true" tabindex="-1"></a>  <span class="st">'log_price ~ neighborhood + accommodates + bathrooms + bedrooms + beds - 1'</span>, </span>
<span id="cb29-103"><a href="#cb29-103" aria-hidden="true" tabindex="-1"></a>  db</span>
<span id="cb29-104"><a href="#cb29-104" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb29-105"><a href="#cb29-105" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(m2)</span>
<span id="cb29-106"><a href="#cb29-106" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb29-107"><a href="#cb29-107" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-108"><a href="#cb29-108" aria-hidden="true" tabindex="-1"></a>Econometrically speaking, what the postcode FE we have introduced imply is that, instead of comparing all house prices across San Diego as equal, we only derive variation from *within* each postcode. In our particular case, estimating spatial FE in our particular example also gives you an indirect measure of area *desirability*: since they are simple dummies in a regression explaining the price of a house, their estimate tells us about how much people are willing to pay to live in a given area. We can visualise this "geography of desirability" by plotting the estimates of each fixed effect on a map:</span>
<span id="cb29-109"><a href="#cb29-109" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-112"><a href="#cb29-112" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb29-113"><a href="#cb29-113" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract neighborhood names from coefficients</span></span>
<span id="cb29-114"><a href="#cb29-114" aria-hidden="true" tabindex="-1"></a>nei.names <span class="ot">&lt;-</span> m2<span class="sc">$</span>coefficients <span class="sc">%&gt;%</span></span>
<span id="cb29-115"><a href="#cb29-115" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb29-116"><a href="#cb29-116" aria-hidden="true" tabindex="-1"></a>  <span class="fu">row.names</span>() <span class="sc">%&gt;%</span></span>
<span id="cb29-117"><a href="#cb29-117" aria-hidden="true" tabindex="-1"></a>  <span class="fu">str_replace</span>(<span class="st">"neighborhood"</span>, <span class="st">""</span>)</span>
<span id="cb29-118"><a href="#cb29-118" aria-hidden="true" tabindex="-1"></a><span class="co"># Set up as Data Frame</span></span>
<span id="cb29-119"><a href="#cb29-119" aria-hidden="true" tabindex="-1"></a>nei.fes <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb29-120"><a href="#cb29-120" aria-hidden="true" tabindex="-1"></a>  <span class="at">coef =</span> m2<span class="sc">$</span>coefficients,</span>
<span id="cb29-121"><a href="#cb29-121" aria-hidden="true" tabindex="-1"></a>  <span class="at">nei =</span> nei.names,</span>
<span id="cb29-122"><a href="#cb29-122" aria-hidden="true" tabindex="-1"></a>  <span class="at">row.names =</span> nei.names</span>
<span id="cb29-123"><a href="#cb29-123" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb29-124"><a href="#cb29-124" aria-hidden="true" tabindex="-1"></a>  <span class="fu">right_join</span>(</span>
<span id="cb29-125"><a href="#cb29-125" aria-hidden="true" tabindex="-1"></a>    db, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"nei"</span> <span class="ot">=</span> <span class="st">"neighborhood"</span>)</span>
<span id="cb29-126"><a href="#cb29-126" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb29-127"><a href="#cb29-127" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot</span></span>
<span id="cb29-128"><a href="#cb29-128" aria-hidden="true" tabindex="-1"></a>nei.fes <span class="sc">%&gt;%</span></span>
<span id="cb29-129"><a href="#cb29-129" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_as_sf</span>() <span class="sc">%&gt;%</span></span>
<span id="cb29-130"><a href="#cb29-130" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">color =</span> coef)) <span class="sc">+</span></span>
<span id="cb29-131"><a href="#cb29-131" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>() <span class="sc">+</span></span>
<span id="cb29-132"><a href="#cb29-132" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_viridis_c</span>() <span class="sc">+</span></span>
<span id="cb29-133"><a href="#cb29-133" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>()</span>
<span id="cb29-134"><a href="#cb29-134" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb29-135"><a href="#cb29-135" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-136"><a href="#cb29-136" aria-hidden="true" tabindex="-1"></a>We can see how neighborhoods in the left (west) tend to have higher prices. What we can't see, but it is represented there if you are familiar with the geography of San Diego, is that the city is bounded by the Pacific ocean on the left, suggesting neighbourhoods by the beach tend to be more expensive.</span>
<span id="cb29-137"><a href="#cb29-137" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-138"><a href="#cb29-138" aria-hidden="true" tabindex="-1"></a>Remember that the interpretation of a $\beta_k$ coefficient is the effect of variable $k$, *given all the other explanatory variables included remain constant*. By including a single variable for each area, we are effectively forcing the model to compare as equal only house prices that share the same value for each variable; in other words, only houses located within the same area. Introducing FE affords you a higher degree of isolation of the effects of the variables you introduce in your model because you can control for unobserved effects that align spatially with the distribution of the FE you introduce (by neighbourhood, in our case).</span>
<span id="cb29-139"><a href="#cb29-139" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-140"><a href="#cb29-140" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-141"><a href="#cb29-141" aria-hidden="true" tabindex="-1"></a>**Spatial regimes**</span>
<span id="cb29-142"><a href="#cb29-142" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-143"><a href="#cb29-143" aria-hidden="true" tabindex="-1"></a>At the core of estimating spatial FEs is the idea that, instead of assuming the dependent variable behaves uniformly over space, there are systematic effects following a geographical pattern that affect its behaviour. In other words, spatial FEs introduce econometrically the notion of spatial heterogeneity. They do this in the simplest possible form: by allowing the constant term to vary geographically. The other elements of the regression are left untouched and hence apply uniformly across space. The idea of spatial regimes (SRs) is to generalize the spatial FE approach to allow not only the constant term to vary but also any other explanatory variable. This implies that the equation we will be estimating is: $$</span>
<span id="cb29-144"><a href="#cb29-144" aria-hidden="true" tabindex="-1"></a>\log(P_i) = \alpha_r + \beta_{1r} Acc_i + \beta_{2r} Bath_i + \beta_{3r} Bedr_i + \beta_{4r} Beds_i + \epsilon_i</span>
<span id="cb29-145"><a href="#cb29-145" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb29-146"><a href="#cb29-146" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-147"><a href="#cb29-147" aria-hidden="true" tabindex="-1"></a>where we are not only allowing the constant term to vary by region ($\alpha_r$), but also every other parameter ($\beta_{kr}$).</span>
<span id="cb29-148"><a href="#cb29-148" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-149"><a href="#cb29-149" aria-hidden="true" tabindex="-1"></a>Also, given we are going to allow *every* coefficient to vary by regime, we will need to explicitly set a constant term that we can allow to vary:</span>
<span id="cb29-150"><a href="#cb29-150" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-153"><a href="#cb29-153" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb29-154"><a href="#cb29-154" aria-hidden="true" tabindex="-1"></a>db<span class="sc">$</span>one <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb29-155"><a href="#cb29-155" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb29-156"><a href="#cb29-156" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-157"><a href="#cb29-157" aria-hidden="true" tabindex="-1"></a>Then, the estimation leverages the capabilities in model description of R formulas:</span>
<span id="cb29-158"><a href="#cb29-158" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-161"><a href="#cb29-161" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb29-162"><a href="#cb29-162" aria-hidden="true" tabindex="-1"></a><span class="co"># `:` notation implies interaction variables</span></span>
<span id="cb29-163"><a href="#cb29-163" aria-hidden="true" tabindex="-1"></a>m3 <span class="ot">&lt;-</span> <span class="fu">lm</span>(</span>
<span id="cb29-164"><a href="#cb29-164" aria-hidden="true" tabindex="-1"></a>  <span class="st">'log_price ~ 0 + (accommodates + bathrooms + bedrooms + beds):(neighborhood)'</span>, </span>
<span id="cb29-165"><a href="#cb29-165" aria-hidden="true" tabindex="-1"></a>  db</span>
<span id="cb29-166"><a href="#cb29-166" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb29-167"><a href="#cb29-167" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(m3)</span>
<span id="cb29-168"><a href="#cb29-168" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb29-169"><a href="#cb29-169" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-170"><a href="#cb29-170" aria-hidden="true" tabindex="-1"></a>This allows us to get a separate constant term and estimate of the impact of each variable *for every neighborhood*.</span>
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->
<footer class="footer"><div class="nav-footer">
    <div class="nav-footer-left">All content licensed under <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> <br> © <a href="https://www.franciscorowe.com">Francisco Rowe</a>, <a href="https://darribas.org">Dani Arribas-Bel</a>.</div>   
      <div class="nav-footer-center"><a href="https://fcorowe.github.io/smds/">Website</a> | <a href="https://github.com/fcorowe/smds">GitHub</a></div>
    <div class="nav-footer-right">Built with <a href="https://quarto.org/">Quarto</a>.</div>
  </div>
</footer>


<script src="site_libs/quarto-html/zenscroll-min.js"></script>
</body></html>