<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.280">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<title>Spatial Modelling for Data Scientists - 3&nbsp; Spatial data wrangling</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./03-points.html" rel="next">
<link href="./01-embedding-space.html" rel="prev">
<link href="./figs/cover/cover.ico" rel="icon">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light"><script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script><style>html{ scroll-behavior: smooth; }</style>
<meta name="twitter:title" content="Spatial Modelling for Data Scientists - 3&nbsp; Spatial data wrangling">
<meta name="twitter:description" content="This chapter1 introduces computational notebooks, basic functions and data types. These are all important concepts that we will use during the module.">
<meta name="twitter:image" content="figs/ch2/rstudio_features.png">
<meta name="twitter:creator" content="@fcorowe">
<meta name="twitter:card" content="summary_large_image">
</head>
<body class="nav-sidebar docked slimcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="quarto-secondary-nav" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }"><div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title">
<span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Spatial data wrangling</span>
</h1>
      <button type="button" class="quarto-btn-toggle btn" aria-label="Show secondary navigation">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation docked overflow-auto"><div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Spatial Modelling for Data Scientists</a> 
        <div class="sidebar-tools-main tools-wide">
    <a href="https://github.com/fcorowe/smds/tree/main/book/" title="Source Code" class="sidebar-tool px-1"><i class="bi bi-github"></i></a>
    <a href="" title="Share" id="sidebar-tool-dropdown-0" class="sidebar-tool dropdown-toggle px-1" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi bi-share"></i></a>
    <ul class="dropdown-menu" aria-labelledby="sidebar-tool-dropdown-0">
<li>
          <a class="dropdown-item sidebar-tools-main-item" href="https://twitter.com/intent/tweet?url=%7Curl%7C">
            <i class="bi bi-bi-twitter pe-1"></i>
          Twitter
          </a>
        </li>
        <li>
          <a class="dropdown-item sidebar-tools-main-item" href="https://www.facebook.com/sharer/sharer.php?u=%7Curl%7C">
            <i class="bi bi-bi-facebook pe-1"></i>
          Facebook
          </a>
        </li>
    </ul>
<a href="" class="quarto-reader-toggle sidebar-tool" onclick="window.quartoToggleReader(); return false;" title="Toggle reader mode">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
</div>
    </div>
      </div>
      <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">Welcome</a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">Part I</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./preamble.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Framing this book</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./01-embedding-space.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Embedding space</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./02-spatial-data-wrangling.html" class="sidebar-item-text sidebar-link active"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Spatial data wrangling</span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">Part II</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03-points.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Point data analysis</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./04-spatial-interaction-model.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Spatial interaction modelling</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./05-spatial-dependence.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Spatial dependence</span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">Part III</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./06-spatial-heterogeneity.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Spatial heterogeneity</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./07-multilevel-modelling.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Multilevel modelling</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./08-weighted-regression-modelling.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Geographically weighted regression modelling</span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true">Part IV</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./09-spatio-temporal-wrangling.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Spatiotemporal wrangling</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./10-spatio-temporal-modelling.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Spatiotemporal modelling</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./11-spatial-machine-learning.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Spatial machine learning</span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./platform.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Platform</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./data.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Data</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">References</a>
  </div>
</li>
    </ul>
</div>
</nav><!-- margin-sidebar --><div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">Table of contents</h2>
   
  <ul>
<li><a href="#dependencies" id="toc-dependencies" class="nav-link active" data-scroll-target="#dependencies"><span class="toc-section-number">3.1</span>  Dependencies</a></li>
  <li><a href="#introducing-r" id="toc-introducing-r" class="nav-link" data-scroll-target="#introducing-r"><span class="toc-section-number">3.2</span>  Introducing R</a></li>
  <li><a href="#setting-the-working-directory" id="toc-setting-the-working-directory" class="nav-link" data-scroll-target="#setting-the-working-directory"><span class="toc-section-number">3.3</span>  Setting the working directory</a></li>
  <li><a href="#r-scripts-and-computational-notebooks" id="toc-r-scripts-and-computational-notebooks" class="nav-link" data-scroll-target="#r-scripts-and-computational-notebooks"><span class="toc-section-number">3.4</span>  R Scripts and Computational Notebooks</a></li>
  <li><a href="#getting-help" id="toc-getting-help" class="nav-link" data-scroll-target="#getting-help"><span class="toc-section-number">3.5</span>  Getting Help</a></li>
  <li>
<a href="#variables-and-objects" id="toc-variables-and-objects" class="nav-link" data-scroll-target="#variables-and-objects"><span class="toc-section-number">3.6</span>  Variables and objects</a>
  <ul class="collapse">
<li><a href="#basic-data-types" id="toc-basic-data-types" class="nav-link" data-scroll-target="#basic-data-types"><span class="toc-section-number">3.6.1</span>  Basic Data Types</a></li>
  <li><a href="#random-variables" id="toc-random-variables" class="nav-link" data-scroll-target="#random-variables"><span class="toc-section-number">3.6.2</span>  Random Variables</a></li>
  </ul>
</li>
  <li>
<a href="#data-frames" id="toc-data-frames" class="nav-link" data-scroll-target="#data-frames"><span class="toc-section-number">3.7</span>  Data Frames</a>
  <ul class="collapse">
<li><a href="#creating-a-data-frame" id="toc-creating-a-data-frame" class="nav-link" data-scroll-target="#creating-a-data-frame"><span class="toc-section-number">3.7.1</span>  Creating A Data Frame</a></li>
  <li><a href="#referencing-data-frames" id="toc-referencing-data-frames" class="nav-link" data-scroll-target="#referencing-data-frames"><span class="toc-section-number">3.7.2</span>  Referencing Data Frames</a></li>
  </ul>
</li>
  <li>
<a href="#sec_readdata" id="toc-sec_readdata" class="nav-link" data-scroll-target="#sec_readdata"><span class="toc-section-number">3.8</span>  Read Data</a>
  <ul class="collapse">
<li><a href="#quickly-inspect-the-data" id="toc-quickly-inspect-the-data" class="nav-link" data-scroll-target="#quickly-inspect-the-data"><span class="toc-section-number">3.8.1</span>  Quickly inspect the data</a></li>
  </ul>
</li>
  <li>
<a href="#manipulation-data" id="toc-manipulation-data" class="nav-link" data-scroll-target="#manipulation-data"><span class="toc-section-number">3.9</span>  Manipulation Data</a>
  <ul class="collapse">
<li><a href="#adding-new-variables" id="toc-adding-new-variables" class="nav-link" data-scroll-target="#adding-new-variables"><span class="toc-section-number">3.9.1</span>  Adding New Variables</a></li>
  <li><a href="#selecting-variables" id="toc-selecting-variables" class="nav-link" data-scroll-target="#selecting-variables"><span class="toc-section-number">3.9.2</span>  Selecting Variables</a></li>
  <li><a href="#filtering-data" id="toc-filtering-data" class="nav-link" data-scroll-target="#filtering-data"><span class="toc-section-number">3.9.3</span>  Filtering Data</a></li>
  <li><a href="#joining-data-drames" id="toc-joining-data-drames" class="nav-link" data-scroll-target="#joining-data-drames"><span class="toc-section-number">3.9.4</span>  Joining Data Drames</a></li>
  <li><a href="#saving-data" id="toc-saving-data" class="nav-link" data-scroll-target="#saving-data"><span class="toc-section-number">3.9.5</span>  Saving Data</a></li>
  </ul>
</li>
  <li>
<a href="#using-spatial-data-frames" id="toc-using-spatial-data-frames" class="nav-link" data-scroll-target="#using-spatial-data-frames"><span class="toc-section-number">3.10</span>  Using Spatial Data Frames</a>
  <ul class="collapse">
<li><a href="#read-spatial-data" id="toc-read-spatial-data" class="nav-link" data-scroll-target="#read-spatial-data"><span class="toc-section-number">3.10.1</span>  Read Spatial Data</a></li>
  <li><a href="#basic-mapping" id="toc-basic-mapping" class="nav-link" data-scroll-target="#basic-mapping"><span class="toc-section-number">3.10.2</span>  Basic Mapping</a></li>
  <li><a href="#comparing-geographies" id="toc-comparing-geographies" class="nav-link" data-scroll-target="#comparing-geographies"><span class="toc-section-number">3.10.3</span>  Comparing geographies</a></li>
  </ul>
</li>
  <li><a href="#useful-functions" id="toc-useful-functions" class="nav-link" data-scroll-target="#useful-functions"><span class="toc-section-number">3.11</span>  Useful Functions</a></li>
  </ul><div class="toc-actions"><div><i class="bi bi-github"></i></div><div class="action-links"><p><a href="https://github.com/fcorowe/smds/edit/main/book/02-spatial-data-wrangling.qmd" class="toc-action">Edit this page</a></p><p><a href="https://github.com/fcorowe/smds/issues/new" class="toc-action">Report an issue</a></p><p><a href="https://github.com/fcorowe/smds/blob/main/book/02-spatial-data-wrangling.qmd" class="toc-action">View source</a></p></div></div></nav>
    </div>
<!-- main -->
<main class="content page-columns page-full" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title d-none d-lg-block">
<span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Spatial data wrangling</span>
</h1><button type="button" class="btn code-tools-button" id="quarto-code-tools-source"><i class="bi"></i> Code</button></div></div>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header><div class="page-columns page-full"><p>This chapter<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a> introduces computational notebooks, basic functions and data types. These are all important concepts that we will use during the module.</p><div class="no-row-height column-margin column-container"><li id="fn1"><p><sup>1</sup>&nbsp;This chapter is part of <a href="index.html">Spatial Analysis Notes</a> <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/"><img src="https://i.creativecommons.org/l/by-nc-sa/4.0/88x31.png" alt="Creative Commons License" style="border-width:0"></a><br><span xmlns:dct="http://purl.org/dc/terms/" property="dct:title">Introduction – R Notebooks + Basic Functions + Data Types</span> by <a xmlns:cc="http://creativecommons.org/ns#" href="http://franciscorowe.com" property="cc:attributionName" rel="cc:attributionURL">Francisco Rowe</a> is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/">Creative Commons Attribution-NonCommercial-ShareAlike 4.0 International License</a>.</p></li></div></div>
<p>If you are already familiar with R, R notebooks and data types, you may want to jump to Section <a href="#sec_readdata">Read Data</a> and start from there. This section describes how to read and manipulate data using <code>sf</code> and <code>tidyverse</code> functions, including <code><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate()</a></code>, <code>%&gt;%</code> (known as pipe operator), <code><a href="https://dplyr.tidyverse.org/reference/select.html">select()</a></code>, <code><a href="https://dplyr.tidyverse.org/reference/filter.html">filter()</a></code> and specific packages and functions how to manipulate spatial data.</p>
<p>The chapter is based on:</p>
<ul>
<li><p><span class="citation" data-cites="grolemund_wickham_2019_book">Grolemund and Wickham (<a href="references.html#ref-grolemund_wickham_2019_book" role="doc-biblioref">2019</a>)</span>, this book illustrates key libraries, including tidyverse, and functions for data manipulation in R</p></li>
<li><p><span class="citation" data-cites="Xie_et_al_2019_book">Xie, Allaire, and Grolemund (<a href="references.html#ref-Xie_et_al_2019_book" role="doc-biblioref">2019</a>)</span>, excellent introduction to R markdown!</p></li>
<li><p><span class="citation" data-cites="envs450_2018">Williamson (<a href="references.html#ref-envs450_2018" role="doc-biblioref">2018</a>)</span>, some examples from the first lecture of ENVS450 are used to explain the various types of random variables.</p></li>
<li><p><span class="citation" data-cites="lovelace2019">(<a href="references.html#ref-lovelace2019" role="doc-biblioref"><strong>lovelace2019?</strong></a>)</span>, a really good book on handling spatial data and historical background of the evolution of R packages for spatial data analysis.</p></li>
</ul>
<section id="dependencies" class="level2 page-columns page-full" data-number="3.1"><h2 data-number="3.1" class="anchored" data-anchor-id="dependencies">
<span class="header-section-number">3.1</span> Dependencies</h2>
<div class="page-columns page-full"><p>This tutorial uses the libraries below. Ensure they are installed on your machine<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a> before loading them executing the following code chunk:</p><div class="no-row-height column-margin column-container"><li id="fn2"><p><sup>2</sup>&nbsp;You can install package <code>mypackage</code> by running the command <code>install.packages("mypackage")</code> on the R prompt or through the <code>Tools --&gt; Install Packages...</code> menu in RStudio.</p></li></div></div>
<div class="cell">
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Data manipulation, transformation and visualisation</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span></span>
<span><span class="co"># Nice tables</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://haozhu233.github.io/kableExtra/">kableExtra</a></span><span class="op">)</span></span>
<span><span class="co"># Simple features (a standardised way to encode vector data ie. points, lines, polygons)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/">sf</a></span><span class="op">)</span> </span>
<span><span class="co"># Spatial objects conversion</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/edzer/sp/">sp</a></span><span class="op">)</span> </span>
<span><span class="co"># Thematic maps</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/r-tmap/tmap">tmap</a></span><span class="op">)</span> </span>
<span><span class="co"># Colour palettes</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">RColorBrewer</span><span class="op">)</span> </span>
<span><span class="co"># More colour palettes</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://sjmgarnier.github.io/viridis/">viridis</a></span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="introducing-r" class="level2" data-number="3.2"><h2 data-number="3.2" class="anchored" data-anchor-id="introducing-r">
<span class="header-section-number">3.2</span> Introducing R</h2>
<p>R is a freely available language and environment for statistical computing and graphics which provides a wide variety of statistical and graphical techniques. It has gained widespread use in academia and industry. R offers a wider array of functionality than a traditional statistics package, such as SPSS and is composed of core (base) functionality, and is expandable through libraries hosted on <a href="https://cran.r-project.org">CRAN</a>. CRAN is a network of ftp and web servers around the world that store identical, up-to-date, versions of code and documentation for R.</p>
<p>Commands are sent to R using either the terminal / command line or the R Console which is installed with R on either Windows or OS X. On Linux, there is no equivalent of the console, however, third party solutions exist. On your own machine, R can be installed from <a href="https://www.r-project.org/">here</a>.</p>
<p>Normally RStudio is used to implement R coding. RStudio is an integrated development environment (IDE) for R and provides a more user-friendly front-end to R than the front-end provided with R.</p>
<p>To run R or RStudio, just double click on the R or RStudio icon. Throughout this module, we will be using RStudio:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="figs/ch2/rstudio_features.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">Fig. 1. RStudio features.</figcaption><p></p>
</figure>
</div>
<p>If you would like to know more about the various features of RStudio, watch this <a href="https://rstudio.com/products/rstudio/">video</a></p>
</section><section id="setting-the-working-directory" class="level2" data-number="3.3"><h2 data-number="3.3" class="anchored" data-anchor-id="setting-the-working-directory">
<span class="header-section-number">3.3</span> Setting the working directory</h2>
<p>Before we start any analysis, ensure to set the path to the directory where we are working. We can easily do that with <code><a href="https://rdrr.io/r/base/getwd.html">setwd()</a></code>. Please replace in the following line the path to the folder where you have placed this file -and where the <code>data</code> folder lives.</p>
<div class="cell">
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">#setwd('../data/sar.csv')</span></span>
<span><span class="co">#setwd('.')</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Note: It is good practice to not include spaces when naming folders and files. Use <em>underscores</em> or <em>dots</em>.</p>
<p>You can check your current working directory by typing:</p>
<div class="cell">
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/getwd.html">getwd</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "/Users/franciscorowe/Dropbox/Francisco/Research/sdsm_book/smds"</code></pre>
</div>
</div>
</section><section id="r-scripts-and-computational-notebooks" class="level2" data-number="3.4"><h2 data-number="3.4" class="anchored" data-anchor-id="r-scripts-and-computational-notebooks">
<span class="header-section-number">3.4</span> R Scripts and Computational Notebooks</h2>
<p>An <em>R script</em> is a series of commands that you can execute at one time and help you save time. So you do not repeat the same steps every time you want to execute the same process with different datasets. An R script is just a plain text file with R commands in it.</p>
<p>To create an R script in RStudio, you need to</p>
<ul>
<li><p>Open a new script file: <em>File</em> &gt; <em>New File</em> &gt; <em>R Script</em></p></li>
<li><p>Write some code on your new script window by typing eg. <code>mtcars</code></p></li>
<li><p>Run the script. Click anywhere on the line of code, then hit <em>Ctrl + Enter</em> (Windows) or <em>Cmd + Enter</em> (Mac) to run the command or select the code chunk and click <em>run</em> on the right-top corner of your script window. If do that, you should get:</p></li>
</ul>
<div class="cell">
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">mtcars</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                     mpg cyl  disp  hp drat    wt  qsec vs am gear carb
Mazda RX4           21.0   6 160.0 110 3.90 2.620 16.46  0  1    4    4
Mazda RX4 Wag       21.0   6 160.0 110 3.90 2.875 17.02  0  1    4    4
Datsun 710          22.8   4 108.0  93 3.85 2.320 18.61  1  1    4    1
Hornet 4 Drive      21.4   6 258.0 110 3.08 3.215 19.44  1  0    3    1
Hornet Sportabout   18.7   8 360.0 175 3.15 3.440 17.02  0  0    3    2
Valiant             18.1   6 225.0 105 2.76 3.460 20.22  1  0    3    1
Duster 360          14.3   8 360.0 245 3.21 3.570 15.84  0  0    3    4
Merc 240D           24.4   4 146.7  62 3.69 3.190 20.00  1  0    4    2
Merc 230            22.8   4 140.8  95 3.92 3.150 22.90  1  0    4    2
Merc 280            19.2   6 167.6 123 3.92 3.440 18.30  1  0    4    4
Merc 280C           17.8   6 167.6 123 3.92 3.440 18.90  1  0    4    4
Merc 450SE          16.4   8 275.8 180 3.07 4.070 17.40  0  0    3    3
Merc 450SL          17.3   8 275.8 180 3.07 3.730 17.60  0  0    3    3
Merc 450SLC         15.2   8 275.8 180 3.07 3.780 18.00  0  0    3    3
Cadillac Fleetwood  10.4   8 472.0 205 2.93 5.250 17.98  0  0    3    4
Lincoln Continental 10.4   8 460.0 215 3.00 5.424 17.82  0  0    3    4
Chrysler Imperial   14.7   8 440.0 230 3.23 5.345 17.42  0  0    3    4
Fiat 128            32.4   4  78.7  66 4.08 2.200 19.47  1  1    4    1
Honda Civic         30.4   4  75.7  52 4.93 1.615 18.52  1  1    4    2
Toyota Corolla      33.9   4  71.1  65 4.22 1.835 19.90  1  1    4    1
Toyota Corona       21.5   4 120.1  97 3.70 2.465 20.01  1  0    3    1
Dodge Challenger    15.5   8 318.0 150 2.76 3.520 16.87  0  0    3    2
AMC Javelin         15.2   8 304.0 150 3.15 3.435 17.30  0  0    3    2
Camaro Z28          13.3   8 350.0 245 3.73 3.840 15.41  0  0    3    4
Pontiac Firebird    19.2   8 400.0 175 3.08 3.845 17.05  0  0    3    2
Fiat X1-9           27.3   4  79.0  66 4.08 1.935 18.90  1  1    4    1
Porsche 914-2       26.0   4 120.3  91 4.43 2.140 16.70  0  1    5    2
Lotus Europa        30.4   4  95.1 113 3.77 1.513 16.90  1  1    5    2
Ford Pantera L      15.8   8 351.0 264 4.22 3.170 14.50  0  1    5    4
Ferrari Dino        19.7   6 145.0 175 3.62 2.770 15.50  0  1    5    6
Maserati Bora       15.0   8 301.0 335 3.54 3.570 14.60  0  1    5    8
Volvo 142E          21.4   4 121.0 109 4.11 2.780 18.60  1  1    4    2</code></pre>
</div>
</div>
<ul>
<li>Save the script: <em>File</em> &gt; <em>Save As</em>, select your required destination folder, and enter any filename that you like, provided that it ends with the file extension <em>.R</em>
</li>
</ul>
<p>An <em>R Notebook</em> is an R Markdown document with descriptive text and code chunks that can be executed independently and interactively, with output visible immediately beneath a code chunk - see <span class="citation" data-cites="Xie_et_al_2019_book">Xie, Allaire, and Grolemund (<a href="references.html#ref-Xie_et_al_2019_book" role="doc-biblioref">2019</a>)</span>.</p>
<p>To create an R Notebook, you need to:</p>
<ul>
<li>Open a new script file: <em>File</em> &gt; <em>New File</em> &gt; <em>R Notebook</em>
</li>
</ul>
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="figs/ch2/rnotebook_yaml.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">Fig. 2. YAML metadata for notebooks.</figcaption><p></p>
</figure>
</div>
<ul>
<li>Insert code chunks, either:</li>
</ul>
<ol type="1">
<li>use the <em>Insert</em> command on the editor toolbar;</li>
<li>use the keyboard shortcut <em>Ctrl + Alt + I</em> or <em>Cmd + Option + I</em> (Mac); or,</li>
<li>type the chunk delimiters <code>```{r}</code> and <code>```</code>
</li>
</ol>
<p>In a chunk code you can produce text output, tables, graphics and write code! You can control these outputs via chunk options which are provided inside the curly brackets eg.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="figs/ch2/codechunk.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">Fig. 3. Code chunk example. Details on the various options: https://rmarkdown.rstudio.com/lesson-3.html</figcaption><p></p>
</figure>
</div>
<ul>
<li><p>Execute code: hit <em>“Run Current Chunk”</em>, <em>Ctrl + Shift + Enter</em> or <em>Cmd + Shift + Enter</em> (Mac)</p></li>
<li><p>Save an R notebook: <em>File</em> &gt; <em>Save As</em>. A notebook has a <code>*.Rmd</code> extension and when it is saved a <code>*.nb.html</code> file is automatically created. The latter is a self-contained HTML file which contains both a rendered copy of the notebook with all current chunk outputs and a copy of the *.Rmd file itself.</p></li>
</ul>
<p>Rstudio also offers a <em>Preview</em> option on the toolbar which can be used to create pdf, html and word versions of the notebook. To do this, choose from the drop-down list menu <code>knit to ...</code></p>
<p>For this module, we will be using computational notebooks through <a href="https://quarto.org">Quarto</a>; that is, <em>Quarto Document</em>. <em>“Quarto is a multi-language, next generation version of R Markdown from RStudio, with many new new features and capabilities. Like R Markdown, Quarto uses Knitr to execute R code, and is therefore able to render most existing Rmd files without modification.”</em></p>
<p>To create a Quarto Document, you need to:</p>
<ul>
<li>Open a new script file: <em>File</em> &gt; <em>New File</em> &gt; <em>Quarto Document</em>
</li>
</ul>
<p>Quarto Documents work in the same way as R Notebooks with small variations. You find a comprehensive guide on the <a href="https://quarto.org/docs/guide/">Quarto website</a>.</p>
</section><section id="getting-help" class="level2" data-number="3.5"><h2 data-number="3.5" class="anchored" data-anchor-id="getting-help">
<span class="header-section-number">3.5</span> Getting Help</h2>
<p>You can use <code>help</code> or <code>?</code> to ask for details for a specific function:</p>
<div class="cell">
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/help.html">help</a></span><span class="op">(</span><span class="va">sqrt</span><span class="op">)</span> <span class="co">#or ?sqrt</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>And using <code>example</code> provides examples for said function:</p>
<div class="cell" data-fig.margin="true">
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/example.html">example</a></span><span class="op">(</span><span class="va">sqrt</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
sqrt&gt; require(stats) # for spline

sqrt&gt; require(graphics)

sqrt&gt; xx &lt;- -9:9

sqrt&gt; plot(xx, sqrt(abs(xx)),  col = "red")</code></pre>
</div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="02-spatial-data-wrangling_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid figure-img" width="672"></p>
<p></p><figcaption class="figure-caption">Example sqrt</figcaption><p></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
sqrt&gt; lines(spline(xx, sqrt(abs(xx)), n=101), col = "pink")</code></pre>
</div>
</div>
</section><section id="variables-and-objects" class="level2" data-number="3.6"><h2 data-number="3.6" class="anchored" data-anchor-id="variables-and-objects">
<span class="header-section-number">3.6</span> Variables and objects</h2>
<p>An <em>object</em> is a data structure having attributes and methods. In fact, everything in R is an object!</p>
<p>A <em>variable</em> is a type of data object. Data objects also include list, vector, matrices and text.</p>
<ul>
<li>Creating a data object</li>
</ul>
<p>In R a variable can be created by using the symbol <code>&lt;-</code> to assign a value to a variable name. The variable name is entered on the left <code>&lt;-</code> and the value on the right. Note: Data objects can be given any name, provided that they start with a letter of the alphabet, and include only letters of the alphabet, numbers and the characters <code>.</code> and <code>_</code>. Hence AgeGroup, Age_Group and Age.Group are all valid names for an R data object. Note also that R is case-sensitive, to agegroup and AgeGroup would be treated as different data objects.</p>
<p>To save the value <em>28</em> to a variable (data object) labelled <em>age</em>, run the code:</p>
<div class="cell">
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">age</span> <span class="op">&lt;-</span> <span class="fl">28</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>Inspecting a data object</li>
</ul>
<p>To inspect the contents of the data object <em>age</em> run the following line of code:</p>
<div class="cell">
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">age</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 28</code></pre>
</div>
</div>
<p>Find out what kind (class) of data object <em>age</em> is using:</p>
<div class="cell">
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/class.html">class</a></span><span class="op">(</span><span class="va">age</span><span class="op">)</span> </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "numeric"</code></pre>
</div>
</div>
<p>Inspect the structure of the <em>age</em> data object:</p>
<div class="cell">
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span><span class="op">(</span><span class="va">age</span><span class="op">)</span> </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> num 28</code></pre>
</div>
</div>
<ul>
<li>The <em>vector</em> data object</li>
</ul>
<p>What if we have more than one response? We can use the <code><a href="https://rdrr.io/r/base/c.html">c( )</a></code> function to combine multiple values into one data vector object:</p>
<div class="cell">
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">age</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">28</span>, <span class="fl">36</span>, <span class="fl">25</span>, <span class="fl">24</span>, <span class="fl">32</span><span class="op">)</span></span>
<span><span class="va">age</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 28 36 25 24 32</code></pre>
</div>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/class.html">class</a></span><span class="op">(</span><span class="va">age</span><span class="op">)</span> <span class="co">#Still numeric..</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "numeric"</code></pre>
</div>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span><span class="op">(</span><span class="va">age</span><span class="op">)</span> <span class="co">#..but now a vector (set) of 5 separate values</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> num [1:5] 28 36 25 24 32</code></pre>
</div>
</div>
<p>Note that on each line in the code above any text following the <code>#</code> character is ignored by R when executing the code. Instead, text following a <code>#</code> can be used to add comments to the code to make clear what the code is doing. Two marks of good code are a clear layout and clear commentary on the code.</p>
<section id="basic-data-types" class="level3" data-number="3.6.1"><h3 data-number="3.6.1" class="anchored" data-anchor-id="basic-data-types">
<span class="header-section-number">3.6.1</span> Basic Data Types</h3>
<p>There are a number of data types. Four are the most common. In R, <strong>numeric</strong> is the default type for numbers. It stores all numbers as floating-point numbers (numbers with decimals). This is because most statistical calculations deal with numbers with up to two decimals.</p>
<ul>
<li>Numeric</li>
</ul>
<div class="cell">
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">num</span> <span class="op">&lt;-</span> <span class="fl">4.5</span> <span class="co"># Decimal values</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/class.html">class</a></span><span class="op">(</span><span class="va">num</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "numeric"</code></pre>
</div>
</div>
<ul>
<li>Integer</li>
</ul>
<div class="cell">
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">int</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html">as.integer</a></span><span class="op">(</span><span class="fl">4</span><span class="op">)</span> <span class="co"># Natural numbers. Note integers are also numerics.</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/class.html">class</a></span><span class="op">(</span><span class="va">int</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "integer"</code></pre>
</div>
</div>
<ul>
<li>Character</li>
</ul>
<div class="cell">
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">cha</span> <span class="op">&lt;-</span> <span class="st">"are you enjoying this?"</span> <span class="co"># text or string. You can also type `as.character("are you enjoying this?")`</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/class.html">class</a></span><span class="op">(</span><span class="va">cha</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "character"</code></pre>
</div>
</div>
<ul>
<li>Logical</li>
</ul>
<div class="cell">
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">log</span> <span class="op">&lt;-</span> <span class="fl">2</span> <span class="op">&lt;</span> <span class="fl">1</span> <span class="co"># assigns TRUE or FALSE. In this case, FALSE as 2 is greater than 1</span></span>
<span><span class="va">log</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] FALSE</code></pre>
</div>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/class.html">class</a></span><span class="op">(</span><span class="va">log</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "logical"</code></pre>
</div>
</div>
</section><section id="random-variables" class="level3" data-number="3.6.2"><h3 data-number="3.6.2" class="anchored" data-anchor-id="random-variables">
<span class="header-section-number">3.6.2</span> Random Variables</h3>
<p>In statistics, we differentiate between data to capture:</p>
<ul>
<li>
<p><em>Qualitative attributes</em> categorise objects eg.gender, marital status. To measure these attributes, we use <em>Categorical</em> data which can be divided into:</p>
<ul>
<li>
<em>Nominal</em> data in categories that have no inherent order eg. gender</li>
<li>
<em>Ordinal</em> data in categories that have an inherent order eg. income bands</li>
</ul>
</li>
<li>
<p><em>Quantitative attributes</em>:</p>
<ul>
<li>
<em>Discrete</em> data: count objects of a certain category eg. number of kids, cars</li>
<li>
<em>Continuous</em> data: precise numeric measures eg. weight, income, length.</li>
</ul>
</li>
</ul>
<p>In R these three types of random variables are represented by the following types of R data object:</p>
<div class="cell" data-fig.fullwidth="false" data-fig.margin="false">
<div class="cell-output-display">

<table>
<thead><tr>
<th style="text-align:left;">
variables
</th>
<th style="text-align:left;">
objects
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
nominal
</td>
<td style="text-align:left;">
factor
</td>
</tr>
<tr>
<td style="text-align:left;">
ordinal
</td>
<td style="text-align:left;">
ordered factor
</td>
</tr>
<tr>
<td style="text-align:left;">
discrete
</td>
<td style="text-align:left;">
numeric
</td>
</tr>
<tr>
<td style="text-align:left;">
continuous
</td>
<td style="text-align:left;">
numeric
</td>
</tr>
</tbody>
</table>
<p>Survey and R data types</p>
</div>
</div>
<p>We have already encountered the R data type <em>numeric</em>. The next section introduces the <em>factor</em> data type.</p>
<section id="factor" class="level4" data-number="3.6.2.1"><h4 data-number="3.6.2.1" class="anchored" data-anchor-id="factor">
<span class="header-section-number">3.6.2.1</span> Factor</h4>
<p><strong>What is a factor?</strong></p>
<p>A factor variable assigns a numeric code to each possible category (<em>level</em>) in a variable. Behind the scenes, R stores the variable using these numeric codes to save space and speed up computing. For example, compare the size of a list of <code>10,000</code> <em>males</em> and <em>females</em> to a list of <code>10,000</code> <code>1s</code> and <code>0s</code>. At the same time R also saves the category names associated with each numeric code (level). These are used for display purposes.</p>
<p>For example, the variable <em>gender</em>, converted to a factor, would be stored as a series of <code>1s</code> and <code>2s</code>, where <code>1 = female</code> and <code>2 = male</code>; but would be displayed in all outputs using their category labels of <em>female</em> and <em>male</em>.</p>
<p><strong>Creating a factor</strong></p>
<p>To convert a numeric or character vector into a factor use the <code><a href="https://rdrr.io/r/base/factor.html">factor( )</a></code> function. For instance:</p>
<div class="cell">
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">gender</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"female"</span>,<span class="st">"male"</span>,<span class="st">"male"</span>,<span class="st">"female"</span>,<span class="st">"female"</span><span class="op">)</span> <span class="co"># create a gender variable</span></span>
<span><span class="va">gender</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">gender</span><span class="op">)</span> <span class="co"># replace character vector with a factor version</span></span>
<span><span class="va">gender</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] female male   male   female female
Levels: female male</code></pre>
</div>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/class.html">class</a></span><span class="op">(</span><span class="va">gender</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "factor"</code></pre>
</div>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span><span class="op">(</span><span class="va">gender</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> Factor w/ 2 levels "female","male": 1 2 2 1 1</code></pre>
</div>
</div>
<p>Now <em>gender</em> is a factor and is stored as a series of <code>1s</code> and <code>2s</code>, with <code>1s</code> representing <code>females</code> and <code>2s</code> representing <code>males</code>. The function <code><a href="https://rdrr.io/r/base/levels.html">levels( )</a></code> lists the levels (categories) associated with a given factor variable:</p>
<div class="cell">
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/levels.html">levels</a></span><span class="op">(</span><span class="va">gender</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "female" "male"  </code></pre>
</div>
</div>
<p>The categories are reported in the order that they have been numbered (starting from <code>1</code>). Hence from the output we can infer that <code>females</code> are coded as <code>1</code>, and <code>males</code> as <code>2</code>.</p>
</section></section></section><section id="data-frames" class="level2" data-number="3.7"><h2 data-number="3.7" class="anchored" data-anchor-id="data-frames">
<span class="header-section-number">3.7</span> Data Frames</h2>
<p>R stores different types of data using different types of data structure. Data are normally stored as a <em>data.frame</em>. A data frames contain one row per observation (e.g.&nbsp;wards) and one column per attribute (eg. population and health).</p>
<p>We create three variables wards, population (<code>pop</code>) and people with good health (<code>ghealth</code>). We use 2011 census data counts for total population and good health for wards in Liverpool.</p>
<div class="cell">
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">wards</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Allerton and Hunts Cross"</span>,<span class="st">"Anfield"</span>,<span class="st">"Belle Vale"</span>,<span class="st">"Central"</span>,<span class="st">"Childwall"</span>,<span class="st">"Church"</span>,<span class="st">"Clubmoor"</span>,<span class="st">"County"</span>,<span class="st">"Cressington"</span>,<span class="st">"Croxteth"</span>,<span class="st">"Everton"</span>,<span class="st">"Fazakerley"</span>,<span class="st">"Greenbank"</span>,<span class="st">"Kensington and Fairfield"</span>,<span class="st">"Kirkdale"</span>,<span class="st">"Knotty Ash"</span>,<span class="st">"Mossley Hill"</span>,<span class="st">"Norris Green"</span>,<span class="st">"Old Swan"</span>,<span class="st">"Picton"</span>,<span class="st">"Princes Park"</span>,<span class="st">"Riverside"</span>,<span class="st">"St Michael's"</span>,<span class="st">"Speke-Garston"</span>,<span class="st">"Tuebrook and Stoneycroft"</span>,<span class="st">"Warbreck"</span>,<span class="st">"Wavertree"</span>,<span class="st">"West Derby"</span>,<span class="st">"Woolton"</span>,<span class="st">"Yew Tree"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">pop</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">14853</span>,<span class="fl">14510</span>,<span class="fl">15004</span>,<span class="fl">20340</span>,<span class="fl">13908</span>,<span class="fl">13974</span>,<span class="fl">15272</span>,<span class="fl">14045</span>,<span class="fl">14503</span>,</span>
<span>                <span class="fl">14561</span>,<span class="fl">14782</span>,<span class="fl">16786</span>,<span class="fl">16132</span>,<span class="fl">15377</span>,<span class="fl">16115</span>,<span class="fl">13312</span>,<span class="fl">13816</span>,<span class="fl">15047</span>,</span>
<span>                <span class="fl">16461</span>,<span class="fl">17009</span>,<span class="fl">17104</span>,<span class="fl">18422</span>,<span class="fl">12991</span>,<span class="fl">20300</span>,<span class="fl">16489</span>,<span class="fl">16481</span>,<span class="fl">14772</span>,</span>
<span>                <span class="fl">14382</span>,<span class="fl">12921</span>,<span class="fl">16746</span><span class="op">)</span></span>
<span></span>
<span><span class="va">ghealth</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">7274</span>,<span class="fl">6124</span>,<span class="fl">6129</span>,<span class="fl">11925</span>,<span class="fl">7219</span>,<span class="fl">7461</span>,<span class="fl">6403</span>,<span class="fl">5930</span>,<span class="fl">7094</span>,<span class="fl">6992</span>,</span>
<span>                 <span class="fl">5517</span>,<span class="fl">7879</span>,<span class="fl">8990</span>,<span class="fl">6495</span>,<span class="fl">6662</span>,<span class="fl">5981</span>,<span class="fl">7322</span>,<span class="fl">6529</span>,<span class="fl">7192</span>,<span class="fl">7953</span>,</span>
<span>                 <span class="fl">7636</span>,<span class="fl">9001</span>,<span class="fl">6450</span>,<span class="fl">8973</span>,<span class="fl">7302</span>,<span class="fl">7521</span>,<span class="fl">7268</span>,<span class="fl">7013</span>,<span class="fl">6025</span>,<span class="fl">7717</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Note that <code>pop</code> and <code>ghealth</code> and <code>wards</code> contains characters.</p>
<section id="creating-a-data-frame" class="level3" data-number="3.7.1"><h3 data-number="3.7.1" class="anchored" data-anchor-id="creating-a-data-frame">
<span class="header-section-number">3.7.1</span> Creating A Data Frame</h3>
<p>We can create a data frame and examine its structure:</p>
<div class="cell">
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="va">wards</span>, <span class="va">pop</span>, <span class="va">ghealth</span><span class="op">)</span></span>
<span><span class="va">df</span> <span class="co"># or use view(data)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                      wards   pop ghealth
1  Allerton and Hunts Cross 14853    7274
2                   Anfield 14510    6124
3                Belle Vale 15004    6129
4                   Central 20340   11925
5                 Childwall 13908    7219
6                    Church 13974    7461
7                  Clubmoor 15272    6403
8                    County 14045    5930
9               Cressington 14503    7094
10                 Croxteth 14561    6992
11                  Everton 14782    5517
12               Fazakerley 16786    7879
13                Greenbank 16132    8990
14 Kensington and Fairfield 15377    6495
15                 Kirkdale 16115    6662
16               Knotty Ash 13312    5981
17             Mossley Hill 13816    7322
18             Norris Green 15047    6529
19                 Old Swan 16461    7192
20                   Picton 17009    7953
21             Princes Park 17104    7636
22                Riverside 18422    9001
23             St Michael's 12991    6450
24            Speke-Garston 20300    8973
25 Tuebrook and Stoneycroft 16489    7302
26                 Warbreck 16481    7521
27                Wavertree 14772    7268
28               West Derby 14382    7013
29                  Woolton 12921    6025
30                 Yew Tree 16746    7717</code></pre>
</div>
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span> <span class="co"># or use glimpse(data) </span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>'data.frame':   30 obs. of  3 variables:
 $ wards  : chr  "Allerton and Hunts Cross" "Anfield" "Belle Vale" "Central" ...
 $ pop    : num  14853 14510 15004 20340 13908 ...
 $ ghealth: num  7274 6124 6129 11925 7219 ...</code></pre>
</div>
</div>
</section><section id="referencing-data-frames" class="level3" data-number="3.7.2"><h3 data-number="3.7.2" class="anchored" data-anchor-id="referencing-data-frames">
<span class="header-section-number">3.7.2</span> Referencing Data Frames</h3>
<p>Throughout this module, you will need to refer to particular parts of a dataframe - perhaps a particular column (an area attribute); or a particular subset of respondents. Hence it is worth spending some time now mastering this particular skill.</p>
<p>The relevant R function, <code>[ ]</code>, has the format <code>[row,col]</code> or, more generally, <code>[set of rows, set of cols]</code>.</p>
<p>Run the following commands to get a feel of how to extract different slices of the data:</p>
<div class="cell">
<div class="sourceCode" id="cb47"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">df</span> <span class="co"># whole data.frame</span></span>
<span><span class="va">df</span><span class="op">[</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">]</span> <span class="co"># contents of first row and column</span></span>
<span><span class="va">df</span><span class="op">[</span><span class="fl">2</span>, <span class="fl">2</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span> <span class="co"># contents of the second row, second and third columns</span></span>
<span><span class="va">df</span><span class="op">[</span><span class="fl">1</span>, <span class="op">]</span> <span class="co"># first row, ALL columns [the default if no columns specified]</span></span>
<span><span class="va">df</span><span class="op">[</span> ,<span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">]</span> <span class="co"># ALL rows; first and second columns</span></span>
<span><span class="va">df</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">3</span>,<span class="fl">5</span><span class="op">)</span>, <span class="op">]</span> <span class="co"># rows 1,3,5; ALL columns</span></span>
<span><span class="va">df</span><span class="op">[</span> , <span class="fl">2</span><span class="op">]</span> <span class="co"># ALL rows; second column (by default results containing only </span></span>
<span>             <span class="co">#one column are converted back into a vector)</span></span>
<span><span class="va">df</span><span class="op">[</span> , <span class="fl">2</span>, drop<span class="op">=</span><span class="cn">FALSE</span><span class="op">]</span> <span class="co"># ALL rows; second column (returned as a data.frame)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>In the above, note that we have used two other R functions:</p>
<ul>
<li><p><code>1:3</code> The colon operator tells R to produce a list of numbers including the named start and end points.</p></li>
<li><p><code>c(1,3,5)</code> Tells R to combine the contents within the brackets into one list of objects</p></li>
</ul>
<p>Run both of these fuctions on their own to get a better understanding of what they do.</p>
<p>Three other methods for referencing the contents of a data.frame make direct use of the variable names within the data.frame, which tends to make for easier to read/understand code:</p>
<div class="cell">
<div class="sourceCode" id="cb48"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">df</span><span class="op">[</span>,<span class="st">"pop"</span><span class="op">]</span> <span class="co"># variable name in quotes inside the square brackets</span></span>
<span><span class="va">df</span><span class="op">$</span><span class="va">pop</span> <span class="co"># variable name prefixed with $ and appended to the data.frame name</span></span>
<span><span class="co"># or you can use attach</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/attach.html">attach</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span></span>
<span><span class="va">pop</span> <span class="co"># but be careful if you already have an age variable in your local workspace</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Want to check the variables available, use the <code><a href="https://rdrr.io/r/base/names.html">names( )</a></code>:</p>
<div class="cell">
<div class="sourceCode" id="cb49"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "wards"   "pop"     "ghealth"</code></pre>
</div>
</div>
</section></section><section id="sec_readdata" class="level2" data-number="3.8"><h2 data-number="3.8" class="anchored" data-anchor-id="sec_readdata">
<span class="header-section-number">3.8</span> Read Data</h2>
<p>Ensure your memory is clear</p>
<div class="cell">
<div class="sourceCode" id="cb51"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span><span class="op">(</span>list<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/ls.html">ls</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="co"># rm for targeted deletion / ls for listing all existing objects</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>There are many commands to read / load data onto R. The command to use will depend upon the format they have been saved. Normally they are saved in <em>csv</em> format from Excel or other software packages. So we use either:</p>
<ul>
<li><code>df &lt;- read.table("path/file_name.csv", header = FALSE, sep =",")</code></li>
<li><code>df &lt;- read("path/file_name.csv", header = FALSE)</code></li>
<li><code>df &lt;- read.csv2("path/file_name.csv", header = FALSE)</code></li>
</ul>
<p>To read files in other formats, refer to this useful <a href="https://www.datacamp.com/community/tutorials/r-data-import-tutorial?utm_source=adwords_ppc&amp;utm_campaignid=1655852085&amp;utm_adgroupid=61045434382&amp;utm_device=c&amp;utm_keyword=%2Bread%20%2Bdata%20%2Br&amp;utm_matchtype=b&amp;utm_network=g&amp;utm_adpostion=1t1&amp;utm_creative=318880582308&amp;utm_targetid=kwd-309793905111&amp;utm_loc_interest_ms=&amp;utm_loc_physical_ms=9046551&amp;gclid=CjwKCAiA3uDwBRBFEiwA1VsajJO0QK0Jg7VipIt8_t82qQrnUliI0syAlh8CIxnE76Rb0kh3FbiehxoCzCgQAvD_BwE#csv">DataCamp tutorial</a></p>
<div class="cell">
<div class="sourceCode" id="cb52"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">census</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span><span class="op">(</span><span class="st">"data/census/census_data.csv"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">census</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       code                     ward pop16_74 higher_managerial   pop ghealth
1 E05000886 Allerton and Hunts Cross    10930              1103 14853    7274
2 E05000887                  Anfield    10712               312 14510    6124
3 E05000888               Belle Vale    10987               432 15004    6129
4 E05000889                  Central    19174              1346 20340   11925
5 E05000890                Childwall    10410              1123 13908    7219
6 E05000891                   Church    10569              1843 13974    7461</code></pre>
</div>
<div class="sourceCode" id="cb54"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># NOTE: always ensure your are setting the correct directory leading to the data. </span></span>
<span><span class="co"># It may differ from your existing working directory</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="quickly-inspect-the-data" class="level3" data-number="3.8.1"><h3 data-number="3.8.1" class="anchored" data-anchor-id="quickly-inspect-the-data">
<span class="header-section-number">3.8.1</span> Quickly inspect the data</h3>
<ol type="1">
<li><p>What class?</p></li>
<li><p>What R data types?</p></li>
<li><p>What data types?</p></li>
</ol>
<div class="cell">
<div class="sourceCode" id="cb55"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># 1</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/class.html">class</a></span><span class="op">(</span><span class="va">census</span><span class="op">)</span></span>
<span><span class="co"># 2 &amp; 3</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span><span class="op">(</span><span class="va">census</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Just interested in the variable names:</p>
<div class="cell">
<div class="sourceCode" id="cb56"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">census</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "code"              "ward"              "pop16_74"         
[4] "higher_managerial" "pop"               "ghealth"          </code></pre>
</div>
</div>
<p>or want to view the data:</p>
<p><code>View(census)</code></p>
</section></section><section id="manipulation-data" class="level2" data-number="3.9"><h2 data-number="3.9" class="anchored" data-anchor-id="manipulation-data">
<span class="header-section-number">3.9</span> Manipulation Data</h2>
<section id="adding-new-variables" class="level3" data-number="3.9.1"><h3 data-number="3.9.1" class="anchored" data-anchor-id="adding-new-variables">
<span class="header-section-number">3.9.1</span> Adding New Variables</h3>
<p>Usually you want to add / create new variables to your data frame using existing variables eg. computing percentages by dividing two variables. There are many ways in which you can do this i.e.&nbsp;referecing a data frame as we have done above, or using <code>$</code> (e.g.&nbsp;<code>census$pop</code>). For this module, we’ll use <code>tidyverse</code>:</p>
<div class="cell">
<div class="sourceCode" id="cb58"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">census</span> <span class="op">&lt;-</span> <span class="va">census</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>per_ghealth <span class="op">=</span> <span class="va">ghealth</span> <span class="op">/</span> <span class="va">pop</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Note we used a <em>pipe operator</em> <code>%&gt;%</code>, which helps make the code more efficient and readable - more details, see <span class="citation" data-cites="grolemund_wickham_2019_book">Grolemund and Wickham (<a href="references.html#ref-grolemund_wickham_2019_book" role="doc-biblioref">2019</a>)</span>. When using the pipe operator, recall to first indicate the data frame before <code>%&gt;%</code>.</p>
<p>Note also the use a variable name before the <code>=</code> sign in brackets to indicate the name of the new variable after <code>mutate</code>.</p>
</section><section id="selecting-variables" class="level3" data-number="3.9.2"><h3 data-number="3.9.2" class="anchored" data-anchor-id="selecting-variables">
<span class="header-section-number">3.9.2</span> Selecting Variables</h3>
<p>Usually you want to select a subset of variables for your analysis as storing to large data sets in your R memory can reduce the processing speed of your machine. A selection of data can be achieved by using the <code>select</code> function:</p>
<div class="cell">
<div class="sourceCode" id="cb59"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">ndf</span> <span class="op">&lt;-</span> <span class="va">census</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">ward</span>, <span class="va">pop16_74</span>, <span class="va">per_ghealth</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Again first indicate the data frame and then the variable you want to select to build a new data frame. Note the code chunk above has created a new data frame called <code>ndf</code>. Explore it.</p>
</section><section id="filtering-data" class="level3" data-number="3.9.3"><h3 data-number="3.9.3" class="anchored" data-anchor-id="filtering-data">
<span class="header-section-number">3.9.3</span> Filtering Data</h3>
<p>You may also want to filter values based on defined conditions. You may want to filter observations greater than a certain threshold or only areas within a certain region. For example, you may want to select areas with a percentage of good health population over 50%:</p>
<div class="cell">
<div class="sourceCode" id="cb60"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">ndf2</span> <span class="op">&lt;-</span> <span class="va">census</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">per_ghealth</span> <span class="op">&lt;</span> <span class="fl">0.5</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>You can use more than one variables to set conditions. Use “<code>,</code>” to add a condition.</p>
</section><section id="joining-data-drames" class="level3" data-number="3.9.4"><h3 data-number="3.9.4" class="anchored" data-anchor-id="joining-data-drames">
<span class="header-section-number">3.9.4</span> Joining Data Drames</h3>
<p>When working with spatial data, we often need to join data. To this end, you need a common unique <code>id variable</code>. Let’s say, we want to add a data frame containing census data on households for Liverpool, and join the new attributes to one of the existing data frames in the workspace. First we will read the data frame we want to join (ie. <code>census_data2.csv</code>).</p>
<div class="cell">
<div class="sourceCode" id="cb61"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># read data</span></span>
<span><span class="va">census2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span><span class="op">(</span><span class="st">"data/census/census_data2.csv"</span><span class="op">)</span></span>
<span><span class="co"># visualise data structure</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span><span class="op">(</span><span class="va">census2</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>'data.frame':   30 obs. of  3 variables:
 $ geo_code               : chr  "E05000886" "E05000887" "E05000888" "E05000889" ...
 $ households             : int  6359 6622 6622 7139 5391 5884 6576 6745 6317 6024 ...
 $ socialrented_households: int  827 1508 2818 1311 374 178 2859 1564 1023 1558 ...</code></pre>
</div>
</div>
<p>The variable <code>geo_code</code> in this data frame corresponds to the <code>code</code> in the existing data frame and they are unique so they can be automatically matched by using the <code><a href="https://rdrr.io/pkg/sp/man/merge.html">merge()</a></code> function. The <code><a href="https://rdrr.io/pkg/sp/man/merge.html">merge()</a></code> function uses two arguments: <code>x</code> and <code>y</code>. The former refers to data frame 1 and the latter to data frame 2. Both of these two data frames must have a <code>id</code> variable containing the same information. Note they can have different names. Another key argument to include is <code>all.x=TRUE</code> which tells the function to keep all the records in <code>x</code>, but only those in <code>y</code> that match in case there are discrepancies in the <code>id</code> variable.</p>
<div class="cell">
<div class="sourceCode" id="cb63"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># join data frames</span></span>
<span><span class="va">join_dfs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/sp/man/merge.html">merge</a></span><span class="op">(</span><span class="va">census</span>, <span class="va">census2</span>, by.x<span class="op">=</span><span class="st">"code"</span>, by.y<span class="op">=</span><span class="st">"geo_code"</span>, all.x <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co"># check data</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">join_dfs</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       code                     ward pop16_74 higher_managerial   pop ghealth
1 E05000886 Allerton and Hunts Cross    10930              1103 14853    7274
2 E05000887                  Anfield    10712               312 14510    6124
3 E05000888               Belle Vale    10987               432 15004    6129
4 E05000889                  Central    19174              1346 20340   11925
5 E05000890                Childwall    10410              1123 13908    7219
6 E05000891                   Church    10569              1843 13974    7461
  per_ghealth households socialrented_households
1   0.4897327       6359                     827
2   0.4220538       6622                    1508
3   0.4084911       6622                    2818
4   0.5862832       7139                    1311
5   0.5190538       5391                     374
6   0.5339201       5884                     178</code></pre>
</div>
</div>
</section><section id="saving-data" class="level3" data-number="3.9.5"><h3 data-number="3.9.5" class="anchored" data-anchor-id="saving-data">
<span class="header-section-number">3.9.5</span> Saving Data</h3>
<p>It may also be convinient to save your R projects. They contains all the objects that you have created in your workspace by using the <code><a href="https://rdrr.io/r/base/save.html">save.image( )</a></code> function:</p>
<div class="cell">
<div class="sourceCode" id="cb65"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/save.html">save.image</a></span><span class="op">(</span><span class="st">"week1_envs453.RData"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This creates a file labelled “week1_envs453.RData” in your working directory. You can load this at a later stage using the <code><a href="https://rdrr.io/r/base/load.html">load( )</a></code> function.</p>
<div class="cell">
<div class="sourceCode" id="cb66"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/load.html">load</a></span><span class="op">(</span><span class="st">"week1_envs453.RData"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Alternatively you can save / export your data into a <code>csv</code> file. The first argument in the function is the object name, and the second: the name of the csv we want to create.</p>
<div class="cell">
<div class="sourceCode" id="cb67"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/write.table.html">write.csv</a></span><span class="op">(</span><span class="va">join_dfs</span>, <span class="st">"join_censusdfs.csv"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section></section><section id="using-spatial-data-frames" class="level2" data-number="3.10"><h2 data-number="3.10" class="anchored" data-anchor-id="using-spatial-data-frames">
<span class="header-section-number">3.10</span> Using Spatial Data Frames</h2>
<p>A core area of this module is learning to work with spatial data in R. R has various purposedly designed <strong>packages</strong> for manipulation of spatial data and spatial analysis techniques. Various R packages exist in CRAN eg. <code>spatial</code>, <code>sgeostat</code>, <code>splancs</code>, <code>maptools</code>, <code>tmap</code>, <code>rgdal</code>, <code>spand</code> and more recent development of <code>sf</code> - see <span class="citation" data-cites="lovelace2019">(<a href="references.html#ref-lovelace2019" role="doc-biblioref"><strong>lovelace2019?</strong></a>)</span> for a great description and historical context for some of these packages.</p>
<p>During this session, we will use <code>sf</code>.</p>
<p>We first need to import our spatial data. We will use a shapefile containing data at Output Area (OA) level for Liverpool. These data illustrates the hierarchical structure of spatial data.</p>
<section id="read-spatial-data" class="level3" data-number="3.10.1"><h3 data-number="3.10.1" class="anchored" data-anchor-id="read-spatial-data">
<span class="header-section-number">3.10.1</span> Read Spatial Data</h3>
<div class="cell">
<div class="sourceCode" id="cb68"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">oa_shp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html">st_read</a></span><span class="op">(</span><span class="st">"data/census/Liverpool_OA.shp"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Reading layer `Liverpool_OA' from data source 
  `/Users/franciscorowe/Dropbox/Francisco/Research/sdsm_book/smds/data/census/Liverpool_OA.shp' 
  using driver `ESRI Shapefile'
Simple feature collection with 1584 features and 18 fields
Geometry type: MULTIPOLYGON
Dimension:     XY
Bounding box:  xmin: 332390.2 ymin: 379748.5 xmax: 345636 ymax: 397980.1
Projected CRS: Transverse_Mercator</code></pre>
</div>
</div>
<p>Examine the input data. A spatial data frame stores a range of attributes derived from a shapefile including the <strong>geometry</strong> of features (e.g.&nbsp;polygon shape and location), <strong>attributes</strong> for each feature (stored in the .dbf), <a href="https://en.wikipedia.org/wiki/Map_projection">projection</a> and coordinates of the shapefile’s bounding box - for details, execute:</p>
<div class="cell">
<div class="sourceCode" id="cb70"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="op">?</span><span class="va">st_read</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>You can employ the usual functions to visualise the content of the created data frame:</p>
<div class="cell">
<div class="sourceCode" id="cb71"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># visualise variable names</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">oa_shp</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "OA_CD"    "LSOA_CD"  "MSOA_CD"  "LAD_CD"   "pop"      "H_Vbad"  
 [7] "H_bad"    "H_fair"   "H_good"   "H_Vgood"  "age_men"  "age_med" 
[13] "age_60"   "S_Rent"   "Ethnic"   "illness"  "unemp"    "males"   
[19] "geometry"</code></pre>
</div>
<div class="sourceCode" id="cb73"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># data structure</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span><span class="op">(</span><span class="va">oa_shp</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Classes 'sf' and 'data.frame':  1584 obs. of  19 variables:
 $ OA_CD   : chr  "E00176737" "E00033515" "E00033141" "E00176757" ...
 $ LSOA_CD : chr  "E01033761" "E01006614" "E01006546" "E01006646" ...
 $ MSOA_CD : chr  "E02006932" "E02001358" "E02001365" "E02001369" ...
 $ LAD_CD  : chr  "E08000012" "E08000012" "E08000012" "E08000012" ...
 $ pop     : int  185 281 208 200 321 187 395 320 316 214 ...
 $ H_Vbad  : int  1 2 3 7 4 4 5 9 5 4 ...
 $ H_bad   : int  2 20 10 8 10 25 19 22 25 17 ...
 $ H_fair  : int  9 47 22 17 32 70 42 53 55 39 ...
 $ H_good  : int  53 111 71 52 112 57 131 104 104 53 ...
 $ H_Vgood : int  120 101 102 116 163 31 198 132 127 101 ...
 $ age_men : num  27.9 37.7 37.1 33.7 34.2 ...
 $ age_med : num  25 36 32 29 34 53 23 30 34 29 ...
 $ age_60  : num  0.0108 0.1637 0.1971 0.1 0.1402 ...
 $ S_Rent  : num  0.0526 0.176 0.0235 0.2222 0.0222 ...
 $ Ethnic  : num  0.3514 0.0463 0.0192 0.215 0.0779 ...
 $ illness : int  185 281 208 200 321 187 395 320 316 214 ...
 $ unemp   : num  0.0438 0.121 0.1121 0.036 0.0743 ...
 $ males   : int  122 128 95 120 158 123 207 164 157 94 ...
 $ geometry:sfc_MULTIPOLYGON of length 1584; first list element: List of 1
  ..$ :List of 1
  .. ..$ : num [1:14, 1:2] 335106 335130 335164 335173 335185 ...
  ..- attr(*, "class")= chr [1:3] "XY" "MULTIPOLYGON" "sfg"
 - attr(*, "sf_column")= chr "geometry"
 - attr(*, "agr")= Factor w/ 3 levels "constant","aggregate",..: NA NA NA NA NA NA NA NA NA NA ...
  ..- attr(*, "names")= chr [1:18] "OA_CD" "LSOA_CD" "MSOA_CD" "LAD_CD" ...</code></pre>
</div>
<div class="sourceCode" id="cb75"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># see first few observations</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">oa_shp</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Simple feature collection with 6 features and 18 fields
Geometry type: MULTIPOLYGON
Dimension:     XY
Bounding box:  xmin: 335071.6 ymin: 389876.7 xmax: 339426.9 ymax: 394479
Projected CRS: Transverse_Mercator
      OA_CD   LSOA_CD   MSOA_CD    LAD_CD pop H_Vbad H_bad H_fair H_good
1 E00176737 E01033761 E02006932 E08000012 185      1     2      9     53
2 E00033515 E01006614 E02001358 E08000012 281      2    20     47    111
3 E00033141 E01006546 E02001365 E08000012 208      3    10     22     71
4 E00176757 E01006646 E02001369 E08000012 200      7     8     17     52
5 E00034050 E01006712 E02001375 E08000012 321      4    10     32    112
6 E00034280 E01006761 E02001366 E08000012 187      4    25     70     57
  H_Vgood  age_men age_med     age_60     S_Rent     Ethnic illness      unemp
1     120 27.94054      25 0.01081081 0.05263158 0.35135135     185 0.04379562
2     101 37.71174      36 0.16370107 0.17600000 0.04626335     281 0.12101911
3     102 37.08173      32 0.19711538 0.02352941 0.01923077     208 0.11214953
4     116 33.73000      29 0.10000000 0.22222222 0.21500000     200 0.03597122
5     163 34.19003      34 0.14018692 0.02222222 0.07788162     321 0.07428571
6      31 56.09091      53 0.44919786 0.88524590 0.11764706     187 0.44615385
  males                       geometry
1   122 MULTIPOLYGON (((335106.3 38...
2   128 MULTIPOLYGON (((335810.5 39...
3    95 MULTIPOLYGON (((336738 3931...
4   120 MULTIPOLYGON (((335914.5 39...
5   158 MULTIPOLYGON (((339325 3914...
6   123 MULTIPOLYGON (((338198.1 39...</code></pre>
</div>
</div>
<p><strong>TASK:</strong></p>
<ul>
<li>What are the geographical hierarchy in these data?</li>
<li>What is the smallest geography?</li>
<li>What is the largest geography?</li>
</ul></section><section id="basic-mapping" class="level3" data-number="3.10.2"><h3 data-number="3.10.2" class="anchored" data-anchor-id="basic-mapping">
<span class="header-section-number">3.10.2</span> Basic Mapping</h3>
<p>Again, many functions exist in CRAN for creating maps:</p>
<ul>
<li>
<code>plot</code> to create static maps</li>
<li>
<code>tmap</code> to create static and interactive maps</li>
<li>
<code>leaflet</code> to create interactive maps</li>
<li>
<code>mapview</code> to create interactive maps</li>
<li>
<code>ggplot2</code> to create data visualisations, including static maps</li>
<li>
<code>shiny</code> to create web applications, including maps</li>
</ul>
<p>Here this notebook demonstrates the use of <code>plot</code> and <code>tmap</code>. First <code>plot</code> is used to map the spatial distribution of non-British-born population in Liverpool. First we only map the geometries on the right,</p>
<section id="using-plot" class="level4" data-number="3.10.2.1"><h4 data-number="3.10.2.1" class="anchored" data-anchor-id="using-plot">
<span class="header-section-number">3.10.2.1</span> Using <code>plot</code>
</h4>
<div class="cell" data-fig.margin="true">
<div class="sourceCode" id="cb77"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># mapping geometry</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html">st_geometry</a></span><span class="op">(</span><span class="va">oa_shp</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="02-spatial-data-wrangling_files/figure-html/unnamed-chunk-40-1.png" class="img-fluid figure-img" width="672"></p>
<p></p><figcaption class="figure-caption">OAs of Livepool</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>and then:</p>
<div class="cell">
<div class="sourceCode" id="cb78"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># map attributes, adding intervals</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">oa_shp</span><span class="op">[</span><span class="st">"Ethnic"</span><span class="op">]</span>, key.pos <span class="op">=</span> <span class="fl">4</span>, axes <span class="op">=</span> <span class="cn">TRUE</span>, key.width <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/graphics/layout.html">lcm</a></span><span class="op">(</span><span class="fl">1.3</span><span class="op">)</span>, key.length <span class="op">=</span> <span class="fl">1.</span>,</span>
<span>     breaks <span class="op">=</span> <span class="st">"jenks"</span>, lwd <span class="op">=</span> <span class="fl">0.1</span>, border <span class="op">=</span> <span class="st">'grey'</span><span class="op">)</span> </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="02-spatial-data-wrangling_files/figure-html/unnamed-chunk-41-1.png" class="img-fluid figure-img" width="672"></p>
<p></p><figcaption class="figure-caption">Spatial distribution of ethnic groups, Liverpool</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p><strong>TASK:</strong></p>
<ul>
<li>What is the key pattern emerging from this map?</li>
</ul></section><section id="using-tmap" class="level4" data-number="3.10.2.2"><h4 data-number="3.10.2.2" class="anchored" data-anchor-id="using-tmap">
<span class="header-section-number">3.10.2.2</span> Using <code>tmap</code>
</h4>
<p>Similar to <code>ggplot2</code>, <code>tmap</code> is based on the idea of a ‘grammar of graphics’ which involves a separation between the input data and aesthetics (i.e.&nbsp;the way data are visualised). Each data set can be mapped in various different ways, including location as defined by its geometry, colour and other features. The basic building block is <code><a href="https://rdrr.io/pkg/tmap/man/tm_shape.html">tm_shape()</a></code> (which defines input data), followed by one or more layer elements such as <code><a href="https://rdrr.io/pkg/tmap/man/tm_polygons.html">tm_fill()</a></code> and <code><a href="https://rdrr.io/pkg/tmap/man/tm_symbols.html">tm_dots()</a></code>.</p>
<div class="cell">
<div class="sourceCode" id="cb79"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># ensure geometry is valid</span></span>
<span><span class="va">oa_shp</span> <span class="op">=</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/valid.html">st_make_valid</a></span><span class="op">(</span><span class="va">oa_shp</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># map</span></span>
<span><span class="va">legend_title</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html">expression</a></span><span class="op">(</span><span class="st">"% ethnic pop."</span><span class="op">)</span></span>
<span><span class="va">map_oa</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_shape.html">tm_shape</a></span><span class="op">(</span><span class="va">oa_shp</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_polygons.html">tm_fill</a></span><span class="op">(</span>col <span class="op">=</span> <span class="st">"Ethnic"</span>, title <span class="op">=</span> <span class="va">legend_title</span>, palette <span class="op">=</span> <span class="fu"><a href="https://sjmgarnier.github.io/viridisLite/reference/viridis.html">magma</a></span><span class="op">(</span><span class="fl">256</span><span class="op">)</span>, style <span class="op">=</span> <span class="st">"cont"</span><span class="op">)</span> <span class="op">+</span> <span class="co"># add fill</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_polygons.html">tm_borders</a></span><span class="op">(</span>col <span class="op">=</span> <span class="st">"white"</span>, lwd <span class="op">=</span> <span class="fl">.01</span><span class="op">)</span>  <span class="op">+</span> <span class="co"># add borders</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_compass.html">tm_compass</a></span><span class="op">(</span>type <span class="op">=</span> <span class="st">"arrow"</span>, position <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"right"</span>, <span class="st">"top"</span><span class="op">)</span> , size <span class="op">=</span> <span class="fl">4</span><span class="op">)</span> <span class="op">+</span> <span class="co"># add compass</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_scale_bar.html">tm_scale_bar</a></span><span class="op">(</span>breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span>, text.size <span class="op">=</span> <span class="fl">0.5</span>, position <span class="op">=</span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"center"</span>, <span class="st">"bottom"</span><span class="op">)</span><span class="op">)</span> <span class="co"># add scale bar</span></span>
<span><span class="va">map_oa</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="02-spatial-data-wrangling_files/figure-html/unnamed-chunk-42-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Note that the operation <code>+</code> is used to add new layers. You can set style themes by <code>tm_style</code>. To visualise the existing styles use <code><a href="https://rdrr.io/pkg/tmap/man/tmap_style_catalogue.html">tmap_style_catalogue()</a></code>, and you can also evaluate the code chunk below if you would like to create an interactive map.</p>
<div class="cell">
<div class="sourceCode" id="cb80"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tmap_mode.html">tmap_mode</a></span><span class="op">(</span><span class="st">"view"</span><span class="op">)</span></span>
<span><span class="va">map_oa</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>TASK:</strong></p>
<ul>
<li>Try mapping other variables in the spatial data frame. Where do population aged 60 and over concentrate?</li>
</ul></section></section><section id="comparing-geographies" class="level3" data-number="3.10.3"><h3 data-number="3.10.3" class="anchored" data-anchor-id="comparing-geographies">
<span class="header-section-number">3.10.3</span> Comparing geographies</h3>
<p>If you recall, one of the key issues of working with spatial data is the modifiable area unit problem (MAUP) - see lecture notes. To get a sense of the effects of MAUP, we analyse differences in the spatial patterns of the ethnic population in Liverpool between Middle Layer Super Output Areas (MSOAs) and OAs. So we map these geographies together.</p>
<div class="cell">
<div class="sourceCode" id="cb81"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># read data at the msoa level</span></span>
<span><span class="va">msoa_shp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html">st_read</a></span><span class="op">(</span><span class="st">"data/census/Liverpool_MSOA.shp"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Reading layer `Liverpool_MSOA' from data source 
  `/Users/franciscorowe/Dropbox/Francisco/Research/sdsm_book/smds/data/census/Liverpool_MSOA.shp' 
  using driver `ESRI Shapefile'
Simple feature collection with 61 features and 16 fields
Geometry type: MULTIPOLYGON
Dimension:     XY
Bounding box:  xmin: 333086.1 ymin: 381426.3 xmax: 345636 ymax: 397980.1
Projected CRS: Transverse_Mercator</code></pre>
</div>
<div class="sourceCode" id="cb83"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># ensure geometry is valid</span></span>
<span><span class="va">msoa_shp</span> <span class="op">=</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/valid.html">st_make_valid</a></span><span class="op">(</span><span class="va">msoa_shp</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># create a map</span></span>
<span><span class="va">map_msoa</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_shape.html">tm_shape</a></span><span class="op">(</span><span class="va">msoa_shp</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_polygons.html">tm_fill</a></span><span class="op">(</span>col <span class="op">=</span> <span class="st">"Ethnic"</span>, title <span class="op">=</span> <span class="va">legend_title</span>, palette <span class="op">=</span> <span class="fu"><a href="https://sjmgarnier.github.io/viridisLite/reference/viridis.html">magma</a></span><span class="op">(</span><span class="fl">256</span><span class="op">)</span>, style <span class="op">=</span> <span class="st">"cont"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_polygons.html">tm_borders</a></span><span class="op">(</span>col <span class="op">=</span> <span class="st">"white"</span>, lwd <span class="op">=</span> <span class="fl">.01</span><span class="op">)</span>  <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_compass.html">tm_compass</a></span><span class="op">(</span>type <span class="op">=</span> <span class="st">"arrow"</span>, position <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"right"</span>, <span class="st">"top"</span><span class="op">)</span> , size <span class="op">=</span> <span class="fl">4</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_scale_bar.html">tm_scale_bar</a></span><span class="op">(</span>breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span>, text.size <span class="op">=</span> <span class="fl">0.5</span>, position <span class="op">=</span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"center"</span>, <span class="st">"bottom"</span><span class="op">)</span><span class="op">)</span> </span>
<span></span>
<span><span class="co"># arrange maps </span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tmap_arrange.html">tmap_arrange</a></span><span class="op">(</span><span class="va">map_msoa</span>, <span class="va">map_oa</span><span class="op">)</span> </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="02-spatial-data-wrangling_files/figure-html/unnamed-chunk-44-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p><strong>TASK:</strong></p>
<ul>
<li>What differences do you see between OAs and MSOAs?</li>
<li>Can you identify areas of spatial clustering? Where are they?</li>
</ul></section></section><section id="useful-functions" class="level2" data-number="3.11"><h2 data-number="3.11" class="anchored" data-anchor-id="useful-functions">
<span class="header-section-number">3.11</span> Useful Functions</h2>
<table class="table">
<colgroup>
<col style="width: 44%">
<col style="width: 55%">
</colgroup>
<thead><tr class="header">
<th>Function</th>
<th>Description</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>read.csv()</td>
<td>read csv files into data frames</td>
</tr>
<tr class="even">
<td>str()</td>
<td>inspect data structure</td>
</tr>
<tr class="odd">
<td>mutate()</td>
<td>create a new variable</td>
</tr>
<tr class="even">
<td>filter()</td>
<td>filter observations based on variable values</td>
</tr>
<tr class="odd">
<td>%&gt;%</td>
<td>pipe operator - chain operations</td>
</tr>
<tr class="even">
<td>select()</td>
<td>select variables</td>
</tr>
<tr class="odd">
<td>merge()</td>
<td>join dat frames</td>
</tr>
<tr class="even">
<td>st_read</td>
<td>read spatial data (ie. shapefiles)</td>
</tr>
<tr class="odd">
<td>plot()</td>
<td>create a map based a spatial data set</td>
</tr>
<tr class="even">
<td>tm_shape(), tm_fill(), tm_borders()</td>
<td>create a map using tmap functions</td>
</tr>
<tr class="odd">
<td>tm_arrange</td>
<td>display multiple maps in a single “metaplot”</td>
</tr>
</tbody>
</table>


<!-- -->

<div id="refs" class="references csl-bib-body hanging-indent" role="doc-bibliography" style="display: none">
<div id="ref-grolemund_wickham_2019_book" class="csl-entry" role="doc-biblioentry">
Grolemund, Garrett, and Hadley Wickham. 2019. <em>R for Data Science</em>. O’Reilly, US. <a href="https://r4ds.had.co.nz">https://r4ds.had.co.nz</a>.
</div>
<div id="ref-envs450_2018" class="csl-entry" role="doc-biblioentry">
Williamson, Paul. 2018. <span>“Survey Analysis.”</span>
</div>
<div id="ref-Xie_et_al_2019_book" class="csl-entry" role="doc-biblioentry">
Xie, Yihui, JJ Allaire, and Garrett Grolemund. 2019. <em>R Markdown: The Definitive Guide</em>. CRC Press, Taylor &amp; Francis, Chapman &amp; Hall Book. <a href="https://bookdown.org/yihui/rmarkdown/">https://bookdown.org/yihui/rmarkdown/</a>.
</div>
</div>
</section></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><nav class="page-navigation"><div class="nav-page nav-page-previous">
      <a href="./01-embedding-space.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Embedding space</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./03-points.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Point data analysis</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb84" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a><span class="fu"># Spatial data wrangling</span></span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-3"><a href="#cb84-3" aria-hidden="true" tabindex="-1"></a>This chapter<span class="ot">[^03-data-wrangling-1]</span> introduces computational notebooks, basic functions and data types. These are all important concepts that we will use during the module.</span>
<span id="cb84-4"><a href="#cb84-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-5"><a href="#cb84-5" aria-hidden="true" tabindex="-1"></a><span class="ot">[^03-data-wrangling-1]: </span>This chapter is part of <span class="co">[</span><span class="ot">Spatial Analysis Notes</span><span class="co">](index.html)</span> <span class="kw">&lt;a</span> <span class="er">rel</span><span class="ot">=</span><span class="st">"license"</span> <span class="er">href</span><span class="ot">=</span><span class="st">"http://creativecommons.org/licenses/by-nc-sa/4.0/"</span><span class="kw">&gt;&lt;img</span> <span class="er">src</span><span class="ot">=</span><span class="st">"https://i.creativecommons.org/l/by-nc-sa/4.0/88x31.png"</span> <span class="er">alt</span><span class="ot">=</span><span class="st">"Creative Commons License"</span> <span class="er">style</span><span class="ot">=</span><span class="st">"border-width:0"</span><span class="kw">/&gt;&lt;/a&gt;&lt;br</span> <span class="kw">/&gt;</span><span class="co">[</span><span class="ot">Introduction -- R Notebooks + Basic Functions + Data Types</span><span class="co">]</span>{xmlns:dct="http://purl.org/dc/terms/" property="dct:title"} by <span class="kw">&lt;a</span> <span class="er">xmlns:cc</span><span class="ot">=</span><span class="st">"http://creativecommons.org/ns#"</span> <span class="er">href</span><span class="ot">=</span><span class="st">"http://franciscorowe.com"</span> <span class="er">property</span><span class="ot">=</span><span class="st">"cc:attributionName"</span> <span class="er">rel</span><span class="ot">=</span><span class="st">"cc:attributionURL"</span><span class="kw">&gt;</span>Francisco Rowe<span class="kw">&lt;/a&gt;</span> is licensed under a <span class="kw">&lt;a</span> <span class="er">rel</span><span class="ot">=</span><span class="st">"license"</span> <span class="er">href</span><span class="ot">=</span><span class="st">"http://creativecommons.org/licenses/by-nc-sa/4.0/"</span><span class="kw">&gt;</span>Creative Commons Attribution-NonCommercial-ShareAlike 4.0 International License<span class="kw">&lt;/a&gt;</span>.</span>
<span id="cb84-6"><a href="#cb84-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-7"><a href="#cb84-7" aria-hidden="true" tabindex="-1"></a>If you are already familiar with R, R notebooks and data types, you may want to jump to Section <span class="co">[</span><span class="ot">Read Data</span><span class="co">](#sec_readdata)</span> and start from there. This section describes how to read and manipulate data using <span class="in">`sf`</span> and <span class="in">`tidyverse`</span> functions, including <span class="in">`mutate()`</span>, <span class="in">`%&gt;%`</span> (known as pipe operator), <span class="in">`select()`</span>, <span class="in">`filter()`</span> and specific packages and functions how to manipulate spatial data.</span>
<span id="cb84-8"><a href="#cb84-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-9"><a href="#cb84-9" aria-hidden="true" tabindex="-1"></a>The chapter is based on:</span>
<span id="cb84-10"><a href="#cb84-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-11"><a href="#cb84-11" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>@grolemund_wickham_2019_book, this book illustrates key libraries, including tidyverse, and functions for data manipulation in R</span>
<span id="cb84-12"><a href="#cb84-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-13"><a href="#cb84-13" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>@Xie_et_al_2019_book, excellent introduction to R markdown!</span>
<span id="cb84-14"><a href="#cb84-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-15"><a href="#cb84-15" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>@envs450_2018, some examples from the first lecture of ENVS450 are used to explain the various types of random variables.</span>
<span id="cb84-16"><a href="#cb84-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-17"><a href="#cb84-17" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>@lovelace2019, a really good book on handling spatial data and historical background of the evolution of R packages for spatial data analysis.</span>
<span id="cb84-18"><a href="#cb84-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-19"><a href="#cb84-19" aria-hidden="true" tabindex="-1"></a><span class="fu">## Dependencies</span></span>
<span id="cb84-20"><a href="#cb84-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-21"><a href="#cb84-21" aria-hidden="true" tabindex="-1"></a>This tutorial uses the libraries below. Ensure they are installed on your machine<span class="ot">[^03-data-wrangling-2]</span> before loading them executing the following code chunk:</span>
<span id="cb84-22"><a href="#cb84-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-23"><a href="#cb84-23" aria-hidden="true" tabindex="-1"></a><span class="ot">[^03-data-wrangling-2]: </span>You can install package <span class="in">`mypackage`</span> by running the command <span class="in">`install.packages("mypackage")`</span> on the R prompt or through the <span class="in">`Tools --&gt; Install Packages...`</span> menu in RStudio.</span>
<span id="cb84-24"><a href="#cb84-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-25"><a href="#cb84-25" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, message = FALSE}</span></span>
<span id="cb84-26"><a href="#cb84-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Data manipulation, transformation and visualisation</span></span>
<span id="cb84-27"><a href="#cb84-27" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb84-28"><a href="#cb84-28" aria-hidden="true" tabindex="-1"></a><span class="co"># Nice tables</span></span>
<span id="cb84-29"><a href="#cb84-29" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(kableExtra)</span>
<span id="cb84-30"><a href="#cb84-30" aria-hidden="true" tabindex="-1"></a><span class="co"># Simple features (a standardised way to encode vector data ie. points, lines, polygons)</span></span>
<span id="cb84-31"><a href="#cb84-31" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf) </span>
<span id="cb84-32"><a href="#cb84-32" aria-hidden="true" tabindex="-1"></a><span class="co"># Spatial objects conversion</span></span>
<span id="cb84-33"><a href="#cb84-33" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sp) </span>
<span id="cb84-34"><a href="#cb84-34" aria-hidden="true" tabindex="-1"></a><span class="co"># Thematic maps</span></span>
<span id="cb84-35"><a href="#cb84-35" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tmap) </span>
<span id="cb84-36"><a href="#cb84-36" aria-hidden="true" tabindex="-1"></a><span class="co"># Colour palettes</span></span>
<span id="cb84-37"><a href="#cb84-37" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(RColorBrewer) </span>
<span id="cb84-38"><a href="#cb84-38" aria-hidden="true" tabindex="-1"></a><span class="co"># More colour palettes</span></span>
<span id="cb84-39"><a href="#cb84-39" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(viridis)</span>
<span id="cb84-40"><a href="#cb84-40" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb84-41"><a href="#cb84-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-42"><a href="#cb84-42" aria-hidden="true" tabindex="-1"></a><span class="fu">## Introducing R</span></span>
<span id="cb84-43"><a href="#cb84-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-44"><a href="#cb84-44" aria-hidden="true" tabindex="-1"></a>R is a freely available language and environment for statistical computing and graphics which provides a wide variety of statistical and graphical techniques. It has gained widespread use in academia and industry. R offers a wider array of functionality than a traditional statistics package, such as SPSS and is composed of core (base) functionality, and is expandable through libraries hosted on <span class="co">[</span><span class="ot">CRAN</span><span class="co">](https://cran.r-project.org)</span>. CRAN is a network of ftp and web servers around the world that store identical, up-to-date, versions of code and documentation for R.</span>
<span id="cb84-45"><a href="#cb84-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-46"><a href="#cb84-46" aria-hidden="true" tabindex="-1"></a>Commands are sent to R using either the terminal / command line or the R Console which is installed with R on either Windows or OS X. On Linux, there is no equivalent of the console, however, third party solutions exist. On your own machine, R can be installed from <span class="co">[</span><span class="ot">here</span><span class="co">](https://www.r-project.org/)</span>.</span>
<span id="cb84-47"><a href="#cb84-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-48"><a href="#cb84-48" aria-hidden="true" tabindex="-1"></a>Normally RStudio is used to implement R coding. RStudio is an integrated development environment (IDE) for R and provides a more user-friendly front-end to R than the front-end provided with R.</span>
<span id="cb84-49"><a href="#cb84-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-50"><a href="#cb84-50" aria-hidden="true" tabindex="-1"></a>To run R or RStudio, just double click on the R or RStudio icon. Throughout this module, we will be using RStudio:</span>
<span id="cb84-51"><a href="#cb84-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-52"><a href="#cb84-52" aria-hidden="true" tabindex="-1"></a><span class="al">![Fig. 1. RStudio features.](figs/ch2/rstudio_features.png)</span></span>
<span id="cb84-53"><a href="#cb84-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-54"><a href="#cb84-54" aria-hidden="true" tabindex="-1"></a>If you would like to know more about the various features of RStudio, watch this <span class="co">[</span><span class="ot">video</span><span class="co">](https://rstudio.com/products/rstudio/)</span></span>
<span id="cb84-55"><a href="#cb84-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-56"><a href="#cb84-56" aria-hidden="true" tabindex="-1"></a><span class="fu">## Setting the working directory</span></span>
<span id="cb84-57"><a href="#cb84-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-58"><a href="#cb84-58" aria-hidden="true" tabindex="-1"></a>Before we start any analysis, ensure to set the path to the directory where we are working. We can easily do that with <span class="in">`setwd()`</span>. Please replace in the following line the path to the folder where you have placed this file -and where the <span class="in">`data`</span> folder lives.</span>
<span id="cb84-59"><a href="#cb84-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-62"><a href="#cb84-62" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb84-63"><a href="#cb84-63" aria-hidden="true" tabindex="-1"></a><span class="co">#setwd('../data/sar.csv')</span></span>
<span id="cb84-64"><a href="#cb84-64" aria-hidden="true" tabindex="-1"></a><span class="co">#setwd('.')</span></span>
<span id="cb84-65"><a href="#cb84-65" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb84-66"><a href="#cb84-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-67"><a href="#cb84-67" aria-hidden="true" tabindex="-1"></a>Note: It is good practice to not include spaces when naming folders and files. Use *underscores* or *dots*.</span>
<span id="cb84-68"><a href="#cb84-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-69"><a href="#cb84-69" aria-hidden="true" tabindex="-1"></a>You can check your current working directory by typing:</span>
<span id="cb84-70"><a href="#cb84-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-73"><a href="#cb84-73" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb84-74"><a href="#cb84-74" aria-hidden="true" tabindex="-1"></a><span class="fu">getwd</span>()</span>
<span id="cb84-75"><a href="#cb84-75" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb84-76"><a href="#cb84-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-77"><a href="#cb84-77" aria-hidden="true" tabindex="-1"></a><span class="fu">## R Scripts and Computational Notebooks</span></span>
<span id="cb84-78"><a href="#cb84-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-79"><a href="#cb84-79" aria-hidden="true" tabindex="-1"></a>An *R script* is a series of commands that you can execute at one time and help you save time. So you do not repeat the same steps every time you want to execute the same process with different datasets. An R script is just a plain text file with R commands in it.</span>
<span id="cb84-80"><a href="#cb84-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-81"><a href="#cb84-81" aria-hidden="true" tabindex="-1"></a>To create an R script in RStudio, you need to</span>
<span id="cb84-82"><a href="#cb84-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-83"><a href="#cb84-83" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Open a new script file: *File* \&gt; *New File* \&gt; *R Script*</span>
<span id="cb84-84"><a href="#cb84-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-85"><a href="#cb84-85" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Write some code on your new script window by typing eg. <span class="in">`mtcars`</span></span>
<span id="cb84-86"><a href="#cb84-86" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-87"><a href="#cb84-87" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Run the script. Click anywhere on the line of code, then hit *Ctrl + Enter* (Windows) or *Cmd + Enter* (Mac) to run the command or select the code chunk and click *run* on the right-top corner of your script window. If do that, you should get:</span>
<span id="cb84-88"><a href="#cb84-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-91"><a href="#cb84-91" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb84-92"><a href="#cb84-92" aria-hidden="true" tabindex="-1"></a>mtcars</span>
<span id="cb84-93"><a href="#cb84-93" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb84-94"><a href="#cb84-94" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-95"><a href="#cb84-95" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Save the script: *File* \&gt; *Save As*, select your required destination folder, and enter any filename that you like, provided that it ends with the file extension *.R*</span>
<span id="cb84-96"><a href="#cb84-96" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-97"><a href="#cb84-97" aria-hidden="true" tabindex="-1"></a>An *R Notebook* is an R Markdown document with descriptive text and code chunks that can be executed independently and interactively, with output visible immediately beneath a code chunk - see @Xie_et_al_2019_book.</span>
<span id="cb84-98"><a href="#cb84-98" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-99"><a href="#cb84-99" aria-hidden="true" tabindex="-1"></a>To create an R Notebook, you need to:</span>
<span id="cb84-100"><a href="#cb84-100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-101"><a href="#cb84-101" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Open a new script file: *File* \&gt; *New File* \&gt; *R Notebook*</span>
<span id="cb84-102"><a href="#cb84-102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-103"><a href="#cb84-103" aria-hidden="true" tabindex="-1"></a><span class="al">![Fig. 2. YAML metadata for notebooks.](figs/ch2/rnotebook_yaml.png)</span></span>
<span id="cb84-104"><a href="#cb84-104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-105"><a href="#cb84-105" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Insert code chunks, either:</span>
<span id="cb84-106"><a href="#cb84-106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-107"><a href="#cb84-107" aria-hidden="true" tabindex="-1"></a>1)  use the *Insert* command on the editor toolbar;</span>
<span id="cb84-108"><a href="#cb84-108" aria-hidden="true" tabindex="-1"></a>2)  use the keyboard shortcut *Ctrl + Alt + I* or *Cmd + Option + I* (Mac); or,</span>
<span id="cb84-109"><a href="#cb84-109" aria-hidden="true" tabindex="-1"></a>3)  type the chunk delimiters `<span class="in">``` ```</span>{r} ```` and <span class="in">```` ``` ````</span></span>
<span id="cb84-110"><a href="#cb84-110" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-111"><a href="#cb84-111" aria-hidden="true" tabindex="-1"></a>In a chunk code you can produce text output, tables, graphics and write code! You can control these outputs via chunk options which are provided inside the curly brackets eg.</span>
<span id="cb84-112"><a href="#cb84-112" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-113"><a href="#cb84-113" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, include=FALSE}</span></span>
<span id="cb84-114"><a href="#cb84-114" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(mtcars<span class="sc">$</span>mpg)</span>
<span id="cb84-115"><a href="#cb84-115" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb84-116"><a href="#cb84-116" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-117"><a href="#cb84-117" aria-hidden="true" tabindex="-1"></a><span class="al">![Fig. 3. Code chunk example. Details on the various options: https://rmarkdown.rstudio.com/lesson-3.html](figs/ch2/codechunk.png)</span></span>
<span id="cb84-118"><a href="#cb84-118" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-119"><a href="#cb84-119" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Execute code: hit *"Run Current Chunk"*, *Ctrl + Shift + Enter* or *Cmd + Shift + Enter* (Mac)</span>
<span id="cb84-120"><a href="#cb84-120" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-121"><a href="#cb84-121" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Save an R notebook: *File* \&gt; *Save As*. A notebook has a `*.Rmd` extension and when it is saved a `*.nb.html` file is automatically created. The latter is a self-contained HTML file which contains both a rendered copy of the notebook with all current chunk outputs and a copy of the <span class="sc">\*</span>.Rmd file itself.</span>
<span id="cb84-122"><a href="#cb84-122" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-123"><a href="#cb84-123" aria-hidden="true" tabindex="-1"></a>Rstudio also offers a *Preview* option on the toolbar which can be used to create pdf, html and word versions of the notebook. To do this, choose from the drop-down list menu <span class="in">`knit to ...`</span></span>
<span id="cb84-124"><a href="#cb84-124" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-125"><a href="#cb84-125" aria-hidden="true" tabindex="-1"></a>For this module, we will be using computational notebooks through <span class="co">[</span><span class="ot">Quarto</span><span class="co">](https://quarto.org)</span>; that is, *Quarto Document*. *"Quarto is a multi-language, next generation version of R Markdown from RStudio, with many new new features and capabilities. Like R Markdown, Quarto uses Knitr to execute R code, and is therefore able to render most existing Rmd files without modification."*</span>
<span id="cb84-126"><a href="#cb84-126" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-127"><a href="#cb84-127" aria-hidden="true" tabindex="-1"></a>To create a Quarto Document, you need to:</span>
<span id="cb84-128"><a href="#cb84-128" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-129"><a href="#cb84-129" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Open a new script file: *File* \&gt; *New File* \&gt; *Quarto Document*</span>
<span id="cb84-130"><a href="#cb84-130" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-131"><a href="#cb84-131" aria-hidden="true" tabindex="-1"></a>Quarto Documents work in the same way as R Notebooks with small variations. You find a comprehensive guide on the <span class="co">[</span><span class="ot">Quarto website</span><span class="co">](https://quarto.org/docs/guide/)</span>.</span>
<span id="cb84-132"><a href="#cb84-132" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-133"><a href="#cb84-133" aria-hidden="true" tabindex="-1"></a><span class="fu">## Getting Help</span></span>
<span id="cb84-134"><a href="#cb84-134" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-135"><a href="#cb84-135" aria-hidden="true" tabindex="-1"></a>You can use <span class="in">`help`</span> or <span class="in">`?`</span> to ask for details for a specific function:</span>
<span id="cb84-136"><a href="#cb84-136" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-137"><a href="#cb84-137" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval=FALSE}</span></span>
<span id="cb84-138"><a href="#cb84-138" aria-hidden="true" tabindex="-1"></a><span class="fu">help</span>(sqrt) <span class="co">#or ?sqrt</span></span>
<span id="cb84-139"><a href="#cb84-139" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb84-140"><a href="#cb84-140" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-141"><a href="#cb84-141" aria-hidden="true" tabindex="-1"></a>And using <span class="in">`example`</span> provides examples for said function:</span>
<span id="cb84-142"><a href="#cb84-142" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-143"><a href="#cb84-143" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, fig.margin = TRUE, fig.cap = 'Example sqrt'}</span></span>
<span id="cb84-144"><a href="#cb84-144" aria-hidden="true" tabindex="-1"></a><span class="fu">example</span>(sqrt)</span>
<span id="cb84-145"><a href="#cb84-145" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb84-146"><a href="#cb84-146" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-147"><a href="#cb84-147" aria-hidden="true" tabindex="-1"></a><span class="fu">## Variables and objects</span></span>
<span id="cb84-148"><a href="#cb84-148" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-149"><a href="#cb84-149" aria-hidden="true" tabindex="-1"></a>An *object* is a data structure having attributes and methods. In fact, everything in R is an object!</span>
<span id="cb84-150"><a href="#cb84-150" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-151"><a href="#cb84-151" aria-hidden="true" tabindex="-1"></a>A *variable* is a type of data object. Data objects also include list, vector, matrices and text.</span>
<span id="cb84-152"><a href="#cb84-152" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-153"><a href="#cb84-153" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Creating a data object</span>
<span id="cb84-154"><a href="#cb84-154" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-155"><a href="#cb84-155" aria-hidden="true" tabindex="-1"></a>In R a variable can be created by using the symbol <span class="in">`&lt;-`</span> to assign a value to a variable name. The variable name is entered on the left <span class="in">`&lt;-`</span> and the value on the right. Note: Data objects can be given any name, provided that they start with a letter of the alphabet, and include only letters of the alphabet, numbers and the characters <span class="in">`.`</span> and <span class="in">`_`</span>. Hence AgeGroup, Age_Group and Age.Group are all valid names for an R data object. Note also that R is case-sensitive, to agegroup and AgeGroup would be treated as different data objects.</span>
<span id="cb84-156"><a href="#cb84-156" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-157"><a href="#cb84-157" aria-hidden="true" tabindex="-1"></a>To save the value *28* to a variable (data object) labelled *age*, run the code:</span>
<span id="cb84-158"><a href="#cb84-158" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-161"><a href="#cb84-161" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb84-162"><a href="#cb84-162" aria-hidden="true" tabindex="-1"></a>age <span class="ot">&lt;-</span> <span class="dv">28</span></span>
<span id="cb84-163"><a href="#cb84-163" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb84-164"><a href="#cb84-164" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-165"><a href="#cb84-165" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Inspecting a data object</span>
<span id="cb84-166"><a href="#cb84-166" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-167"><a href="#cb84-167" aria-hidden="true" tabindex="-1"></a>To inspect the contents of the data object *age* run the following line of code:</span>
<span id="cb84-168"><a href="#cb84-168" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-171"><a href="#cb84-171" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb84-172"><a href="#cb84-172" aria-hidden="true" tabindex="-1"></a>age</span>
<span id="cb84-173"><a href="#cb84-173" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb84-174"><a href="#cb84-174" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-175"><a href="#cb84-175" aria-hidden="true" tabindex="-1"></a>Find out what kind (class) of data object *age* is using:</span>
<span id="cb84-176"><a href="#cb84-176" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-179"><a href="#cb84-179" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb84-180"><a href="#cb84-180" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(age) </span>
<span id="cb84-181"><a href="#cb84-181" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb84-182"><a href="#cb84-182" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-183"><a href="#cb84-183" aria-hidden="true" tabindex="-1"></a>Inspect the structure of the *age* data object:</span>
<span id="cb84-184"><a href="#cb84-184" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-187"><a href="#cb84-187" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb84-188"><a href="#cb84-188" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(age) </span>
<span id="cb84-189"><a href="#cb84-189" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb84-190"><a href="#cb84-190" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-191"><a href="#cb84-191" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>The *vector* data object</span>
<span id="cb84-192"><a href="#cb84-192" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-193"><a href="#cb84-193" aria-hidden="true" tabindex="-1"></a>What if we have more than one response? We can use the <span class="in">`c( )`</span> function to combine multiple values into one data vector object:</span>
<span id="cb84-194"><a href="#cb84-194" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-197"><a href="#cb84-197" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb84-198"><a href="#cb84-198" aria-hidden="true" tabindex="-1"></a>age <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">28</span>, <span class="dv">36</span>, <span class="dv">25</span>, <span class="dv">24</span>, <span class="dv">32</span>)</span>
<span id="cb84-199"><a href="#cb84-199" aria-hidden="true" tabindex="-1"></a>age</span>
<span id="cb84-200"><a href="#cb84-200" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(age) <span class="co">#Still numeric..</span></span>
<span id="cb84-201"><a href="#cb84-201" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(age) <span class="co">#..but now a vector (set) of 5 separate values</span></span>
<span id="cb84-202"><a href="#cb84-202" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb84-203"><a href="#cb84-203" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-204"><a href="#cb84-204" aria-hidden="true" tabindex="-1"></a>Note that on each line in the code above any text following the <span class="in">`#`</span> character is ignored by R when executing the code. Instead, text following a <span class="in">`#`</span> can be used to add comments to the code to make clear what the code is doing. Two marks of good code are a clear layout and clear commentary on the code.</span>
<span id="cb84-205"><a href="#cb84-205" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-206"><a href="#cb84-206" aria-hidden="true" tabindex="-1"></a><span class="fu">### Basic Data Types</span></span>
<span id="cb84-207"><a href="#cb84-207" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-208"><a href="#cb84-208" aria-hidden="true" tabindex="-1"></a>There are a number of data types. Four are the most common. In R, **numeric** is the default type for numbers. It stores all numbers as floating-point numbers (numbers with decimals). This is because most statistical calculations deal with numbers with up to two decimals.</span>
<span id="cb84-209"><a href="#cb84-209" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-210"><a href="#cb84-210" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Numeric</span>
<span id="cb84-211"><a href="#cb84-211" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-214"><a href="#cb84-214" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb84-215"><a href="#cb84-215" aria-hidden="true" tabindex="-1"></a>num <span class="ot">&lt;-</span> <span class="fl">4.5</span> <span class="co"># Decimal values</span></span>
<span id="cb84-216"><a href="#cb84-216" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(num)</span>
<span id="cb84-217"><a href="#cb84-217" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb84-218"><a href="#cb84-218" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-219"><a href="#cb84-219" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Integer</span>
<span id="cb84-220"><a href="#cb84-220" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-223"><a href="#cb84-223" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb84-224"><a href="#cb84-224" aria-hidden="true" tabindex="-1"></a>int <span class="ot">&lt;-</span> <span class="fu">as.integer</span>(<span class="dv">4</span>) <span class="co"># Natural numbers. Note integers are also numerics.</span></span>
<span id="cb84-225"><a href="#cb84-225" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(int)</span>
<span id="cb84-226"><a href="#cb84-226" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb84-227"><a href="#cb84-227" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-228"><a href="#cb84-228" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Character</span>
<span id="cb84-229"><a href="#cb84-229" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-232"><a href="#cb84-232" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb84-233"><a href="#cb84-233" aria-hidden="true" tabindex="-1"></a>cha <span class="ot">&lt;-</span> <span class="st">"are you enjoying this?"</span> <span class="co"># text or string. You can also type `as.character("are you enjoying this?")`</span></span>
<span id="cb84-234"><a href="#cb84-234" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(cha)</span>
<span id="cb84-235"><a href="#cb84-235" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb84-236"><a href="#cb84-236" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-237"><a href="#cb84-237" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Logical</span>
<span id="cb84-238"><a href="#cb84-238" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-241"><a href="#cb84-241" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb84-242"><a href="#cb84-242" aria-hidden="true" tabindex="-1"></a>log <span class="ot">&lt;-</span> <span class="dv">2</span> <span class="sc">&lt;</span> <span class="dv">1</span> <span class="co"># assigns TRUE or FALSE. In this case, FALSE as 2 is greater than 1</span></span>
<span id="cb84-243"><a href="#cb84-243" aria-hidden="true" tabindex="-1"></a>log</span>
<span id="cb84-244"><a href="#cb84-244" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(log)</span>
<span id="cb84-245"><a href="#cb84-245" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb84-246"><a href="#cb84-246" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-247"><a href="#cb84-247" aria-hidden="true" tabindex="-1"></a><span class="fu">### Random Variables</span></span>
<span id="cb84-248"><a href="#cb84-248" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-249"><a href="#cb84-249" aria-hidden="true" tabindex="-1"></a>In statistics, we differentiate between data to capture:</span>
<span id="cb84-250"><a href="#cb84-250" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-251"><a href="#cb84-251" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>*Qualitative attributes* categorise objects eg.gender, marital status. To measure these attributes, we use *Categorical* data which can be divided into:</span>
<span id="cb84-252"><a href="#cb84-252" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-253"><a href="#cb84-253" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>*Nominal* data in categories that have no inherent order eg. gender</span>
<span id="cb84-254"><a href="#cb84-254" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>*Ordinal* data in categories that have an inherent order eg. income bands</span>
<span id="cb84-255"><a href="#cb84-255" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-256"><a href="#cb84-256" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>*Quantitative attributes*:</span>
<span id="cb84-257"><a href="#cb84-257" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-258"><a href="#cb84-258" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>*Discrete* data: count objects of a certain category eg. number of kids, cars</span>
<span id="cb84-259"><a href="#cb84-259" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>*Continuous* data: precise numeric measures eg. weight, income, length.</span>
<span id="cb84-260"><a href="#cb84-260" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-261"><a href="#cb84-261" aria-hidden="true" tabindex="-1"></a>In R these three types of random variables are represented by the following types of R data object:</span>
<span id="cb84-262"><a href="#cb84-262" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-263"><a href="#cb84-263" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, echo=FALSE, fig.fullwidth = FALSE, fig.margin = FALSE, fig.cap= 'Survey and R data types'}</span></span>
<span id="cb84-264"><a href="#cb84-264" aria-hidden="true" tabindex="-1"></a>text_tbl <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb84-265"><a href="#cb84-265" aria-hidden="true" tabindex="-1"></a>  <span class="at">variables =</span> <span class="fu">c</span>(<span class="st">"nominal"</span>, <span class="st">"ordinal"</span>, <span class="st">"discrete"</span>, <span class="st">"continuous"</span>),</span>
<span id="cb84-266"><a href="#cb84-266" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb84-267"><a href="#cb84-267" aria-hidden="true" tabindex="-1"></a>  <span class="at">objects =</span> <span class="fu">c</span>(<span class="st">"factor"</span>, <span class="st">"ordered factor"</span>, <span class="st">"numeric"</span>, <span class="st">"numeric"</span>)</span>
<span id="cb84-268"><a href="#cb84-268" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb84-269"><a href="#cb84-269" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-270"><a href="#cb84-270" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(text_tbl) </span>
<span id="cb84-271"><a href="#cb84-271" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb84-272"><a href="#cb84-272" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-273"><a href="#cb84-273" aria-hidden="true" tabindex="-1"></a>We have already encountered the R data type *numeric*. The next section introduces the *factor* data type.</span>
<span id="cb84-274"><a href="#cb84-274" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-275"><a href="#cb84-275" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Factor</span></span>
<span id="cb84-276"><a href="#cb84-276" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-277"><a href="#cb84-277" aria-hidden="true" tabindex="-1"></a>**What is a factor?**</span>
<span id="cb84-278"><a href="#cb84-278" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-279"><a href="#cb84-279" aria-hidden="true" tabindex="-1"></a>A factor variable assigns a numeric code to each possible category (*level*) in a variable. Behind the scenes, R stores the variable using these numeric codes to save space and speed up computing. For example, compare the size of a list of `10,000` *males* and *females* to a list of <span class="in">`10,000`</span> <span class="in">`1s`</span> and <span class="in">`0s`</span>. At the same time R also saves the category names associated with each numeric code (level). These are used for display purposes.</span>
<span id="cb84-280"><a href="#cb84-280" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-281"><a href="#cb84-281" aria-hidden="true" tabindex="-1"></a>For example, the variable *gender*, converted to a factor, would be stored as a series of `1s` and `2s`, where `1 = female` and `2 = male`; but would be displayed in all outputs using their category labels of *female* and *male*.</span>
<span id="cb84-282"><a href="#cb84-282" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-283"><a href="#cb84-283" aria-hidden="true" tabindex="-1"></a>**Creating a factor**</span>
<span id="cb84-284"><a href="#cb84-284" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-285"><a href="#cb84-285" aria-hidden="true" tabindex="-1"></a>To convert a numeric or character vector into a factor use the <span class="in">`factor( )`</span> function. For instance:</span>
<span id="cb84-286"><a href="#cb84-286" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-289"><a href="#cb84-289" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb84-290"><a href="#cb84-290" aria-hidden="true" tabindex="-1"></a>gender <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"female"</span>,<span class="st">"male"</span>,<span class="st">"male"</span>,<span class="st">"female"</span>,<span class="st">"female"</span>) <span class="co"># create a gender variable</span></span>
<span id="cb84-291"><a href="#cb84-291" aria-hidden="true" tabindex="-1"></a>gender <span class="ot">&lt;-</span> <span class="fu">factor</span>(gender) <span class="co"># replace character vector with a factor version</span></span>
<span id="cb84-292"><a href="#cb84-292" aria-hidden="true" tabindex="-1"></a>gender</span>
<span id="cb84-293"><a href="#cb84-293" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(gender)</span>
<span id="cb84-294"><a href="#cb84-294" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(gender)</span>
<span id="cb84-295"><a href="#cb84-295" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb84-296"><a href="#cb84-296" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-297"><a href="#cb84-297" aria-hidden="true" tabindex="-1"></a>Now *gender* is a factor and is stored as a series of <span class="in">`1s`</span> and <span class="in">`2s`</span>, with <span class="in">`1s`</span> representing <span class="in">`females`</span> and <span class="in">`2s`</span> representing <span class="in">`males`</span>. The function <span class="in">`levels( )`</span> lists the levels (categories) associated with a given factor variable:</span>
<span id="cb84-298"><a href="#cb84-298" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-301"><a href="#cb84-301" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb84-302"><a href="#cb84-302" aria-hidden="true" tabindex="-1"></a><span class="fu">levels</span>(gender)</span>
<span id="cb84-303"><a href="#cb84-303" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb84-304"><a href="#cb84-304" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-305"><a href="#cb84-305" aria-hidden="true" tabindex="-1"></a>The categories are reported in the order that they have been numbered (starting from <span class="in">`1`</span>). Hence from the output we can infer that <span class="in">`females`</span> are coded as <span class="in">`1`</span>, and <span class="in">`males`</span> as <span class="in">`2`</span>.</span>
<span id="cb84-306"><a href="#cb84-306" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-307"><a href="#cb84-307" aria-hidden="true" tabindex="-1"></a><span class="fu">## Data Frames</span></span>
<span id="cb84-308"><a href="#cb84-308" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-309"><a href="#cb84-309" aria-hidden="true" tabindex="-1"></a>R stores different types of data using different types of data structure. Data are normally stored as a *data.frame*. A data frames contain one row per observation (e.g. wards) and one column per attribute (eg. population and health).</span>
<span id="cb84-310"><a href="#cb84-310" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-311"><a href="#cb84-311" aria-hidden="true" tabindex="-1"></a>We create three variables wards, population (<span class="in">`pop`</span>) and people with good health (<span class="in">`ghealth`</span>). We use 2011 census data counts for total population and good health for wards in Liverpool.</span>
<span id="cb84-312"><a href="#cb84-312" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-313"><a href="#cb84-313" aria-hidden="true" tabindex="-1"></a><span class="in">```{r,results='hide'}</span></span>
<span id="cb84-314"><a href="#cb84-314" aria-hidden="true" tabindex="-1"></a>wards <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Allerton and Hunts Cross"</span>,<span class="st">"Anfield"</span>,<span class="st">"Belle Vale"</span>,<span class="st">"Central"</span>,<span class="st">"Childwall"</span>,<span class="st">"Church"</span>,<span class="st">"Clubmoor"</span>,<span class="st">"County"</span>,<span class="st">"Cressington"</span>,<span class="st">"Croxteth"</span>,<span class="st">"Everton"</span>,<span class="st">"Fazakerley"</span>,<span class="st">"Greenbank"</span>,<span class="st">"Kensington and Fairfield"</span>,<span class="st">"Kirkdale"</span>,<span class="st">"Knotty Ash"</span>,<span class="st">"Mossley Hill"</span>,<span class="st">"Norris Green"</span>,<span class="st">"Old Swan"</span>,<span class="st">"Picton"</span>,<span class="st">"Princes Park"</span>,<span class="st">"Riverside"</span>,<span class="st">"St Michael's"</span>,<span class="st">"Speke-Garston"</span>,<span class="st">"Tuebrook and Stoneycroft"</span>,<span class="st">"Warbreck"</span>,<span class="st">"Wavertree"</span>,<span class="st">"West Derby"</span>,<span class="st">"Woolton"</span>,<span class="st">"Yew Tree"</span>)</span>
<span id="cb84-315"><a href="#cb84-315" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-316"><a href="#cb84-316" aria-hidden="true" tabindex="-1"></a>pop <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">14853</span>,<span class="dv">14510</span>,<span class="dv">15004</span>,<span class="dv">20340</span>,<span class="dv">13908</span>,<span class="dv">13974</span>,<span class="dv">15272</span>,<span class="dv">14045</span>,<span class="dv">14503</span>,</span>
<span id="cb84-317"><a href="#cb84-317" aria-hidden="true" tabindex="-1"></a>                <span class="dv">14561</span>,<span class="dv">14782</span>,<span class="dv">16786</span>,<span class="dv">16132</span>,<span class="dv">15377</span>,<span class="dv">16115</span>,<span class="dv">13312</span>,<span class="dv">13816</span>,<span class="dv">15047</span>,</span>
<span id="cb84-318"><a href="#cb84-318" aria-hidden="true" tabindex="-1"></a>                <span class="dv">16461</span>,<span class="dv">17009</span>,<span class="dv">17104</span>,<span class="dv">18422</span>,<span class="dv">12991</span>,<span class="dv">20300</span>,<span class="dv">16489</span>,<span class="dv">16481</span>,<span class="dv">14772</span>,</span>
<span id="cb84-319"><a href="#cb84-319" aria-hidden="true" tabindex="-1"></a>                <span class="dv">14382</span>,<span class="dv">12921</span>,<span class="dv">16746</span>)</span>
<span id="cb84-320"><a href="#cb84-320" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-321"><a href="#cb84-321" aria-hidden="true" tabindex="-1"></a>ghealth <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">7274</span>,<span class="dv">6124</span>,<span class="dv">6129</span>,<span class="dv">11925</span>,<span class="dv">7219</span>,<span class="dv">7461</span>,<span class="dv">6403</span>,<span class="dv">5930</span>,<span class="dv">7094</span>,<span class="dv">6992</span>,</span>
<span id="cb84-322"><a href="#cb84-322" aria-hidden="true" tabindex="-1"></a>                 <span class="dv">5517</span>,<span class="dv">7879</span>,<span class="dv">8990</span>,<span class="dv">6495</span>,<span class="dv">6662</span>,<span class="dv">5981</span>,<span class="dv">7322</span>,<span class="dv">6529</span>,<span class="dv">7192</span>,<span class="dv">7953</span>,</span>
<span id="cb84-323"><a href="#cb84-323" aria-hidden="true" tabindex="-1"></a>                 <span class="dv">7636</span>,<span class="dv">9001</span>,<span class="dv">6450</span>,<span class="dv">8973</span>,<span class="dv">7302</span>,<span class="dv">7521</span>,<span class="dv">7268</span>,<span class="dv">7013</span>,<span class="dv">6025</span>,<span class="dv">7717</span>)</span>
<span id="cb84-324"><a href="#cb84-324" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb84-325"><a href="#cb84-325" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-326"><a href="#cb84-326" aria-hidden="true" tabindex="-1"></a>Note that <span class="in">`pop`</span> and <span class="in">`ghealth`</span> and <span class="in">`wards`</span> contains characters.</span>
<span id="cb84-327"><a href="#cb84-327" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-328"><a href="#cb84-328" aria-hidden="true" tabindex="-1"></a><span class="fu">### Creating A Data Frame</span></span>
<span id="cb84-329"><a href="#cb84-329" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-330"><a href="#cb84-330" aria-hidden="true" tabindex="-1"></a>We can create a data frame and examine its structure:</span>
<span id="cb84-331"><a href="#cb84-331" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-334"><a href="#cb84-334" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb84-335"><a href="#cb84-335" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(wards, pop, ghealth)</span>
<span id="cb84-336"><a href="#cb84-336" aria-hidden="true" tabindex="-1"></a>df <span class="co"># or use view(data)</span></span>
<span id="cb84-337"><a href="#cb84-337" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(df) <span class="co"># or use glimpse(data) </span></span>
<span id="cb84-338"><a href="#cb84-338" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb84-339"><a href="#cb84-339" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-340"><a href="#cb84-340" aria-hidden="true" tabindex="-1"></a><span class="fu">### Referencing Data Frames</span></span>
<span id="cb84-341"><a href="#cb84-341" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-342"><a href="#cb84-342" aria-hidden="true" tabindex="-1"></a>Throughout this module, you will need to refer to particular parts of a dataframe - perhaps a particular column (an area attribute); or a particular subset of respondents. Hence it is worth spending some time now mastering this particular skill.</span>
<span id="cb84-343"><a href="#cb84-343" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-344"><a href="#cb84-344" aria-hidden="true" tabindex="-1"></a>The relevant R function, <span class="in">`[ ]`</span>, has the format <span class="in">`[row,col]`</span> or, more generally, <span class="in">`[set of rows, set of cols]`</span>.</span>
<span id="cb84-345"><a href="#cb84-345" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-346"><a href="#cb84-346" aria-hidden="true" tabindex="-1"></a>Run the following commands to get a feel of how to extract different slices of the data:</span>
<span id="cb84-347"><a href="#cb84-347" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-348"><a href="#cb84-348" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval=FALSE}</span></span>
<span id="cb84-349"><a href="#cb84-349" aria-hidden="true" tabindex="-1"></a>df <span class="co"># whole data.frame</span></span>
<span id="cb84-350"><a href="#cb84-350" aria-hidden="true" tabindex="-1"></a>df[<span class="dv">1</span>, <span class="dv">1</span>] <span class="co"># contents of first row and column</span></span>
<span id="cb84-351"><a href="#cb84-351" aria-hidden="true" tabindex="-1"></a>df[<span class="dv">2</span>, <span class="dv">2</span><span class="sc">:</span><span class="dv">3</span>] <span class="co"># contents of the second row, second and third columns</span></span>
<span id="cb84-352"><a href="#cb84-352" aria-hidden="true" tabindex="-1"></a>df[<span class="dv">1</span>, ] <span class="co"># first row, ALL columns [the default if no columns specified]</span></span>
<span id="cb84-353"><a href="#cb84-353" aria-hidden="true" tabindex="-1"></a>df[ ,<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>] <span class="co"># ALL rows; first and second columns</span></span>
<span id="cb84-354"><a href="#cb84-354" aria-hidden="true" tabindex="-1"></a>df[<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">3</span>,<span class="dv">5</span>), ] <span class="co"># rows 1,3,5; ALL columns</span></span>
<span id="cb84-355"><a href="#cb84-355" aria-hidden="true" tabindex="-1"></a>df[ , <span class="dv">2</span>] <span class="co"># ALL rows; second column (by default results containing only </span></span>
<span id="cb84-356"><a href="#cb84-356" aria-hidden="true" tabindex="-1"></a>             <span class="co">#one column are converted back into a vector)</span></span>
<span id="cb84-357"><a href="#cb84-357" aria-hidden="true" tabindex="-1"></a>df[ , <span class="dv">2</span>, drop<span class="ot">=</span><span class="cn">FALSE</span>] <span class="co"># ALL rows; second column (returned as a data.frame)</span></span>
<span id="cb84-358"><a href="#cb84-358" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb84-359"><a href="#cb84-359" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-360"><a href="#cb84-360" aria-hidden="true" tabindex="-1"></a>In the above, note that we have used two other R functions:</span>
<span id="cb84-361"><a href="#cb84-361" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-362"><a href="#cb84-362" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="in">`1:3`</span> The colon operator tells R to produce a list of numbers including the named start and end points.</span>
<span id="cb84-363"><a href="#cb84-363" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-364"><a href="#cb84-364" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="in">`c(1,3,5)`</span> Tells R to combine the contents within the brackets into one list of objects</span>
<span id="cb84-365"><a href="#cb84-365" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-366"><a href="#cb84-366" aria-hidden="true" tabindex="-1"></a>Run both of these fuctions on their own to get a better understanding of what they do.</span>
<span id="cb84-367"><a href="#cb84-367" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-368"><a href="#cb84-368" aria-hidden="true" tabindex="-1"></a>Three other methods for referencing the contents of a data.frame make direct use of the variable names within the data.frame, which tends to make for easier to read/understand code:</span>
<span id="cb84-369"><a href="#cb84-369" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-370"><a href="#cb84-370" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval=FALSE}</span></span>
<span id="cb84-371"><a href="#cb84-371" aria-hidden="true" tabindex="-1"></a>df[,<span class="st">"pop"</span>] <span class="co"># variable name in quotes inside the square brackets</span></span>
<span id="cb84-372"><a href="#cb84-372" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>pop <span class="co"># variable name prefixed with $ and appended to the data.frame name</span></span>
<span id="cb84-373"><a href="#cb84-373" aria-hidden="true" tabindex="-1"></a><span class="co"># or you can use attach</span></span>
<span id="cb84-374"><a href="#cb84-374" aria-hidden="true" tabindex="-1"></a><span class="fu">attach</span>(df)</span>
<span id="cb84-375"><a href="#cb84-375" aria-hidden="true" tabindex="-1"></a>pop <span class="co"># but be careful if you already have an age variable in your local workspace</span></span>
<span id="cb84-376"><a href="#cb84-376" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb84-377"><a href="#cb84-377" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-378"><a href="#cb84-378" aria-hidden="true" tabindex="-1"></a>Want to check the variables available, use the <span class="in">`names( )`</span>:</span>
<span id="cb84-379"><a href="#cb84-379" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-382"><a href="#cb84-382" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb84-383"><a href="#cb84-383" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(df)</span>
<span id="cb84-384"><a href="#cb84-384" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb84-385"><a href="#cb84-385" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-386"><a href="#cb84-386" aria-hidden="true" tabindex="-1"></a><span class="fu">## Read Data {#sec_readdata}</span></span>
<span id="cb84-387"><a href="#cb84-387" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-388"><a href="#cb84-388" aria-hidden="true" tabindex="-1"></a>Ensure your memory is clear</span>
<span id="cb84-389"><a href="#cb84-389" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-392"><a href="#cb84-392" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb84-393"><a href="#cb84-393" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list=</span><span class="fu">ls</span>()) <span class="co"># rm for targeted deletion / ls for listing all existing objects</span></span>
<span id="cb84-394"><a href="#cb84-394" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb84-395"><a href="#cb84-395" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-396"><a href="#cb84-396" aria-hidden="true" tabindex="-1"></a>There are many commands to read / load data onto R. The command to use will depend upon the format they have been saved. Normally they are saved in *csv* format from Excel or other software packages. So we use either:</span>
<span id="cb84-397"><a href="#cb84-397" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-398"><a href="#cb84-398" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="in">`df &lt;- read.table("path/file_name.csv", header = FALSE, sep =",")`</span></span>
<span id="cb84-399"><a href="#cb84-399" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="in">`df &lt;- read("path/file_name.csv", header = FALSE)`</span></span>
<span id="cb84-400"><a href="#cb84-400" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="in">`df &lt;- read.csv2("path/file_name.csv", header = FALSE)`</span></span>
<span id="cb84-401"><a href="#cb84-401" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-402"><a href="#cb84-402" aria-hidden="true" tabindex="-1"></a>To read files in other formats, refer to this useful <span class="co">[</span><span class="ot">DataCamp tutorial</span><span class="co">](https://www.datacamp.com/community/tutorials/r-data-import-tutorial?utm_source=adwords_ppc&amp;utm_campaignid=1655852085&amp;utm_adgroupid=61045434382&amp;utm_device=c&amp;utm_keyword=%2Bread%20%2Bdata%20%2Br&amp;utm_matchtype=b&amp;utm_network=g&amp;utm_adpostion=1t1&amp;utm_creative=318880582308&amp;utm_targetid=kwd-309793905111&amp;utm_loc_interest_ms=&amp;utm_loc_physical_ms=9046551&amp;gclid=CjwKCAiA3uDwBRBFEiwA1VsajJO0QK0Jg7VipIt8_t82qQrnUliI0syAlh8CIxnE76Rb0kh3FbiehxoCzCgQAvD_BwE#csv)</span></span>
<span id="cb84-403"><a href="#cb84-403" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-406"><a href="#cb84-406" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb84-407"><a href="#cb84-407" aria-hidden="true" tabindex="-1"></a>census <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"data/census/census_data.csv"</span>)</span>
<span id="cb84-408"><a href="#cb84-408" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(census)</span>
<span id="cb84-409"><a href="#cb84-409" aria-hidden="true" tabindex="-1"></a><span class="co"># </span><span class="al">NOTE</span><span class="co">: always ensure your are setting the correct directory leading to the data. </span></span>
<span id="cb84-410"><a href="#cb84-410" aria-hidden="true" tabindex="-1"></a><span class="co"># It may differ from your existing working directory</span></span>
<span id="cb84-411"><a href="#cb84-411" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb84-412"><a href="#cb84-412" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-413"><a href="#cb84-413" aria-hidden="true" tabindex="-1"></a><span class="fu">### Quickly inspect the data</span></span>
<span id="cb84-414"><a href="#cb84-414" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-415"><a href="#cb84-415" aria-hidden="true" tabindex="-1"></a><span class="ss">1.  </span>What class?</span>
<span id="cb84-416"><a href="#cb84-416" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-417"><a href="#cb84-417" aria-hidden="true" tabindex="-1"></a><span class="ss">2.  </span>What R data types?</span>
<span id="cb84-418"><a href="#cb84-418" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-419"><a href="#cb84-419" aria-hidden="true" tabindex="-1"></a><span class="ss">3.  </span>What data types?</span>
<span id="cb84-420"><a href="#cb84-420" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-421"><a href="#cb84-421" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval=FALSE}</span></span>
<span id="cb84-422"><a href="#cb84-422" aria-hidden="true" tabindex="-1"></a><span class="co"># 1</span></span>
<span id="cb84-423"><a href="#cb84-423" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(census)</span>
<span id="cb84-424"><a href="#cb84-424" aria-hidden="true" tabindex="-1"></a><span class="co"># 2 &amp; 3</span></span>
<span id="cb84-425"><a href="#cb84-425" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(census)</span>
<span id="cb84-426"><a href="#cb84-426" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb84-427"><a href="#cb84-427" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-428"><a href="#cb84-428" aria-hidden="true" tabindex="-1"></a>Just interested in the variable names:</span>
<span id="cb84-429"><a href="#cb84-429" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-432"><a href="#cb84-432" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb84-433"><a href="#cb84-433" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(census)</span>
<span id="cb84-434"><a href="#cb84-434" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb84-435"><a href="#cb84-435" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-436"><a href="#cb84-436" aria-hidden="true" tabindex="-1"></a>or want to view the data:</span>
<span id="cb84-437"><a href="#cb84-437" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-438"><a href="#cb84-438" aria-hidden="true" tabindex="-1"></a><span class="in">`View(census)`</span></span>
<span id="cb84-439"><a href="#cb84-439" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-440"><a href="#cb84-440" aria-hidden="true" tabindex="-1"></a><span class="fu">## Manipulation Data</span></span>
<span id="cb84-441"><a href="#cb84-441" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-442"><a href="#cb84-442" aria-hidden="true" tabindex="-1"></a><span class="fu">### Adding New Variables</span></span>
<span id="cb84-443"><a href="#cb84-443" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-444"><a href="#cb84-444" aria-hidden="true" tabindex="-1"></a>Usually you want to add / create new variables to your data frame using existing variables eg. computing percentages by dividing two variables. There are many ways in which you can do this i.e. referecing a data frame as we have done above, or using <span class="in">`$`</span> (e.g. <span class="in">`census$pop`</span>). For this module, we'll use <span class="in">`tidyverse`</span>:</span>
<span id="cb84-445"><a href="#cb84-445" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-448"><a href="#cb84-448" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb84-449"><a href="#cb84-449" aria-hidden="true" tabindex="-1"></a>census <span class="ot">&lt;-</span> census <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">per_ghealth =</span> ghealth <span class="sc">/</span> pop)</span>
<span id="cb84-450"><a href="#cb84-450" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb84-451"><a href="#cb84-451" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-452"><a href="#cb84-452" aria-hidden="true" tabindex="-1"></a>Note we used a *pipe operator* <span class="in">`%&gt;%`</span>, which helps make the code more efficient and readable - more details, see @grolemund_wickham_2019_book. When using the pipe operator, recall to first indicate the data frame before <span class="in">`%&gt;%`</span>.</span>
<span id="cb84-453"><a href="#cb84-453" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-454"><a href="#cb84-454" aria-hidden="true" tabindex="-1"></a>Note also the use a variable name before the <span class="in">`=`</span> sign in brackets to indicate the name of the new variable after <span class="in">`mutate`</span>.</span>
<span id="cb84-455"><a href="#cb84-455" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-456"><a href="#cb84-456" aria-hidden="true" tabindex="-1"></a><span class="fu">### Selecting Variables</span></span>
<span id="cb84-457"><a href="#cb84-457" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-458"><a href="#cb84-458" aria-hidden="true" tabindex="-1"></a>Usually you want to select a subset of variables for your analysis as storing to large data sets in your R memory can reduce the processing speed of your machine. A selection of data can be achieved by using the <span class="in">`select`</span> function:</span>
<span id="cb84-459"><a href="#cb84-459" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-462"><a href="#cb84-462" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb84-463"><a href="#cb84-463" aria-hidden="true" tabindex="-1"></a>ndf <span class="ot">&lt;-</span> census <span class="sc">%&gt;%</span> <span class="fu">select</span>(ward, pop16_74, per_ghealth)</span>
<span id="cb84-464"><a href="#cb84-464" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb84-465"><a href="#cb84-465" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-466"><a href="#cb84-466" aria-hidden="true" tabindex="-1"></a>Again first indicate the data frame and then the variable you want to select to build a new data frame. Note the code chunk above has created a new data frame called <span class="in">`ndf`</span>. Explore it.</span>
<span id="cb84-467"><a href="#cb84-467" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-468"><a href="#cb84-468" aria-hidden="true" tabindex="-1"></a><span class="fu">### Filtering Data</span></span>
<span id="cb84-469"><a href="#cb84-469" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-470"><a href="#cb84-470" aria-hidden="true" tabindex="-1"></a>You may also want to filter values based on defined conditions. You may want to filter observations greater than a certain threshold or only areas within a certain region. For example, you may want to select areas with a percentage of good health population over 50%:</span>
<span id="cb84-471"><a href="#cb84-471" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-474"><a href="#cb84-474" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb84-475"><a href="#cb84-475" aria-hidden="true" tabindex="-1"></a>ndf2 <span class="ot">&lt;-</span> census <span class="sc">%&gt;%</span> <span class="fu">filter</span>(per_ghealth <span class="sc">&lt;</span> <span class="fl">0.5</span>)</span>
<span id="cb84-476"><a href="#cb84-476" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb84-477"><a href="#cb84-477" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-478"><a href="#cb84-478" aria-hidden="true" tabindex="-1"></a>You can use more than one variables to set conditions. Use "<span class="in">`,`</span>" to add a condition.</span>
<span id="cb84-479"><a href="#cb84-479" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-480"><a href="#cb84-480" aria-hidden="true" tabindex="-1"></a><span class="fu">### Joining Data Drames</span></span>
<span id="cb84-481"><a href="#cb84-481" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-482"><a href="#cb84-482" aria-hidden="true" tabindex="-1"></a>When working with spatial data, we often need to join data. To this end, you need a common unique <span class="in">`id variable`</span>. Let's say, we want to add a data frame containing census data on households for Liverpool, and join the new attributes to one of the existing data frames in the workspace. First we will read the data frame we want to join (ie. <span class="in">`census_data2.csv`</span>).</span>
<span id="cb84-483"><a href="#cb84-483" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-486"><a href="#cb84-486" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb84-487"><a href="#cb84-487" aria-hidden="true" tabindex="-1"></a><span class="co"># read data</span></span>
<span id="cb84-488"><a href="#cb84-488" aria-hidden="true" tabindex="-1"></a>census2 <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"data/census/census_data2.csv"</span>)</span>
<span id="cb84-489"><a href="#cb84-489" aria-hidden="true" tabindex="-1"></a><span class="co"># visualise data structure</span></span>
<span id="cb84-490"><a href="#cb84-490" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(census2)</span>
<span id="cb84-491"><a href="#cb84-491" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb84-492"><a href="#cb84-492" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-493"><a href="#cb84-493" aria-hidden="true" tabindex="-1"></a>The variable <span class="in">`geo_code`</span> in this data frame corresponds to the <span class="in">`code`</span> in the existing data frame and they are unique so they can be automatically matched by using the <span class="in">`merge()`</span> function. The <span class="in">`merge()`</span> function uses two arguments: <span class="in">`x`</span> and <span class="in">`y`</span>. The former refers to data frame 1 and the latter to data frame 2. Both of these two data frames must have a <span class="in">`id`</span> variable containing the same information. Note they can have different names. Another key argument to include is <span class="in">`all.x=TRUE`</span> which tells the function to keep all the records in <span class="in">`x`</span>, but only those in <span class="in">`y`</span> that match in case there are discrepancies in the <span class="in">`id`</span> variable.</span>
<span id="cb84-494"><a href="#cb84-494" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-497"><a href="#cb84-497" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb84-498"><a href="#cb84-498" aria-hidden="true" tabindex="-1"></a><span class="co"># join data frames</span></span>
<span id="cb84-499"><a href="#cb84-499" aria-hidden="true" tabindex="-1"></a>join_dfs <span class="ot">&lt;-</span> <span class="fu">merge</span>(census, census2, <span class="at">by.x=</span><span class="st">"code"</span>, <span class="at">by.y=</span><span class="st">"geo_code"</span>, <span class="at">all.x =</span> <span class="cn">TRUE</span>)</span>
<span id="cb84-500"><a href="#cb84-500" aria-hidden="true" tabindex="-1"></a><span class="co"># check data</span></span>
<span id="cb84-501"><a href="#cb84-501" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(join_dfs)</span>
<span id="cb84-502"><a href="#cb84-502" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb84-503"><a href="#cb84-503" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-504"><a href="#cb84-504" aria-hidden="true" tabindex="-1"></a><span class="fu">### Saving Data</span></span>
<span id="cb84-505"><a href="#cb84-505" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-506"><a href="#cb84-506" aria-hidden="true" tabindex="-1"></a>It may also be convinient to save your R projects. They contains all the objects that you have created in your workspace by using the <span class="in">`save.image( )`</span> function:</span>
<span id="cb84-507"><a href="#cb84-507" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-508"><a href="#cb84-508" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval=FALSE}</span></span>
<span id="cb84-509"><a href="#cb84-509" aria-hidden="true" tabindex="-1"></a><span class="fu">save.image</span>(<span class="st">"week1_envs453.RData"</span>)</span>
<span id="cb84-510"><a href="#cb84-510" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb84-511"><a href="#cb84-511" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-512"><a href="#cb84-512" aria-hidden="true" tabindex="-1"></a>This creates a file labelled "week1_envs453.RData" in your working directory. You can load this at a later stage using the <span class="in">`load( )`</span> function.</span>
<span id="cb84-513"><a href="#cb84-513" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-514"><a href="#cb84-514" aria-hidden="true" tabindex="-1"></a><span class="in">```{r,eval=FALSE}</span></span>
<span id="cb84-515"><a href="#cb84-515" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">"week1_envs453.RData"</span>)</span>
<span id="cb84-516"><a href="#cb84-516" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb84-517"><a href="#cb84-517" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-518"><a href="#cb84-518" aria-hidden="true" tabindex="-1"></a>Alternatively you can save / export your data into a <span class="in">`csv`</span> file. The first argument in the function is the object name, and the second: the name of the csv we want to create.</span>
<span id="cb84-519"><a href="#cb84-519" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-520"><a href="#cb84-520" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval=FALSE}</span></span>
<span id="cb84-521"><a href="#cb84-521" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(join_dfs, <span class="st">"join_censusdfs.csv"</span>)</span>
<span id="cb84-522"><a href="#cb84-522" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb84-523"><a href="#cb84-523" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-524"><a href="#cb84-524" aria-hidden="true" tabindex="-1"></a><span class="fu">## Using Spatial Data Frames</span></span>
<span id="cb84-525"><a href="#cb84-525" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-526"><a href="#cb84-526" aria-hidden="true" tabindex="-1"></a>A core area of this module is learning to work with spatial data in R. R has various purposedly designed **packages** for manipulation of spatial data and spatial analysis techniques. Various R packages exist in CRAN eg. <span class="in">`spatial`</span>, <span class="in">`sgeostat`</span>, <span class="in">`splancs`</span>, <span class="in">`maptools`</span>, <span class="in">`tmap`</span>, <span class="in">`rgdal`</span>, <span class="in">`spand`</span> and more recent development of <span class="in">`sf`</span> - see @lovelace2019 for a great description and historical context for some of these packages.</span>
<span id="cb84-527"><a href="#cb84-527" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-528"><a href="#cb84-528" aria-hidden="true" tabindex="-1"></a>During this session, we will use <span class="in">`sf`</span>.</span>
<span id="cb84-529"><a href="#cb84-529" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-530"><a href="#cb84-530" aria-hidden="true" tabindex="-1"></a>We first need to import our spatial data. We will use a shapefile containing data at Output Area (OA) level for Liverpool. These data illustrates the hierarchical structure of spatial data.</span>
<span id="cb84-531"><a href="#cb84-531" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-532"><a href="#cb84-532" aria-hidden="true" tabindex="-1"></a><span class="fu">### Read Spatial Data</span></span>
<span id="cb84-533"><a href="#cb84-533" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-536"><a href="#cb84-536" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb84-537"><a href="#cb84-537" aria-hidden="true" tabindex="-1"></a>oa_shp <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="st">"data/census/Liverpool_OA.shp"</span>)</span>
<span id="cb84-538"><a href="#cb84-538" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb84-539"><a href="#cb84-539" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-540"><a href="#cb84-540" aria-hidden="true" tabindex="-1"></a>Examine the input data. A spatial data frame stores a range of attributes derived from a shapefile including the **geometry** of features (e.g. polygon shape and location), **attributes** for each feature (stored in the .dbf), <span class="co">[</span><span class="ot">projection</span><span class="co">](https://en.wikipedia.org/wiki/Map_projection)</span> and coordinates of the shapefile's bounding box - for details, execute:</span>
<span id="cb84-541"><a href="#cb84-541" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-542"><a href="#cb84-542" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval=FALSE}</span></span>
<span id="cb84-543"><a href="#cb84-543" aria-hidden="true" tabindex="-1"></a>?st_read</span>
<span id="cb84-544"><a href="#cb84-544" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb84-545"><a href="#cb84-545" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-546"><a href="#cb84-546" aria-hidden="true" tabindex="-1"></a>You can employ the usual functions to visualise the content of the created data frame:</span>
<span id="cb84-547"><a href="#cb84-547" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-550"><a href="#cb84-550" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb84-551"><a href="#cb84-551" aria-hidden="true" tabindex="-1"></a><span class="co"># visualise variable names</span></span>
<span id="cb84-552"><a href="#cb84-552" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(oa_shp)</span>
<span id="cb84-553"><a href="#cb84-553" aria-hidden="true" tabindex="-1"></a><span class="co"># data structure</span></span>
<span id="cb84-554"><a href="#cb84-554" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(oa_shp)</span>
<span id="cb84-555"><a href="#cb84-555" aria-hidden="true" tabindex="-1"></a><span class="co"># see first few observations</span></span>
<span id="cb84-556"><a href="#cb84-556" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(oa_shp)</span>
<span id="cb84-557"><a href="#cb84-557" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb84-558"><a href="#cb84-558" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-559"><a href="#cb84-559" aria-hidden="true" tabindex="-1"></a>**TASK:**</span>
<span id="cb84-560"><a href="#cb84-560" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-561"><a href="#cb84-561" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>What are the geographical hierarchy in these data?</span>
<span id="cb84-562"><a href="#cb84-562" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>What is the smallest geography?</span>
<span id="cb84-563"><a href="#cb84-563" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>What is the largest geography?</span>
<span id="cb84-564"><a href="#cb84-564" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-565"><a href="#cb84-565" aria-hidden="true" tabindex="-1"></a><span class="fu">### Basic Mapping</span></span>
<span id="cb84-566"><a href="#cb84-566" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-567"><a href="#cb84-567" aria-hidden="true" tabindex="-1"></a>Again, many functions exist in CRAN for creating maps:</span>
<span id="cb84-568"><a href="#cb84-568" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-569"><a href="#cb84-569" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="in">`plot`</span> to create static maps</span>
<span id="cb84-570"><a href="#cb84-570" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="in">`tmap`</span> to create static and interactive maps</span>
<span id="cb84-571"><a href="#cb84-571" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="in">`leaflet`</span> to create interactive maps</span>
<span id="cb84-572"><a href="#cb84-572" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="in">`mapview`</span> to create interactive maps</span>
<span id="cb84-573"><a href="#cb84-573" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="in">`ggplot2`</span> to create data visualisations, including static maps</span>
<span id="cb84-574"><a href="#cb84-574" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="in">`shiny`</span> to create web applications, including maps</span>
<span id="cb84-575"><a href="#cb84-575" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-576"><a href="#cb84-576" aria-hidden="true" tabindex="-1"></a>Here this notebook demonstrates the use of <span class="in">`plot`</span> and <span class="in">`tmap`</span>. First <span class="in">`plot`</span> is used to map the spatial distribution of non-British-born population in Liverpool. First we only map the geometries on the right,</span>
<span id="cb84-577"><a href="#cb84-577" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-578"><a href="#cb84-578" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Using `plot`</span></span>
<span id="cb84-579"><a href="#cb84-579" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-580"><a href="#cb84-580" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, fig.margin = TRUE, fig.cap = 'OAs of Livepool'}</span></span>
<span id="cb84-581"><a href="#cb84-581" aria-hidden="true" tabindex="-1"></a><span class="co"># mapping geometry</span></span>
<span id="cb84-582"><a href="#cb84-582" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">st_geometry</span>(oa_shp))</span>
<span id="cb84-583"><a href="#cb84-583" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb84-584"><a href="#cb84-584" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-585"><a href="#cb84-585" aria-hidden="true" tabindex="-1"></a>and then:</span>
<span id="cb84-586"><a href="#cb84-586" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-587"><a href="#cb84-587" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, fig.cap = 'Spatial distribution of ethnic groups, Liverpool'}</span></span>
<span id="cb84-588"><a href="#cb84-588" aria-hidden="true" tabindex="-1"></a><span class="co"># map attributes, adding intervals</span></span>
<span id="cb84-589"><a href="#cb84-589" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(oa_shp[<span class="st">"Ethnic"</span>], <span class="at">key.pos =</span> <span class="dv">4</span>, <span class="at">axes =</span> <span class="cn">TRUE</span>, <span class="at">key.width =</span> <span class="fu">lcm</span>(<span class="fl">1.3</span>), <span class="at">key.length =</span> <span class="fl">1.</span>,</span>
<span id="cb84-590"><a href="#cb84-590" aria-hidden="true" tabindex="-1"></a>     <span class="at">breaks =</span> <span class="st">"jenks"</span>, <span class="at">lwd =</span> <span class="fl">0.1</span>, <span class="at">border =</span> <span class="st">'grey'</span>) </span>
<span id="cb84-591"><a href="#cb84-591" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb84-592"><a href="#cb84-592" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-593"><a href="#cb84-593" aria-hidden="true" tabindex="-1"></a>**TASK:**</span>
<span id="cb84-594"><a href="#cb84-594" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-595"><a href="#cb84-595" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>What is the key pattern emerging from this map?</span>
<span id="cb84-596"><a href="#cb84-596" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-597"><a href="#cb84-597" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Using `tmap`</span></span>
<span id="cb84-598"><a href="#cb84-598" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-599"><a href="#cb84-599" aria-hidden="true" tabindex="-1"></a>Similar to <span class="in">`ggplot2`</span>, <span class="in">`tmap`</span> is based on the idea of a 'grammar of graphics' which involves a separation between the input data and aesthetics (i.e. the way data are visualised). Each data set can be mapped in various different ways, including location as defined by its geometry, colour and other features. The basic building block is <span class="in">`tm_shape()`</span> (which defines input data), followed by one or more layer elements such as <span class="in">`tm_fill()`</span> and <span class="in">`tm_dots()`</span>.</span>
<span id="cb84-600"><a href="#cb84-600" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-603"><a href="#cb84-603" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb84-604"><a href="#cb84-604" aria-hidden="true" tabindex="-1"></a><span class="co"># ensure geometry is valid</span></span>
<span id="cb84-605"><a href="#cb84-605" aria-hidden="true" tabindex="-1"></a>oa_shp <span class="ot">=</span> sf<span class="sc">::</span><span class="fu">st_make_valid</span>(oa_shp)</span>
<span id="cb84-606"><a href="#cb84-606" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-607"><a href="#cb84-607" aria-hidden="true" tabindex="-1"></a><span class="co"># map</span></span>
<span id="cb84-608"><a href="#cb84-608" aria-hidden="true" tabindex="-1"></a>legend_title <span class="ot">=</span> <span class="fu">expression</span>(<span class="st">"% ethnic pop."</span>)</span>
<span id="cb84-609"><a href="#cb84-609" aria-hidden="true" tabindex="-1"></a>map_oa <span class="ot">=</span> <span class="fu">tm_shape</span>(oa_shp) <span class="sc">+</span></span>
<span id="cb84-610"><a href="#cb84-610" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_fill</span>(<span class="at">col =</span> <span class="st">"Ethnic"</span>, <span class="at">title =</span> legend_title, <span class="at">palette =</span> <span class="fu">magma</span>(<span class="dv">256</span>), <span class="at">style =</span> <span class="st">"cont"</span>) <span class="sc">+</span> <span class="co"># add fill</span></span>
<span id="cb84-611"><a href="#cb84-611" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_borders</span>(<span class="at">col =</span> <span class="st">"white"</span>, <span class="at">lwd =</span> .<span class="dv">01</span>)  <span class="sc">+</span> <span class="co"># add borders</span></span>
<span id="cb84-612"><a href="#cb84-612" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_compass</span>(<span class="at">type =</span> <span class="st">"arrow"</span>, <span class="at">position =</span> <span class="fu">c</span>(<span class="st">"right"</span>, <span class="st">"top"</span>) , <span class="at">size =</span> <span class="dv">4</span>) <span class="sc">+</span> <span class="co"># add compass</span></span>
<span id="cb84-613"><a href="#cb84-613" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_scale_bar</span>(<span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">2</span>), <span class="at">text.size =</span> <span class="fl">0.5</span>, <span class="at">position =</span>  <span class="fu">c</span>(<span class="st">"center"</span>, <span class="st">"bottom"</span>)) <span class="co"># add scale bar</span></span>
<span id="cb84-614"><a href="#cb84-614" aria-hidden="true" tabindex="-1"></a>map_oa</span>
<span id="cb84-615"><a href="#cb84-615" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb84-616"><a href="#cb84-616" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-617"><a href="#cb84-617" aria-hidden="true" tabindex="-1"></a>Note that the operation <span class="in">`+`</span> is used to add new layers. You can set style themes by <span class="in">`tm_style`</span>. To visualise the existing styles use <span class="in">`tmap_style_catalogue()`</span>, and you can also evaluate the code chunk below if you would like to create an interactive map.</span>
<span id="cb84-618"><a href="#cb84-618" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-619"><a href="#cb84-619" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval=FALSE}</span></span>
<span id="cb84-620"><a href="#cb84-620" aria-hidden="true" tabindex="-1"></a><span class="fu">tmap_mode</span>(<span class="st">"view"</span>)</span>
<span id="cb84-621"><a href="#cb84-621" aria-hidden="true" tabindex="-1"></a>map_oa</span>
<span id="cb84-622"><a href="#cb84-622" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb84-623"><a href="#cb84-623" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-624"><a href="#cb84-624" aria-hidden="true" tabindex="-1"></a>**TASK:**</span>
<span id="cb84-625"><a href="#cb84-625" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-626"><a href="#cb84-626" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Try mapping other variables in the spatial data frame. Where do population aged 60 and over concentrate?</span>
<span id="cb84-627"><a href="#cb84-627" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-628"><a href="#cb84-628" aria-hidden="true" tabindex="-1"></a><span class="fu">### Comparing geographies</span></span>
<span id="cb84-629"><a href="#cb84-629" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-630"><a href="#cb84-630" aria-hidden="true" tabindex="-1"></a>If you recall, one of the key issues of working with spatial data is the modifiable area unit problem (MAUP) - see lecture notes. To get a sense of the effects of MAUP, we analyse differences in the spatial patterns of the ethnic population in Liverpool between Middle Layer Super Output Areas (MSOAs) and OAs. So we map these geographies together.</span>
<span id="cb84-631"><a href="#cb84-631" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-634"><a href="#cb84-634" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb84-635"><a href="#cb84-635" aria-hidden="true" tabindex="-1"></a><span class="co"># read data at the msoa level</span></span>
<span id="cb84-636"><a href="#cb84-636" aria-hidden="true" tabindex="-1"></a>msoa_shp <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="st">"data/census/Liverpool_MSOA.shp"</span>)</span>
<span id="cb84-637"><a href="#cb84-637" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-638"><a href="#cb84-638" aria-hidden="true" tabindex="-1"></a><span class="co"># ensure geometry is valid</span></span>
<span id="cb84-639"><a href="#cb84-639" aria-hidden="true" tabindex="-1"></a>msoa_shp <span class="ot">=</span> sf<span class="sc">::</span><span class="fu">st_make_valid</span>(msoa_shp)</span>
<span id="cb84-640"><a href="#cb84-640" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-641"><a href="#cb84-641" aria-hidden="true" tabindex="-1"></a><span class="co"># create a map</span></span>
<span id="cb84-642"><a href="#cb84-642" aria-hidden="true" tabindex="-1"></a>map_msoa <span class="ot">=</span> <span class="fu">tm_shape</span>(msoa_shp) <span class="sc">+</span></span>
<span id="cb84-643"><a href="#cb84-643" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_fill</span>(<span class="at">col =</span> <span class="st">"Ethnic"</span>, <span class="at">title =</span> legend_title, <span class="at">palette =</span> <span class="fu">magma</span>(<span class="dv">256</span>), <span class="at">style =</span> <span class="st">"cont"</span>) <span class="sc">+</span> </span>
<span id="cb84-644"><a href="#cb84-644" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_borders</span>(<span class="at">col =</span> <span class="st">"white"</span>, <span class="at">lwd =</span> .<span class="dv">01</span>)  <span class="sc">+</span> </span>
<span id="cb84-645"><a href="#cb84-645" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_compass</span>(<span class="at">type =</span> <span class="st">"arrow"</span>, <span class="at">position =</span> <span class="fu">c</span>(<span class="st">"right"</span>, <span class="st">"top"</span>) , <span class="at">size =</span> <span class="dv">4</span>) <span class="sc">+</span> </span>
<span id="cb84-646"><a href="#cb84-646" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_scale_bar</span>(<span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">2</span>), <span class="at">text.size =</span> <span class="fl">0.5</span>, <span class="at">position =</span>  <span class="fu">c</span>(<span class="st">"center"</span>, <span class="st">"bottom"</span>)) </span>
<span id="cb84-647"><a href="#cb84-647" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-648"><a href="#cb84-648" aria-hidden="true" tabindex="-1"></a><span class="co"># arrange maps </span></span>
<span id="cb84-649"><a href="#cb84-649" aria-hidden="true" tabindex="-1"></a><span class="fu">tmap_arrange</span>(map_msoa, map_oa) </span>
<span id="cb84-650"><a href="#cb84-650" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb84-651"><a href="#cb84-651" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-652"><a href="#cb84-652" aria-hidden="true" tabindex="-1"></a>**TASK:**</span>
<span id="cb84-653"><a href="#cb84-653" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-654"><a href="#cb84-654" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>What differences do you see between OAs and MSOAs?</span>
<span id="cb84-655"><a href="#cb84-655" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Can you identify areas of spatial clustering? Where are they?</span>
<span id="cb84-656"><a href="#cb84-656" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-657"><a href="#cb84-657" aria-hidden="true" tabindex="-1"></a><span class="fu">## Useful Functions</span></span>
<span id="cb84-658"><a href="#cb84-658" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-659"><a href="#cb84-659" aria-hidden="true" tabindex="-1"></a>| Function                            | Description                                  |</span>
<span id="cb84-660"><a href="#cb84-660" aria-hidden="true" tabindex="-1"></a>|--------------------------------|----------------------------------------|</span>
<span id="cb84-661"><a href="#cb84-661" aria-hidden="true" tabindex="-1"></a>| read.csv()                          | read csv files into data frames              |</span>
<span id="cb84-662"><a href="#cb84-662" aria-hidden="true" tabindex="-1"></a>| str()                               | inspect data structure                       |</span>
<span id="cb84-663"><a href="#cb84-663" aria-hidden="true" tabindex="-1"></a>| mutate()                            | create a new variable                        |</span>
<span id="cb84-664"><a href="#cb84-664" aria-hidden="true" tabindex="-1"></a>| filter()                            | filter observations based on variable values |</span>
<span id="cb84-665"><a href="#cb84-665" aria-hidden="true" tabindex="-1"></a>| %<span class="sc">\&gt;</span>%                                | pipe operator - chain operations             |</span>
<span id="cb84-666"><a href="#cb84-666" aria-hidden="true" tabindex="-1"></a>| select()                            | select variables                             |</span>
<span id="cb84-667"><a href="#cb84-667" aria-hidden="true" tabindex="-1"></a>| merge()                             | join dat frames                              |</span>
<span id="cb84-668"><a href="#cb84-668" aria-hidden="true" tabindex="-1"></a>| st_read                             | read spatial data (ie. shapefiles)           |</span>
<span id="cb84-669"><a href="#cb84-669" aria-hidden="true" tabindex="-1"></a>| plot()                              | create a map based a spatial data set        |</span>
<span id="cb84-670"><a href="#cb84-670" aria-hidden="true" tabindex="-1"></a>| tm_shape(), tm_fill(), tm_borders() | create a map using tmap functions            |</span>
<span id="cb84-671"><a href="#cb84-671" aria-hidden="true" tabindex="-1"></a>| tm_arrange                          | display multiple maps in a single "metaplot" |</span>
<span id="cb84-672"><a href="#cb84-672" aria-hidden="true" tabindex="-1"></a></span>
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->
<footer class="footer"><div class="nav-footer">
    <div class="nav-footer-left">All content licensed under <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> <br> © <a href="https://www.franciscorowe.com">Francisco Rowe</a>, <a href="https://darribas.org">Dani Arribas-Bel</a>.</div>   
      <div class="nav-footer-center"><a href="https://fcorowe.github.io/smds/">Website</a> | <a href="https://github.com/fcorowe/smds">GitHub</a></div>
    <div class="nav-footer-right">Built with <a href="https://quarto.org/">Quarto</a>.</div>
  </div>
</footer>


<script src="site_libs/quarto-html/zenscroll-min.js"></script>
</body></html>